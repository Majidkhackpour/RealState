IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Cities_States]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cities]'))
ALTER TABLE [dbo].[Cities]  WITH CHECK ADD  CONSTRAINT [FK_Cities_States] FOREIGN KEY([StateGuid])
REFERENCES [dbo].[States] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Regions_States]') AND parent_object_id = OBJECT_ID(N'[dbo].[Regions]'))
ALTER TABLE [dbo].[Regions]  WITH CHECK ADD  CONSTRAINT [FK_Regions_States] FOREIGN KEY([CityGuid])
REFERENCES [dbo].[Cities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Peoples]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Peoples] FOREIGN KEY([OwnerGuid])
REFERENCES [dbo].[Peoples] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Users] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Cities]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Cities] FOREIGN KEY([CityGuid])
REFERENCES [dbo].[Cities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Regions]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Regions] FOREIGN KEY([RegionGuid])
REFERENCES [dbo].[Regions] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingType] FOREIGN KEY([BuildingTypeGuid])
REFERENCES [dbo].[BuildingTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingAccountType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingAccountType] FOREIGN KEY([BuildingAccountTypeGuid])
REFERENCES [dbo].[BuildingAccountTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingView]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingView] FOREIGN KEY([BuildingViewGuid])
REFERENCES [dbo].[BuildingViews] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_FloorCover]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_FloorCover] FOREIGN KEY([FloorCoverGuid])
REFERENCES [dbo].[FloorCovers] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_KitchenService]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_KitchenService] FOREIGN KEY([KitchenServiceGuid])
REFERENCES [dbo].[KitchenServices] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_BuildingsReq_Asker]') AND parent_object_id = OBJECT_ID(N'[dbo].[BuildingRequests]'))
ALTER TABLE [dbo].[BuildingRequests]  WITH CHECK ADD  CONSTRAINT [FK_BuildingsReq_Asker] FOREIGN KEY([AskerGuid])
REFERENCES [dbo].[Peoples] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_UserLog_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[UserLogs]'))
ALTER TABLE [dbo].[UserLogs]  WITH CHECK ADD  CONSTRAINT [FK_UserLog_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Note_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[Notes]'))
ALTER TABLE [dbo].[Notes]  WITH CHECK ADD  CONSTRAINT [FK_Note_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SmsLog_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[SmsLogs]'))
ALTER TABLE [dbo].[SmsLogs]  WITH CHECK ADD  CONSTRAINT [FK_SmsLog_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Rental]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Rental] FOREIGN KEY([RentalAutorityGuid])
REFERENCES [dbo].[RentalAuthorities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_DocType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_DocType] FOREIGN KEY([DocumentType])
REFERENCES [dbo].[DocumentTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Condition]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Condition] FOREIGN KEY([BuildingConditionGuid])
REFERENCES [dbo].[BuildingConditions] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_View]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_View] FOREIGN KEY([BuildingViewGuid])
REFERENCES [dbo].[BuildingViews] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_AccType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_AccType] FOREIGN KEY([BuildingAccountTypeGuid])
REFERENCES [dbo].[BuildingAccountTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_FloorCover]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_FloorCover] FOREIGN KEY([FloorCoverGuid])
REFERENCES [dbo].[FloorCovers] ([Guid])
GO

-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAll] 
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Regions_SelectAll] 
AS
BEGIN
	select Regions.*,Cities.Name As CityName,States.Name As StateName
	from Regions left outer join Cities on Regions.CityGuid=Cities.Guid
	inner join States on Cities.StateGuid=States.Guid
	order by StateName,CityName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAllByCityGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAllByCityGuid]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Regions_SelectAllByCityGuid] 
	@cityGuid uniqueidentifier
AS
BEGIN
	select Regions.*,Cities.Name As CityName,States.Name As StateName
	from Regions inner join Cities on Regions.CityGuid=Cities.Guid
	inner join States on Cities.StateGuid=States.Guid
	where Regions.CityGuid=@cityGuid
	order by StateName,CityName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAllByStateGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAllByStateGuid]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAllByStateGuid] 
	@stateGuid uniqueidentifier
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	where Cities.StateGuid=@stateGuid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Buildings_SelectAll] 
AS
BEGIN
select [dbo].[Buildings].*,[dbo].[Peoples].Name As OwnerName,
       [dbo].[BuildingTypes].Name As BuildingTypeName,
	   [dbo].[Users].Name As UserName,
	   [dbo].[Regions].Name As RegionName,
	   [dbo].[RentalAuthorities].Name As RentalAuthorityName,
	   [dbo].[DocumentTypes].Name As DocumentTypeName,
	   [dbo].[BuildingConditions].Name As BuildingConditionName,
	   [dbo].[BuildingViews].Name As BuildingViewName,
	   [dbo].[FloorCovers].Name As FloorCoverName,
	   [dbo].[KitchenServices].Name As KitchenServiceName,
	   [dbo].[BuildingAccountTypes].Name As BuildingAccountTypeName
From [dbo].[Buildings] 
     inner join [dbo].[Peoples] on [dbo].[Buildings].OwnerGuid=[dbo].[Peoples].Guid
	 inner join [dbo].[BuildingTypes] on [dbo].[Buildings].BuildingTypeGuid=[dbo].[BuildingTypes].Guid
	 inner join [dbo].[Users] on [dbo].[Buildings].UserGuid=[dbo].[Users].Guid
	 inner join [dbo].[Regions] on [dbo].[Buildings].RegionGuid=[dbo].[Regions].Guid
	 inner join [dbo].[RentalAuthorities] on [dbo].[Buildings].RentalAutorityGuid=[dbo].[RentalAuthorities].Guid
	 inner join [dbo].[DocumentTypes] on [dbo].[Buildings].DocumentType=[dbo].[DocumentTypes].Guid
	 inner join [dbo].[BuildingConditions] on [dbo].[Buildings].BuildingConditionGuid=[dbo].[BuildingConditions].Guid
	 inner join [dbo].[BuildingViews] on [dbo].[Buildings].BuildingViewGuid=[dbo].[BuildingViews].Guid
	 inner join [dbo].[FloorCovers] on [dbo].[Buildings].FloorCoverGuid=[dbo].[FloorCovers].Guid
	 inner join [dbo].[KitchenServices] on [dbo].[Buildings].KitchenServiceGuid=[dbo].[KitchenServices].Guid
	 inner join [dbo].[BuildingAccountTypes] on [dbo].[Buildings].BuildingAccountTypeGuid=[dbo].[BuildingAccountTypes].Guid

	 Order By [dbo].[Buildings].CreateDate desc
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingsReq_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingsReq_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_BuildingsReq_SelectAll] 
AS
BEGIN
select [dbo].[BuildingRequests].*,[dbo].[Peoples].Name As AskerName,
	   [dbo].[Users].Name As UserName
	   From [dbo].[BuildingRequests] 
	   inner join [dbo].[Peoples] on [dbo].[BuildingRequests].AskerGuid=[dbo].[Peoples].Guid
	   inner join [dbo].[Users] on [dbo].[BuildingRequests].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_SelectAll] 
AS
BEGIN
	select [dbo].[Contracts].*,[dbo].[Peoples].Name as fName,
	(select [dbo].[Peoples].Name from [dbo].[Peoples] where Guid=[dbo].[Contracts].SecondSideGuid) as sName,
	[dbo].[Users].Name as UserName
	from [dbo].[Contracts] left Outer join [dbo].[Peoples]
	on [dbo].[Contracts].FirstSideGuid=[dbo].[Peoples].Guid
	left outer join [dbo].[Users]
	on [dbo].[Contracts].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_SelectAll_ByUser_And_Date]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_SelectAll_ByUser_And_Date]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_UserLog_SelectAll_ByUser_And_Date] 
	@userGuid uniqueidentifier,
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	select [dbo].[UserLogs].*,[dbo].[Users].Name as UserName
	from [dbo].[UserLogs] inner join [dbo].[Users]
	on [dbo].[UserLogs].UserGuid=[dbo].[Users].Guid
	where Date>=@date1 and Date<=@date2 and UserGuid=@userGuid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Note_SelectAll] 
AS
BEGIN
	select [dbo].[Notes].*,[dbo].[Users].Name as UserName
	from [dbo].[Notes] inner join [dbo].[Users]
	on [dbo].[Notes].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Gardesh_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Gardesh_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Gardesh_SelectAll] 
AS
BEGIN
	select * from [dbo].[GardeshHesabs]
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_PhoneBook_SelectAll] 
AS
BEGIN
	select * from [dbo].[PhoneBooks]
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_SmsLog_SelectAll] 
AS
BEGIN
	select [dbo].[SmsLogs].*,[dbo].[Users].Name As UserName
	from [dbo].[SmsLogs] inner join [dbo].[Users]
	on [dbo].[SmsLogs].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_Save]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Pardakht_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@dateSh nvarchar(20),
	@st bit='true',
	@payer uniqueidentifier,
	@createdate datetime,
	@desc nvarchar(max)='',
	@naqdprice bigint=0,
	@bankprice bigint=0,
	@checkprice bigint=0,
	@fishNo nvarchar(50)='',
	@checkNo nvarchar(50)='',
	@sarresid nvarchar(50)='',
	@bankname nvarchar(50)=''
AS
BEGIN
	declare @gardeshprice bigint
	declare @totalPrice bigint
	declare @tarafHesab uniqueidentifier


	set @gardeshprice=(ISNULL((select Price from GardeshHesabs
		where ParentGuid=@guid and PeopleGuid=@payer),0))

	set @totalPrice=(@naqdprice+@bankprice+@checkprice)

	if(@gardeshprice<>0)
	begin
		update GardeshHesabs
		set Price=@totalPrice
		where ParentGuid=@guid and PeopleGuid=@payer
	end
	else
	begin
		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(4,N' ثبت سند پرداخت در تاریخ'+@dateSh,NEWID(), GETDATE(),@guid,@payer,@totalPrice,'true',2)
	end

	set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

	if (@tarafHesab='00000000-0000-0000-0000-000000000000')
	begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account-@gardeshprice
			where Guid=@payer

			update Hazines
			set Account=Account+@totalPrice
			where Guid=@payer
		end
		else
		begin
			update Users
			set Account=Account-@gardeshprice
			where Guid=@payer

			update Users
			set Account=Account+@totalPrice
			where Guid=@payer
		end
	end
	else
	begin
		    update Peoples
			set Account=Account-@gardeshprice
			where Guid=@payer

			update Peoples
			set Account=Account+@totalPrice
			where Guid=@payer
	end

	update Pardakhts
	set Modified=@modif,
	Status=@st,
	Payer=@payer,
	NaqdPrice=@naqdprice,
	BankPrice=@bankprice,
	[Check]=@checkprice,
	Description=@desc,
	FishNo=@fishNo,
	CheckNo=@checkNo,
	SarResid=@sarresid,
	BankName=@bankname
	where Guid=@guid

	if (@@ROWCOUNT=0)
	begin
		insert into Pardakhts(BankName,BankPrice,[Check],CheckNo,CreateDate,Description,FishNo,Guid,Modified,NaqdPrice,Payer,SarResid,Status)
		values(@bankname,@bankprice,@checkprice,@checkNo,GETDATE(),@desc,@fishNo,@guid,GETDATE(),@naqdprice,@payer,@sarresid,@st)
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Save]	As Begin print 11 end')
GO

Alter PROCEDURE [dbo].[sp_Reception_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@dateSh nvarchar(20),
	@st bit='true',
	@receptor uniqueidentifier,
	@createdate datetime,
	@desc nvarchar(max)='',
	@naqdprice bigint=0,
	@bankprice bigint=0,
	@checkprice bigint=0,
	@fishNo nvarchar(50)='',
	@checkNo nvarchar(50)='',
	@sarresid nvarchar(50)='',
	@bankname nvarchar(50)=''
AS
BEGIN
	declare @gardeshprice bigint
	declare @totalPrice bigint
	declare @tarafHesab uniqueidentifier


	set @gardeshprice=(ISNULL((select Price from GardeshHesabs
		where ParentGuid=@guid and PeopleGuid=@receptor),0))

	set @totalPrice=(@naqdprice+@bankprice+@checkprice)

	if(@gardeshprice<>0)
	begin
		update GardeshHesabs
		set Price=@totalPrice
		where ParentGuid=@guid and PeopleGuid=@receptor
	end
	else
	begin
		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(3,N' ثبت سند دریافت در تاریخ'+@dateSh,NEWID(), GETDATE(),@guid,@receptor,@totalPrice,'true',3)
	end

	set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@receptor),'00000000-0000-0000-0000-000000000000'))

	if (@tarafHesab='00000000-0000-0000-0000-000000000000')
	begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@receptor),'00000000-0000-0000-0000-000000000000'))

		update Users
		set Account=Account+@gardeshprice
		where Guid=@receptor

		update Users
		set Account=Account-@totalPrice
		where Guid=@receptor
	end
	else
	begin
		update Peoples
		set Account=Account+@gardeshprice
		where Guid=@receptor

		update Peoples
		set Account=Account-@totalPrice
		where Guid=@receptor
	end

	update Receptions
	set Modified=@modif,
	Status=@st,
	Receptor=@receptor,
	NaqdPrice=@naqdprice,
	BankPrice=@bankprice,
	[Check]=@checkprice,
	Description=@desc,
	FishNo=@fishNo,
	CheckNo=@checkNo,
	SarResid=@sarresid,
	BankName=@bankname
	where Guid=@guid

	if (@@ROWCOUNT=0)
	begin
		insert into Receptions(BankName,BankPrice,[Check],CheckNo,CreateDate,Description,FishNo,Guid,Modified,NaqdPrice,Receptor,SarResid,Status)
		values(@bankname,@bankprice,@checkprice,@checkNo,GETDATE(),@desc,@fishNo,@guid,GETDATE(),@naqdprice,@receptor,@sarresid,@st)
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_ChangeStatus]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_ChangeStatus]
	@conGuid uniqueidentifier,
	@st bit
AS
BEGIN	
	update ContractFinances
	set Status=@st
	where ConGuid=@conGuid

	update GardeshHesabs
	set Status=@st
	where ParentGuid=@conGuid

	update Contracts
	set Status=@st 
	where Guid=@conGuid

	declare @buildingGuid uniqueidentifier
	set @buildingGuid=(select BuildingGuid from Contracts where Guid=@conGuid)

	declare @fPrice bigint
	set @fPrice= (select FirstTotalPrice from ContractFinances where ConGuid=@conGuid)
	declare @fAddedd bigint
	set @fAddedd= (select FirstAddedValue from ContractFinances where ConGuid=@conGuid)
	declare @fDis bigint
	set @fDis= (select FirstDiscount from ContractFinances where ConGuid=@conGuid)
	declare @fGuid uniqueidentifier
	set @fGuid=(select FirstSideGuid from Contracts where Guid=@conGuid)

	set @fPrice=(@fPrice+@fAddedd)-@fDis

	declare @sPrice bigint
	set @sPrice= (select SecondTotalPrice from ContractFinances where ConGuid=@conGuid)
	declare @sAddedd bigint
	set @sAddedd= (select SecondAddedValue from ContractFinances where ConGuid=@conGuid)
	declare @sDis bigint
	set @sDis= (select SecondDiscount from ContractFinances where ConGuid=@conGuid)
	declare @sGuid uniqueidentifier
	set @sGuid=(select SecondSideGuid from Contracts where Guid=@conGuid)

	set @sPrice=(@sPrice+@sAddedd)-@sDis

	declare @bPrice bigint
	set @bPrice= (select BazaryabPrice from Contracts where Guid=@conGuid)

	declare @bGuid uniqueidentifier
	set @bGuid=(select BazaryabGuid from Contracts where Guid=@conGuid)

	if(@st='true')
	begin
		update Peoples
		set Account=Account+@fPrice
		where Guid=@fGuid

		update Peoples
		set Account=Account+@SPrice
		where Guid=@sGuid

		update Users
		set Account =Account-@bPrice
		where Guid=@bGuid

		update Buildings
		set IsArchive='true'
		where Guid=@buildingGuid
	end
	else
	begin
		update Peoples
		set Account=Account-@fPrice
		where Guid=@fGuid

		update Peoples
		set Account=Account-@SPrice
		where Guid=@sGuid

		update Users
		set Account =Account+@bPrice
		where Guid=@bGuid

		update Buildings
		set IsArchive='false'
		where Guid=@buildingGuid
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Save]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_Save]
	@Guid uniqueidentifier,
	@st bit,
	@modif datetime,
	@code bigint,
	@isTemp bit,
	@fGuid uniqueidentifier,
	@sGuid uniqueidentifier,
	@term int,
	@fromDate datetime,
	@totalPrice bigint=0,
	@minorPrice bigint=0,
	@checkNo nvarchar(200)='',
	@bankName nvarchar(200)='',
	@shobe nvarchar(200)='',
	@sareresid nvarchar(20)='',
	@discharcgDate datetime,
	@setDocDate datetime,
	@setDocPlace nvarchar(500)='',
	@sarqofli bigint=0,
	@delay bigint=0,
	@desc nvarchar(Max)='',
	@userGuid uniqueidentifier,
	@buGuid uniqueidentifier,
	@type smallint,
	@dateM datetime,
	@dateSh nvarchar(20)='',
	@fPrice bigint=0,
	@sPrice bigint=0,
	@fSidePrice bigint=0,
	@sSidePrice bigint=0,
	@bazaryabGuid uniqueidentifier='00000000-0000-0000-0000-000000000000',
	@bazaryabPrice bigint=0
AS
BEGIN	
	update Peoples
	set Account=Account-@fPrice
	where Guid=@fGuid
	update Peoples
	set Account=Account+@fSidePrice
	where Guid=@fGuid


	update Peoples
	set Account=Account-@sPrice
	where Guid=@sGuid
	update Peoples
	set Account=Account+@sSidePrice
	where Guid=@sGuid

	delete from GardeshHesabs
	where ParentGuid=@Guid

	declare @gardeshGuid uniqueidentifier
	set @gardeshGuid=(isnull((select Guid from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@fGuid),'00000000-0000-0000-0000-000000000000'))

	if @gardeshGuid='00000000-0000-0000-0000-000000000000'
	begin
		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(2,N'عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@fGuid,@fSidePrice,'true',2)

		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(2,N'عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@sGuid,@sSidePrice,'true',2)
	end
	else
	begin
		update GardeshHesabs
		set Price=@fSidePrice
		where ParentGuid=@Guid and PeopleGuid=@fGuid
		update GardeshHesabs
		set Price=@sSidePrice
		where ParentGuid=@Guid and PeopleGuid=@sGuid
	end

	update Buildings
	set IsArchive='true'
	where Guid=@buGuid

	declare @contractGuid uniqueidentifier
	set @contractGuid=(isnull((select Guid from Contracts where Guid=@Guid),'00000000-0000-0000-0000-000000000000'))

	declare @contractPrice bigint
	set @contractPrice=(isnull((select BazaryabPrice from Contracts where Guid=@Guid),0))

	declare @contractBazaryab uniqueidentifier
	set @contractBazaryab=(isnull((select BazaryabGuid from Contracts where Guid=@Guid),'00000000-0000-0000-0000-000000000000'))

	if @contractGuid<>'00000000-0000-0000-0000-000000000000'
	begin
		update Users
		set Account=Account+@contractPrice
		where Guid=@contractBazaryab

		delete from GardeshHesabs
		where ParentGuid=@Guid and PeopleGuid=@contractBazaryab
	end

	if @bazaryabGuid<>'00000000-0000-0000-0000-000000000000'
	begin
		declare @bGardeshGuid uniqueidentifier
		set @bGardeshGuid=(isnull((select Guid from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid),'00000000-0000-0000-0000-000000000000'))

		declare @bGardeshPrice bigint
		set @bGardeshPrice=(isnull((select Price from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid),0))

		if @bGardeshGuid='00000000-0000-0000-0000-000000000000'
		begin
			insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
			values(2,N'پورسانت عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@bazaryabGuid,@bazaryabPrice,'true',3)
		end
		else
		begin
			update GardeshHesabs
			set Price=@bazaryabPrice
			where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid
		end

		update Users
		set Account=Account-@bazaryabPrice
		where Guid=@bazaryabGuid
	end

	update Contracts 
	set Status=@st,
	Modified=@modif,
	Code=@code,
	IsTemp=@isTemp,
	FirstSideGuid=@fGuid,
	SecondSideGuid=@sGuid,
	Term=@term,
	FromDate=@fromDate,
	TotalPrice=@totalPrice,
	MinorPrice=@minorPrice,
	CheckNo=@checkNo,
	BankName=@bankName,
	Shobe=@shobe,
	SarResid=@sareresid,
	DischargeDate=@discharcgDate,
	SetDocDate=@setDocDate,
	SetDocPlace=@setDocPlace,
	SarQofli=@sarqofli,
	Delay=@delay,
	Description=@desc,
	UserGuid=@userGuid,
	BuildingGuid=@buGuid,
	Type=@type,
	DateM=@dateM,
	BazaryabGuid=@bazaryabGuid,
	BazaryabPrice=@bazaryabPrice
	where Guid=@Guid

	if (@@ROWCOUNT=0)
	begin
		insert into Contracts(
				Guid,Status,Modified,IsTemp,Code,FirstSideGuid,SecondSideGuid,Term,FromDate,
				TotalPrice,MinorPrice,CheckNo,BankName,Shobe,SarResid,DischargeDate,
				SetDocDate,SetDocPlace,SarQofli,Delay,Description,UserGuid,BuildingGuid,
				Type,DateM,BazaryabGuid,BazaryabPrice
		)
		values(
				@Guid,@st,@modif,@isTemp,@code,@fGuid,@sGuid,@term,@fromDate,
				@totalPrice,@minorPrice,@checkNo,@bankName,@shobe,@sareresid,@discharcgDate,
				@setDocDate,@setDocPlace,@sarqofli,@delay,@desc,@userGuid,@buGuid,
				@type,@dateM,@bazaryabGuid,@bazaryabPrice
		)
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Save]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Sanad_Save
	@parentGuid uniqueidentifier,
	@bedGuid uniqueidentifier,
	@besGuid uniqueidentifier,
	@price bigint=0,
	@desc nvarchar(max)=''
AS
BEGIN
	--Update Bed Account
	declare @tarafHesab uniqueidentifier

	set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@bedGuid),'00000000-0000-0000-0000-000000000000'))

	if (@tarafHesab='00000000-0000-0000-0000-000000000000')
	begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@bedGuid),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@bedGuid),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account+@price
			where Guid=@bedGuid
		end
		else
		begin
			update Users
			set Account=Account+@price
			where Guid=@bedGuid
		end
	end
	else
	begin
			update Peoples
			set Account=Account+@price
			where Guid=@bedGuid
	end


	--Update Bed Account

	set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@besGuid),'00000000-0000-0000-0000-000000000000'))

	if (@tarafHesab='00000000-0000-0000-0000-000000000000')
	begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@besGuid),'00000000-0000-0000-0000-000000000000'))

		update Users
		set Account=Account-@price
		where Guid=@besGuid

	end
	else
	begin
		update Peoples
		set Account=Account-@price
		where Guid=@besGuid

	end


	--Insert Sanad

	insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(5,@desc,NEWID(), GETDATE(),@parentGuid,@bedGuid,@price,'true',2)


	insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
	values(5,@desc,NEWID(), GETDATE(),@parentGuid,@besGuid,@price,'true',3)

END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_ChangeStatus]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Pardakht_ChangeStatus	
	@guid uniqueidentifier,
	@hesabGuid uniqueidentifier,
	@st bit,
	@price bigint
AS
BEGIN
	update GardeshHesabs
	set Status=@st
	where PeopleGuid=@hesabGuid and ParentGuid=@guid

	declare @tarafHesab uniqueidentifier

	if (@st='true')
	begin
		set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account+@price
			where Guid=@hesabGuid
		end
		else
		begin
			update Users
			set Account=Account+@price
			where Guid=@hesabGuid
		end
end
else
begin
		update Peoples
		set Account=Account+@price
		where Guid=@hesabGuid
end
	end
	else
	begin
		set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account-@price
			where Guid=@hesabGuid
		end
		else
		begin
			update Users
			set Account=Account-@price
			where Guid=@hesabGuid
		end
		end
		else
		begin
			update Peoples
			set Account=Account-@price
			where Guid=@hesabGuid
		end
	end

	update Pardakhts
	set Status=@st
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_ChangeStatus]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Reception_ChangeStatus	
	@guid uniqueidentifier,
	@hesabGuid uniqueidentifier,
	@st bit,
	@price bigint
AS
BEGIN
	update GardeshHesabs
	set Status=@st
	where PeopleGuid=@hesabGuid and ParentGuid=@guid

	declare @tarafHesab uniqueidentifier

	if (@st='true')
	begin
		set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account-@price
			where Guid=@hesabGuid
		end
		else
		begin
			update Users
			set Account=Account-@price
			where Guid=@tarafHesab
		end
end
else
begin
		update Peoples
		set Account=Account-@price
		where Guid=@hesabGuid
end
	end
	else
	begin
		set @tarafHesab=(ISNULL((select Guid from Peoples
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
		set @tarafHesab=(ISNULL((select Guid from Users
		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
		begin
			set @tarafHesab=(ISNULL((select Guid from Hazines
			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

			update Hazines
			set Account=Account+@price
			where Guid=@tarafHesab
		end
		else
		begin
			update Users
			set Account=Account+@price
			where Guid=@tarafHesab
		end
		end
		else
		begin
			update Peoples
			set Account=Account+@price
			where Guid=@tarafHesab
		end
	end

	update Receptions
	set Status=@st
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_GetAllBirthDay]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_GetAllBirthDay]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAllBirthDay 
	@dateSh nvarchar(20)
AS
BEGIN
	Select * from Peoples
	where DateBirth=@dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_GetAll
AS
BEGIN
	Select * from [dbo].[Temps]
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_Save
	@guid uniqueidentifier,
	@modif datetime,
	@type smallint,
	@objGuid uniqueidentifier
AS
BEGIN
	insert into [dbo].[Temps](
		 Guid
		,Modified
		,ObjectGuid
		,Status
		,Type)
		values(
		 @guid
		,@modif
		,@objGuid
		,'true'
		,@type)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Remove]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Temp_Remove
	@guid uniqueidentifier
AS
BEGIN
	Delete from [dbo].[Temps]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Count
	@userGuid uniqueidentifier,
	@type smallint
AS
BEGIN
	declare @count int
	if(@userGuid='00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings)
		select @count
		return @count
	end
	else if(@userGuid<>'00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings where UserGuid=@userGuid)
		select @count
		return @count
	end
	else if(@type=1) --Rahn
	begin
		set @count=(select COUNT(*) from Buildings where RahnPrice1>0 or RahnPrice2>0 or EjarePrice1>0 or EjarePrice2>0)
		select @count
		return @count
	end
	else if(@type=2) --Foroush
	begin
		set @count=(select COUNT(*) from Buildings where SellPrice>0)
		select @count
		return @count
	end	
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_Count
	@userGuid uniqueidentifier
AS
BEGIN
	declare @count int
	set @count = (select COUNT(*)
					from Contracts
					where UserGuid=@userGuid)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Requests_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Requests_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Requests_Count	
	@userGuid uniqueidentifier
AS
BEGIN	
	declare @count int
	if (@userGuid='00000000-0000-0000-0000-000000000000')
	begin
		set @count=(select COUNT(*) from BuildingRequests)
		select @count
		return @count
	end
	else 
	begin
		set @count=(select COUNT(*) from BuildingRequests where UserGuid=@userGuid)
		select @count
		return @count
	end

END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_CheckCount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_CheckCount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Pardakht_CheckCount	
	@dateSh nvarchar(50)
AS
BEGIN	
	declare @count int
	set @count = (select COUNT(*) from Pardakhts where SarResid like @dateSh)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_CheckCount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_CheckCount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Reception_CheckCount	
	@dateSh nvarchar(50)
AS
BEGIN	
	declare @count int
	set @count = (select COUNT(*) from Pardakhts where SarResid like @dateSh)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_CheckReport]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_CheckReport]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Pardakht_CheckReport
	@dateSh nvarchar(50)
AS
BEGIN
	select  Peoples.Name As PeopleName,
			Pardakhts.[Check] As Price,
			Pardakhts.CheckNo As Number,
			Pardakhts.BankName As BankName,
			Pardakhts.CreateDate As CreateDate
	from Pardakhts left outer join Peoples on
		 Pardakhts.Payer = Peoples.Guid
	where Pardakhts.[Check]>0
	and Pardakhts.SarResid=@dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_CheckReport]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_CheckReport]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Reception_CheckReport
	@dateSh nvarchar(50)
AS
BEGIN
	select  Peoples.Name As PeopleName,
			Receptions.[Check] As Price,
			Receptions.CheckNo As Number,
			Receptions.BankName As BankName,
			Receptions.CreateDate As CreateDate
	from Receptions left outer join Peoples on
		 Receptions.Receptor = Peoples.Guid
	where Receptions.[Check]>0
	and Receptions.SarResid=@dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Discharge_Count
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	
	declare @count int
	set @count = (select COUNT(*) from Contracts where 
					DATEADD(month, Term, FromDate)>=@date1 and 
					DATEADD(month, Term, FromDate)<=@date2 and
					Status='true')
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_List]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_List]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Building_Discharge_List]
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	select  Contracts.Code As Code,
			Peoples.Name As FSideName,
			Contracts.FirstSideGuid As FSideGuid,
			Contracts.SecondSideGuid As SSideGuid,
			(select [dbo].[Peoples].Name from [dbo].[Peoples] where Guid=[dbo].[Contracts].SecondSideGuid) as SSideName,
			Contracts.Term As Term,
			Contracts.FromDate As FromDate,
			DATEADD(month, Contracts.Term, Contracts.FromDate) As ToDate,
			Buildings.Code As BuildingCode
			from [dbo].[Contracts] left Outer join [dbo].[Peoples]
			on [dbo].[Contracts].FirstSideGuid=[dbo].[Peoples].Guid left outer join Buildings
			on [dbo].[Contracts].BuildingGuid=Buildings.Guid
			where  DATEADD(month, Term, FromDate)>=@d1 and 
				   DATEADD(month, Term, FromDate)<=@d2 and
				   [Contracts].Status='true'
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_Insert]	As Begin print 11 end')
GO
Alter PROCEDURE sp_UserLog_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@userGuid uniqueidentifier,
	@date datetime,
	@action smallint,
	@part smallint,
	@desc nvarchar(max)
AS
BEGIN	
	insert into [dbo].[UserLogs](
			 Guid
			,Modified
			,Status
			,UserGuid
			,Date
			,Action
			,Part
			,Description)
			values(
			 @guid
			,@modif
			,@st
			,@userGuid
			,@date
			,@action
			,@part
			,@desc)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOptions_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOptions_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRelatedOptions_GetAll	
	@buGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingRelatedOptions]
	where BuildinGuid=@buGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRequestRegion_GetAll
	@reqGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingRequestRegions]
	where RequestGuid=@reqGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ContractFinance_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ContractFinance_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_ContractFinance_Get
	@conGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[ContractFinances]
	where ConGuid=@conGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_GetAll
	@pGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[PhoneBooks]
	where ParentGuid=@pGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_Get
	@pGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[PeopleBankAccounts]
	where ParentGuid=@pGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingGallery_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingGallery_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingGallery_GetAll
	@buGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingGalleries]
	where BuildingGuid=@buGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Setting_Get
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[Settings]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByName
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[Contracts]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Buildings_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[Buildings]
	where Guid=@guid
END