IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_Save
	@guid uniqueidentifier,
	@modif datetime,
	@name nvarchar(200),
	@code nvarchar(10),
	@account decimal,
	@hGroup smallint,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Kols]
   SET [Modified] = @modif
      ,[Name] = @name
      ,[Code] = @name
      ,[Account] = @account
      ,[HesabGroup] = @hGroup
	  ,[ServerStatus] = @serverSt
	  ,[ServerDeliveryDate] = @serverDate
	WHERE [Guid] = @guid
	
	if @@ROWCOUNT=0
	begin
		INSERT INTO [dbo].[Kols]
			   ([Guid]
			   ,[Modified]
			   ,[Name]
			   ,[Code]
			   ,[Account]
			   ,[HesabGroup]
			   ,[ServerStatus]
		       ,[ServerDeliveryDate])
		 VALUES
			   (@guid
			   ,@modif
			   ,@name
			   ,@code
			   ,@account
			   ,@hGroup
			   ,@serverSt
		       ,@serverDate)
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_SelectAll
AS
BEGIN
	select * from Kols 
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	select * from Kols
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_Save
	@guid uniqueidentifier,
	@modif datetime,
	@name nvarchar(200),
	@code nvarchar(10),
	@account decimal,
	@kolGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Moeins]
	   SET [Modified] = @modif
		  ,[Name] = @name
		  ,[Code] = @code
		  ,[KolGuid] = @kolGuid
		  ,[Account] = @account
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Moeins]
           ([Guid]
           ,[Modified]
           ,[Name]
           ,[Code]
           ,[KolGuid]
           ,[DateM]
           ,[Account]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
		   ,@name
           ,@code
           ,@kolGuid
           ,GETDATE()
           ,@account
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_SelectAll
AS
BEGIN
	select * from Moeins
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Moeins
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_GetByCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_GetByCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_GetByCode
	@code nvarchar(10)
AS
BEGIN
	select * from Moeins
	where Code=@code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_UpdateAccount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_UpdateAccount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_UpdateAccount
	@guid uniqueidentifier,
	@price decimal
AS
BEGIN
	declare @kolGuid uniqueidentifier

	set @kolGuid = (select KolGuid from Moeins where Guid=@guid)

	update Moeins
	set Account = Account + @price
	where Guid = @guid

	update Kols
	set Account = Account + @price
	where Guid = @kolGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Save]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Tafsil_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@desc nvarchar(max),
	@account decimal,
	@accFirst decimal,
	@hType int,
	@isSystem bit,
	@BankCreditMoeinGuid uniqueidentifier,
	@SandouqCreditMoeinGuid uniqueidentifier,
	@HazineCreditMoeinGuid uniqueidentifier,
	@TafsilCreditMoeinGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	declare @AccountF_Before decimal
	Set @AccountF_Before = (Select isnull(AccountFirst,0) from Tafsils where Guid=@guid)
	set @AccountF_Before=isnull(@AccountF_Before,0)
	
	UPDATE [dbo].[Tafsils]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Code] = @code
		  ,[Description] = @desc
		  ,[HesabType] = @hType
		  ,[Account] = @account
		  ,[AccountFirst] = @accFirst
		  ,[isSystem] = @isSystem
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	if @@ROWCOUNT=0
	begin
		INSERT INTO [dbo].[Tafsils]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Code]
           ,[Description]
           ,[HesabType]
           ,[DateM]
           ,[Account]
		   ,[AccountFirst]
           ,[isSystem]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@code
           ,@desc
           ,@hType
           ,GETDATE()
           ,@account
		   ,@accFirst
           ,@isSystem
		   ,@serverSt
		   ,@serverDate)
	 end

	if isnull(@accFirst,0) <> @AccountF_Before
		begin
			--Tafsil
			if(@hType=2 or @hType=6)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @TafsilCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @TafsilCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Bank
			if(@hType=4)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @BankCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @BankCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Sandouq
			if(@hType=5)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @SandouqCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @SandouqCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Hazine
			if(@hType=3)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @HazineCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @HazineCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end
		
			Exec sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@TafsilCreditMoeinGuid,@BankCreditMoeinGuid,@SandouqCreditMoeinGuid
		end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Tafsils
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_SelectAll
AS
BEGIN
	select * from Tafsils
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Tafsils
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_GetByCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_GetByCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_GetByCode
	@code nvarchar(10)
AS
BEGIN
	select * from Tafsils
	where Code=@code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_NextCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_NextCode
	@hType smallint
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Code) From Tafsils
	where HesabType = @hType
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_CheckCode]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Tafsil_CheckCode
	@guid uniqueidentifier,
	@code nvarchar(10)
AS
BEGIN
	select COUNT(*) from Tafsils
	where Code=@code and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_CheckName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_CheckName
	@guid uniqueidentifier,
	@name nvarchar(200)
AS
BEGIN
	select COUNT(*) from Tafsils
	where Name=@name And Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_UpdateAccount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_UpdateAccount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_UpdateAccount
	@guid uniqueidentifier,
	@price decimal
AS
BEGIN
	update Tafsils
	set Account = Account + @price
	where Guid = @guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Bank_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Bank_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Bank_SelectAll
AS
BEGIN
	Select Banks.*,Tafsils.Account,Tafsils.AccountFirst
	from Banks inner join Tafsils
	on Tafsils.Guid=Banks.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Bank_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Bank_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Bank_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select Banks.*,Tafsils.Account,Tafsils.AccountFirst
	from Banks inner join Tafsils
	on Tafsils.Guid=Banks.Guid
	where Banks.Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Banks_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Banks_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Banks_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Banks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Banks_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Banks_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Banks_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@desc nvarchar(max),
	@shobe nvarchar(200),
	@codeShobe nvarchar(20),
	@hesabNumber nvarchar(200),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Banks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Code] = @code
		  ,[Name] = @name
		  ,[Shobe] = @shobe
		  ,[CodeShobe] = @codeShobe
		  ,[HesabNumber] = @hesabNumber
		  ,[Description] = @desc
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Banks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Code]
           ,[Name]
           ,[Shobe]
           ,[CodeShobe]
           ,[HesabNumber]
           ,[Description]
           ,[DateM]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@code
           ,@name
           ,@shobe
           ,@codeShobe
           ,@hesabNumber
           ,@desc
           ,GETDATE()
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAll
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_SelectRowByGroupGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_SelectRowByGroupGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_SelectRowByGroupGuid
	@GroupGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.GroupGuid=@GroupGuid and
		  Peoples.Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_GetAllBirthDay]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_GetAllBirthDay]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAllBirthDay
	@dateSh nvarchar(20)
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.DateBirth Like @dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@code nvarchar(10),
	@name nvarchar(500),
	@nCode nvarchar(20),
	@idCode nvarchar(20),
	@fName nvarchar(200),
	@pBirth nvarchar(500),
	@dBirth nvarchar(20),
	@address nvarchar(max),
	@issued nvarchar(200),
	@postalCode nvarchar(50),
	@groupGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Peoples]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Code] = @code
		  ,[Name] = @name
		  ,[NationalCode] = @nCode
		  ,[IdCode] = @idCode
		  ,[FatherName] = @fName
		  ,[PlaceBirth] = @pBirth
		  ,[DateBirth] = @dBirth
		  ,[Address] = @address
		  ,[IssuedFrom] = @issued
		  ,[PostalCode] = @postalCode
		  ,[GroupGuid] = @groupGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Peoples]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Code]
           ,[Name]
           ,[NationalCode]
           ,[IdCode]
           ,[FatherName]
           ,[PlaceBirth]
           ,[DateBirth]
           ,[Address]
           ,[IssuedFrom]
           ,[PostalCode]
           ,[GroupGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@code
           ,@name
           ,@nCode
           ,@idCode
           ,@fName
           ,@pBirth
           ,@dBirth
           ,@address
           ,@issued
           ,@postalCode
           ,@groupGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	UPDATE [dbo].[Peoples]
			SET [Status] = @st
	        WHERE [Guid] = @Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * from Users
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetAll
AS
BEGIN
	Select * from Users
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(400),
	@userName nvarchar(200),
	@pass nvarchar(200),
	@access nvarchar(max),
	@questiion smallint,
	@answer nvarchar(400),
	@email nvarchar(50),
	@mobile nvarchar(50),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Users]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[UserName] = @userName
		  ,[Password] = @pass
		  ,[Access] = @access
		  ,[SecurityQuestion] = @questiion
		  ,[AnswerQuestion] = @answer
		  ,[Email] = @email
		  ,[Mobile] = @mobile
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Users]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[UserName]
           ,[Password]
           ,[Access]
           ,[SecurityQuestion]
           ,[AnswerQuestion]
           ,[Email]
           ,[Mobile]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@userName
           ,@pass
           ,@access
           ,@questiion
           ,@answer
           ,@email
           ,@mobile
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Users
	set Status=@st
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_CheckUserName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_CheckUserName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_CheckUserName
	@guid uniqueidentifier,
	@userName nvarchar(200)
AS
BEGIN
	select COUNT(*) from Users
	where UserName=@userName and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByUserName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByUserName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByUserName
	@userName nvarchar(200)
AS
BEGIN
	Select * from Users
	Where UserName=@userName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByEmail]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByEmail]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByEmail
	@email nvarchar(50)
AS
BEGIN
	Select * from Users
	Where Email=@email
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByMobile]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByMobile]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByMobile
	@mobile nvarchar(50)
AS
BEGIN
	Select * from Users
	Where Mobile=@mobile
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetAllByQuestion]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetAllByQuestion]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetAllByQuestion
	@question smallint,
	@answer nvarchar(400)
AS
BEGIN
	Select * from Users
	Where SecurityQuestion=@question and
		  AnswerQuestion=@answer
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAll] 
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Regions_SelectAll] 
AS
BEGIN
	Select Regions.*,P.Name As CityName, States.Name As StateName,StateGuid
	From Regions inner join Cities As P on
	Regions.CityGuid=P.Guid inner join States on
	P.StateGuid=States.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAllByCityGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAllByCityGuid]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Regions_SelectAllByCityGuid] 
	@cityGuid uniqueidentifier
AS
BEGIN
	Select Regions.*,P.Name As CityName, States.Name As StateName,StateGuid
	From Regions inner join Cities As P on
	Regions.CityGuid=P.Guid inner join States on
	P.StateGuid=States.Guid
	where Regions.CityGuid=@cityGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAllByStateGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAllByStateGuid]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAllByStateGuid] 
	@stateGuid uniqueidentifier
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	where Cities.StateGuid=@stateGuid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Buildings_SelectAll] 
AS
BEGIN
select [dbo].[Buildings].*,[dbo].[Peoples].Name As OwnerName,
       [dbo].[BuildingTypes].Name As BuildingTypeName,
	   [dbo].[Users].Name As UserName,
	   [dbo].[Regions].Name As RegionName,
	   [dbo].[RentalAuthorities].Name As RentalAuthorityName,
	   [dbo].[DocumentTypes].Name As DocumentTypeName,
	   [dbo].[BuildingConditions].Name As BuildingConditionName,
	   [dbo].[BuildingViews].Name As BuildingViewName,
	   [dbo].[FloorCovers].Name As FloorCoverName,
	   [dbo].[KitchenServices].Name As KitchenServiceName,
	   [dbo].[BuildingAccountTypes].Name As BuildingAccountTypeName
From [dbo].[Buildings] 
     inner join [dbo].[Peoples] on [dbo].[Buildings].OwnerGuid=[dbo].[Peoples].Guid
	 inner join [dbo].[BuildingTypes] on [dbo].[Buildings].BuildingTypeGuid=[dbo].[BuildingTypes].Guid
	 inner join [dbo].[Users] on [dbo].[Buildings].UserGuid=[dbo].[Users].Guid
	 inner join [dbo].[Regions] on [dbo].[Buildings].RegionGuid=[dbo].[Regions].Guid
	 inner join [dbo].[RentalAuthorities] on [dbo].[Buildings].RentalAutorityGuid=[dbo].[RentalAuthorities].Guid
	 inner join [dbo].[DocumentTypes] on [dbo].[Buildings].DocumentType=[dbo].[DocumentTypes].Guid
	 inner join [dbo].[BuildingConditions] on [dbo].[Buildings].BuildingConditionGuid=[dbo].[BuildingConditions].Guid
	 inner join [dbo].[BuildingViews] on [dbo].[Buildings].BuildingViewGuid=[dbo].[BuildingViews].Guid
	 inner join [dbo].[FloorCovers] on [dbo].[Buildings].FloorCoverGuid=[dbo].[FloorCovers].Guid
	 inner join [dbo].[KitchenServices] on [dbo].[Buildings].KitchenServiceGuid=[dbo].[KitchenServices].Guid
	 inner join [dbo].[BuildingAccountTypes] on [dbo].[Buildings].BuildingAccountTypeGuid=[dbo].[BuildingAccountTypes].Guid

	 Order By [dbo].[Buildings].CreateDate desc
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_FixImages]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_FixImages]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Building_FixImages]
AS
BEGIN
	UPDATE [Buildings] 
	SET Image = X.ImageName,Modified=GETDATE()
	FROM ( 
			SELECT top(1) ImageName FROM BuildingGalleries 
			where ISNULL(ImageName,'')<>''
		 ) AS X
	WHERE Buildings.Image is null or Buildings.Image=''
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingsReq_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingsReq_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_BuildingsReq_SelectAll] 
AS
BEGIN
select [dbo].[BuildingRequests].*,[dbo].[Peoples].Name As AskerName,
	   [dbo].[Users].Name As UserName
	   From [dbo].[BuildingRequests] 
	   inner join [dbo].[Peoples] on [dbo].[BuildingRequests].AskerGuid=[dbo].[Peoples].Guid
	   inner join [dbo].[Users] on [dbo].[BuildingRequests].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_SelectAll_ByUser_And_Date]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_SelectAll_ByUser_And_Date]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_UserLog_SelectAll_ByUser_And_Date] 
	@userGuid uniqueidentifier,
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	select [dbo].[UserLogs].*,[dbo].[Users].Name as UserName
	from [dbo].[UserLogs] inner join [dbo].[Users]
	on [dbo].[UserLogs].UserGuid=[dbo].[Users].Guid
	where Date>=@date1 and Date<=@date2 and UserGuid=@userGuid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Note_SelectAll] 
AS
BEGIN
	select [dbo].[Notes].*,[dbo].[Users].Name as UserName
	from [dbo].[Notes] inner join [dbo].[Users]
	on [dbo].[Notes].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Gardesh_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Gardesh_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Gardesh_SelectAll] 
AS
BEGIN
	select * from [dbo].[GardeshHesabs]
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_SmsLog_SelectAll] 
AS
BEGIN
	select [dbo].[SmsLogs].*,[dbo].[Users].Name As UserName
	from [dbo].[SmsLogs] inner join [dbo].[Users]
	on [dbo].[SmsLogs].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Save]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_Save]
	@Guid uniqueidentifier,
	@modif datetime,
	@code bigint,
	@isTemp bit,
	@term int,
	@fromDate datetime,
	@totalPrice bigint=0,
	@minorPrice bigint=0,
	@checkNo nvarchar(200)='',
	@bankName nvarchar(200)='',
	@shobe nvarchar(200)='',
	@sareresid nvarchar(20)='',
	@discharcgDate datetime,
	@setDocDate datetime,
	@setDocPlace nvarchar(500)='',
	@sarqofli bigint=0,
	@delay bigint=0,
	@desc nvarchar(Max)='',
	@userGuid uniqueidentifier,
	@buGuid uniqueidentifier,
	@type smallint,
	@dateM datetime,
	@bazaryabGuid uniqueidentifier=null,
	@bazaryabPrice bigint=0,
	@fSideGuid uniqueidentifier,
	@sSideGuid uniqueidentifier,
	@sanadNumber bigint,
	@fBabat smallint,
	@sBabat smallint,
	@fDiscount decimal,
	@sDiscount decimal,
	@fTax decimal,
	@sTax decimal,
	@fAvarez decimal,
	@sAvarez decimal,
	@fTotalPrice decimal,
	@sTotalPrice decimal,
	@serverSt smallint,
	@serverDate datetime,
	@codeInArchive nvarchar(100)
AS
BEGIN	
	 update Buildings
	 set IsArchive='true'
	 where Guid=@buGuid

	 UPDATE [dbo].[Contracts]
	   SET [Modified] = @modif
		  ,[Code] = @code
		  ,[IsTemp] = @isTemp
		  ,[FirstSideGuid] = @fSideGuid
		  ,[SecondSideGuid] = @sSideGuid
		  ,[Term] = @term
		  ,[FromDate] = @fromDate
		  ,[TotalPrice] = @totalPrice
		  ,[MinorPrice] = @minorPrice
		  ,[CheckNo] = @checkNo
		  ,[BankName] = @bankName
		  ,[Shobe] = @shobe
		  ,[SarResid] = @sareresid
		  ,[DischargeDate] = @discharcgDate
		  ,[SetDocDate] = @SetDocDate
		  ,[SetDocPlace] = @SetDocPlace
		  ,[SarQofli] = @SarQofli
		  ,[Delay] = @Delay
		  ,[Description] = @desc
		  ,[BuildingGuid] = @buGuid
		  ,[Type] = @type
		  ,[DateM] = @dateM
		  ,[BazaryabGuid] = @bazaryabGuid
		  ,[BazaryabPrice] = @bazaryabPrice
		  ,[SanadNumber] = @sanadNumber
		  ,[fBabat] = @fBabat
		  ,[sBabat] = @sBabat
		  ,[FirstDiscount] = @fDiscount
		  ,[SecondDiscount] = @sDiscount
		  ,[FirstTax] = @fTax
		  ,[FirstAvarez] = @fAvarez
		  ,[SecondTax] = @sTax
		  ,[SecondAvarez] = @sAvarez
		  ,[FirstTotalPrice] = @fTotalPrice
		  ,[SecondTotalPrice] = @sTotalPrice
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		  ,[CodeInArchive] = @codeInArchive
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Contracts]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Code]
           ,[IsTemp]
           ,[FirstSideGuid]
           ,[SecondSideGuid]
           ,[Term]
           ,[FromDate]
           ,[TotalPrice]
           ,[MinorPrice]
           ,[CheckNo]
           ,[BankName]
           ,[Shobe]
           ,[SarResid]
           ,[DischargeDate]
           ,[SetDocDate]
           ,[SetDocPlace]
           ,[SarQofli]
           ,[Delay]
           ,[Description]
           ,[UserGuid]
           ,[BuildingGuid]
           ,[Type]
           ,[DateM]
           ,[BazaryabGuid]
           ,[BazaryabPrice]
           ,[SanadNumber]
           ,[fBabat]
           ,[sBabat]
           ,[FirstDiscount]
           ,[SecondDiscount]
           ,[FirstTax]
           ,[FirstAvarez]
           ,[SecondTax]
           ,[SecondAvarez]
           ,[FirstTotalPrice]
           ,[SecondTotalPrice]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate]
		   ,[CodeInArchive])
		VALUES
           (@Guid
           ,@modif
           ,'true'
           ,@code
           ,@isTemp
           ,@fSideGuid
           ,@sSideGuid
           ,@term
           ,@fromDate
           ,@totalPrice
           ,@minorPrice
           ,@checkNo
           ,@bankName
           ,@shobe
           ,@sareresid
           ,@discharcgDate
           ,@setDocDate
           ,@setDocPlace
           ,@sarqofli
           ,@delay
           ,@desc
           ,@userGuid
           ,@buGuid
           ,@type
           ,@dateM
           ,@bazaryabGuid
           ,@bazaryabPrice
           ,@sanadNumber
           ,@fBabat
           ,@sBabat
           ,@fDiscount
           ,@sDiscount
           ,@fTax
           ,@fAvarez
           ,@sTax
           ,@sAvarez
           ,@fTotalPrice
           ,@sTotalPrice
		   ,@serverSt
		   ,@serverDate
		   ,@codeInArchive)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_GetAll
AS
BEGIN
	Select * from [dbo].[Temps]
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_Save
	@guid uniqueidentifier,
	@type smallint,
	@objGuid uniqueidentifier
AS
BEGIN
	insert into [dbo].[Temps](
		 Guid
		,ObjectGuid
		,Type)
		values(
		 @guid
		,@objGuid
		,@type)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Remove]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Temp_Remove
	@guid uniqueidentifier
AS
BEGIN
	Delete from [dbo].[Temps]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Count
	@userGuid uniqueidentifier,
	@type smallint
AS
BEGIN
	declare @count int
	if(@userGuid='00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings)
		select @count
		return @count
	end
	else if(@userGuid<>'00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings where UserGuid=@userGuid)
		select @count
		return @count
	end
	else if(@type=1) --Rahn
	begin
		set @count=(select COUNT(*) from Buildings where RahnPrice1>0 or RahnPrice2>0 or EjarePrice1>0 or EjarePrice2>0)
		select @count
		return @count
	end
	else if(@type=2) --Foroush
	begin
		set @count=(select COUNT(*) from Buildings where SellPrice>0)
		select @count
		return @count
	end	
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_Count
	@userGuid uniqueidentifier
AS
BEGIN
	declare @count int
	set @count = (select COUNT(*)
					from Contracts
					where UserGuid=@userGuid)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Requests_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Requests_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Requests_Count	
	@userGuid uniqueidentifier
AS
BEGIN	
	declare @count int
	if (@userGuid='00000000-0000-0000-0000-000000000000')
	begin
		set @count=(select COUNT(*) from BuildingRequests)
		select @count
		return @count
	end
	else 
	begin
		set @count=(select COUNT(*) from BuildingRequests where UserGuid=@userGuid)
		select @count
		return @count
	end

END
GO
-- =================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Discharge_Count
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	
	declare @count int
	set @count = (select COUNT(*) from Contracts where 
					DATEADD(month, Term, FromDate)>=@date1 and 
					DATEADD(month, Term, FromDate)<=@date2)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_List]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_List]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Building_Discharge_List]
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	select  Contracts.Code As Code,
			Tafsils.Name As FirstSideName,
			Contracts.FirstSideGuid As FirstSideGuid,
			Contracts.SecondSideGuid As SecondSideGuid,
			P.Name As SecondSideName,
			Contracts.Term As Term,
			Contracts.FromDate As FromDate,
			DATEADD(month, Contracts.Term, Contracts.FromDate) As ToDate,
			Buildings.Code As BuildingCode,
			BuildingGuid
			from [dbo].[Contracts] left Outer join [dbo].[Tafsils] on 
				 [dbo].[Contracts].FirstSideGuid=[dbo].[Tafsils].Guid inner join Buildings on
				 [dbo].[Contracts].BuildingGuid=Buildings.Guid inner join Tafsils As P on
				 [dbo].[Contracts].SecondSideGuid=P.Guid
			where  DATEADD(month, Term, FromDate)>=@d1 and 
				   DATEADD(month, Term, FromDate)<=@d2
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_Insert]	As Begin print 11 end')
GO
Alter PROCEDURE sp_UserLog_Insert
	@guid uniqueidentifier,
	@userGuid uniqueidentifier,
	@date datetime,
	@action smallint,
	@part smallint,
	@desc nvarchar(max)
AS
BEGIN	
	insert into [dbo].[UserLogs](
			 Guid
			,UserGuid
			,Date
			,Action
			,Part
			,Description)
			values(
			 @guid
			,@userGuid
			,@date
			,@action
			,@part
			,@desc)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOptions_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOptions_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRelatedOptions_GetAll	
	@buGuid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingRelatedOptions]
	where BuildinGuid=@buGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRequestRegion_GetAll
	@reqGuid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingRequestRegions]
	where RequestGuid=@reqGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_GetAllByParentGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_GetAllByParentGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_GetAllByParentGuid
	@pGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[PhoneBooks]
	where ParentGuid=@pGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_Get
	@guid uniqueidentifier
AS
BEGIN
	select * From PhoneBooks
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_GetAll
AS
BEGIN
	Select * From PhoneBooks
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Remove]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete From PhoneBooks
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_RemoveByParentGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_RemoveByParentGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_RemoveByParentGuid
	@parentGuid uniqueidentifier
AS
BEGIN
	delete From PhoneBooks
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update PhoneBooks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_ChangeStatusByParenGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_ChangeStatusByParenGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_ChangeStatusByParenGuid
	@parentGuid uniqueidentifier,
	@st bit
AS
BEGIN
	update PhoneBooks
	set Status=@st
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Save]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_PhoneBook_Save]
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(500),
	@tell nvarchar(50),
	@group smallint,
	@parentGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime,
	@title nvarchar(200)
AS
BEGIN
	UPDATE [dbo].[PhoneBooks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Tell] = @tell
		  ,[Group] = @group
		  ,[ParentGuid] = @parentGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		  ,[Title] = @title
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[PhoneBooks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Tell]
           ,[Group]
           ,[ParentGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate]
		   ,[Title])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@name
           ,@tell
           ,@group
           ,@parentGuid
		   ,@serverSt
		   ,@serverDate
		   ,@title)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_GetAllByParent]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_GetAllByParent]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_GetAllByParent
	@pGuid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[PeopleBankAccounts]
	where ParentGuid=@pGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_RemoveByParent]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_RemoveByParent]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_RemoveByParent
	@parentGuid uniqueidentifier
AS
BEGIN
	delete from PeopleBankAccounts
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_Save
	@guid uniqueidentifier,
	@parentGuid uniqueidentifier,
	@bankname nvarchar(200),
	@accountNumber nvarchar(200),
	@shobe nvarchar(200)
AS
BEGIN
	UPDATE [dbo].[PeopleBankAccounts]
	   SET [BankName] = @bankname
		  ,[AccountNumber] = @accountNumber
		  ,[Shobe] = @shobe
		  ,[ParentGuid] = @parentGuid
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[PeopleBankAccounts]
           ([Guid]
           ,[BankName]
           ,[AccountNumber]
           ,[Shobe]
           ,[ParentGuid])
		 VALUES
           (@guid
           ,@bankname
           ,@accountNumber
           ,@shobe
           ,@parentGuid)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingGallery_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingGallery_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingGallery_GetAll
	@buGuid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingGalleries]
	where BuildingGuid=@buGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Setting_Get
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[Settings]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByName
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_GetByGuid]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Buildings_GetByGuid]
	@guid uniqueidentifier
AS
BEGIN
	select [dbo].[Buildings].*,[dbo].[Peoples].Name As OwnerName,
       [dbo].[BuildingTypes].Name As BuildingTypeName,
	   [dbo].[Users].Name As UserName,
	   [dbo].[Regions].Name As RegionName,
	   [dbo].[RentalAuthorities].Name As RentalAuthorityName,
	   [dbo].[DocumentTypes].Name As DocumentTypeName,
	   [dbo].[BuildingConditions].Name As BuildingConditionName,
	   [dbo].[BuildingViews].Name As BuildingViewName,
	   [dbo].[FloorCovers].Name As FloorCoverName,
	   [dbo].[KitchenServices].Name As KitchenServiceName,
	   [dbo].[BuildingAccountTypes].Name As BuildingAccountTypeName
From [dbo].[Buildings] 
     inner join [dbo].[Peoples] on [dbo].[Buildings].OwnerGuid=[dbo].[Peoples].Guid
	 inner join [dbo].[BuildingTypes] on [dbo].[Buildings].BuildingTypeGuid=[dbo].[BuildingTypes].Guid
	 inner join [dbo].[Users] on [dbo].[Buildings].UserGuid=[dbo].[Users].Guid
	 inner join [dbo].[Regions] on [dbo].[Buildings].RegionGuid=[dbo].[Regions].Guid
	 inner join [dbo].[RentalAuthorities] on [dbo].[Buildings].RentalAutorityGuid=[dbo].[RentalAuthorities].Guid
	 inner join [dbo].[DocumentTypes] on [dbo].[Buildings].DocumentType=[dbo].[DocumentTypes].Guid
	 inner join [dbo].[BuildingConditions] on [dbo].[Buildings].BuildingConditionGuid=[dbo].[BuildingConditions].Guid
	 inner join [dbo].[BuildingViews] on [dbo].[Buildings].BuildingViewGuid=[dbo].[BuildingViews].Guid
	 inner join [dbo].[FloorCovers] on [dbo].[Buildings].FloorCoverGuid=[dbo].[FloorCovers].Guid
	 inner join [dbo].[KitchenServices] on [dbo].[Buildings].KitchenServiceGuid=[dbo].[KitchenServices].Guid
	 inner join [dbo].[BuildingAccountTypes] on [dbo].[Buildings].BuildingAccountTypeGuid=[dbo].[BuildingAccountTypes].Guid

	where Buildings.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_States_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_States_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_States_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From States
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Cities_Get
	@guid uniqueidentifier
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	where Cities.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_Get
	@guid uniqueidentifier
AS
BEGIN
	Select Regions.*,P.Name As CityName, States.Name As StateName,StateGuid
	From Regions inner join Cities As P on
		 Regions.CityGuid=P.Guid inner join States on
		 P.StateGuid=States.Guid
	Where Regions.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From PeopleGroups
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Hazine_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Hazine_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Hazine_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From Hazines
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingAccountType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingAccountTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingCondition_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingConditions
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingView_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingViews
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DocumentType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From DocumentTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_FloorCover_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from FloorCovers
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_KitchenService_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from KitchenServices
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_RentalAuthority_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_RentalAuthority_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_RentalAuthority_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from RentalAuthorities
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequest_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequest_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRequest_Get
	@guid uniqueidentifier
AS
BEGIN
select [dbo].[BuildingRequests].*,[dbo].[Peoples].Name As AskerName,
	   [dbo].[Users].Name As UserName
	   From [dbo].[BuildingRequests] 
	   inner join [dbo].[Peoples] on [dbo].[BuildingRequests].AskerGuid=[dbo].[Peoples].Guid
	   inner join [dbo].[Users] on [dbo].[BuildingRequests].UserGuid=[dbo].[Users].Guid
	   where BuildingRequests.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_GardeshHesab_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_GardeshHesab_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_GardeshHesab_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from GardeshHesabs
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_GetByName
	@name nvarchar(200)
AS
BEGIN
	Select Regions.*,P.Name As CityName, States.Name As StateName,StateGuid
	From Regions inner join Cities As P on
	Regions.CityGuid=P.Guid inner join States on
	P.StateGuid=States.Guid
	Where Regions.Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_GetByName
	@name nvarchar(250)
AS
BEGIN
	Select * From PeopleGroups
	Where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingType_GetByName
	@name nvarchar(200)
AS
BEGIN
	Select * From BuildingTypes
	Where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_RentalAuthority_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_RentalAuthority_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_RentalAuthority_GetByName
	@name nvarchar(200)
AS
BEGIN
	SELECT * from RentalAuthorities
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetTotalCommition]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetTotalCommition]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetTotalCommition
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Sum1 decimal
	declare @Sum2 decimal

	declare @dis1 decimal
	declare @dis2 decimal

	declare @SumRet1 decimal
	declare @SumRet2 decimal

	declare @Total decimal
	set @Total=0

	set @dis1=(select SUM(FirstDiscount) from Contracts 
				where Contracts.DateM between @d1 and @d2)

	set @dis2=(select SUM(SecondDiscount) from Contracts 
				where Contracts.DateM between @d1 and @d2)

	set @Sum1=(select SUM(FirstTotalPrice) from Contracts
				where Contracts.DateM between @d1 and @d2)

	set @Sum2=(select SUM(SecondTotalPrice) from Contracts
				where Contracts.DateM between @d1 and @d2)

	set @SumRet1=@Sum1-@dis1
	set @SumRet2=@Sum2-@dis2

	set @Total=@SumRet1+@SumRet2

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetTotalTax]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetTotalTax]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetTotalTax
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Sum1 decimal
	declare @Sum2 decimal

	declare @Total decimal
	set @Total=0

	
	set @Sum1=(select SUM(FirstTax) from Contracts 
				where Contracts.DateM between @d1 and @d2)

	set @Sum2=(select SUM(SecondTax) from Contracts
				where Contracts.DateM between @d1 and @d2)

	set @Total=@Sum1+@Sum2

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetTotalBazaryab]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetTotalBazaryab]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetTotalBazaryab
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Total decimal
	set @Total=0

	
	set @Total=(select SUM(BazaryabPrice) from Contracts 
				where Contracts.DateM between @d1 and @d2)

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Hazine_GetTotal]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Hazine_GetTotal]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Hazine_GetTotal
	@d1 datetime,
	@d2 datetime,
	@hazineGuid uniqueidentifier
AS
BEGIN
	declare @Total decimal
	set @Total=0

	
	set @Total=(select SUM(Price) from GardeshHesabs
				where Status='true' and Modified between @d1 and @d2
				and PeopleGuid=@hazineGuid)

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_SelectAll]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_DasteCheck_SelectAll]
AS
BEGIN
	Select DasteChecks.*,Tafsils.Name As BankName
	From DasteChecks inner join Tafsils
	on Tafsils.Guid=DasteChecks.BankGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select DasteChecks.*,Tafsils.Name As BankName
	From DasteChecks inner join Tafsils
	on Tafsils.Guid=DasteChecks.BankGuid
	where DasteChecks.Guid = @Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update DasteChecks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@serial nvarchar(100),
	@bankGuid uniqueidentifier,
	@fNumber bigint,
	@toNumber bigint,
	@desc nvarchar(Max),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[DasteChecks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[SerialNumber] = @serial
		  ,[BankGuid] = @bankGuid
		  ,[FromNumber] = @fNumber
		  ,[ToNumber] = @toNumber
		  ,[Description] = @desc
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[DasteChecks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[SerialNumber]
           ,[BankGuid]
           ,[FromNumber]
           ,[ToNumber]
           ,[Description]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@serial
           ,@bankGuid
           ,@fNumber
           ,@toNumber
           ,@desc
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_SelectAll
	@Guid uniqueidentifier
AS
BEGIN
	select * from CheckPages
	where CheckGuid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	select * from CheckPages
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_Save]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_CheckPage_Save]
	@Guid uniqueidentifier,
	@modif datetime,
	@CheckGuid uniqueidentifier,
	@datePardakht datetime=null,
	@number bigint,
	@receptorGuid uniqueidentifier=null,
	@sarresid datetime=null,
	@desc nvarchar(max),
	@price decimal,
	@st int,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[CheckPages]
	   SET [Modified] = @modif
		  ,[CheckGuid] = @CheckGuid
		  ,[DatePardakht] = @datePardakht
		  ,[Number] = @number
		  ,[ReceptorGuid] = @receptorGuid
		  ,[DateSarresid] = @sarresid
		  ,[Description] = @desc
		  ,[Price] = @price
		  ,[CheckStatus] = @st
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[CheckPages]
           ([Guid]
           ,[Modified]
           ,[CheckGuid]
           ,[DatePardakht]
           ,[Number]
           ,[ReceptorGuid]
           ,[DateSarresid]
           ,[Description]
           ,[Price]
           ,[CheckStatus]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@Guid
           ,@modif
           ,@CheckGuid
           ,@datePardakht
           ,@number
           ,@receptorGuid
           ,@sarresid
           ,@desc
           ,@price
           ,@st
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_RemoveAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_RemoveAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_RemoveAll
	@Guid uniqueidentifier
AS
BEGIN
	Delete from CheckPages
	where CheckGuid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_GetAll
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_SelectRowBuGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_SelectRowBuGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_SelectRowBuGuid
	@guid uniqueidentifier
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
	where Sanads.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_SelectRowBuNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_SelectRowBuNumber]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_SelectRowBuNumber
	@number bigint
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
	where Number=@number
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_Save
	@guid uniqueidentifier,
	@dateM datetime,
	@modif datetime,
	@desc nvarchar(max),
	@number bigint,
	@sanadst smallint,
	@userGuid uniqueidentifier,
	@sanadType smallint,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Sanads]
	   SET [Modified] = @modif
		  ,[DateM] = @dateM
		  ,[Description] = @desc
		  ,[Number] = @number
		  ,[SanadStatus] = @sanadst
		  ,[SanadType] = @sanadType
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Sanads]
           ([Guid]
           ,[Modified]
           ,[DateM]
           ,[Description]
           ,[Number]
           ,[SanadStatus]
           ,[UserGuid]
           ,[SanadType]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		 VALUES
           (@guid
           ,@modif
           ,@dateM
           ,@desc
           ,@number
           ,@sanadst
           ,@userGuid
           ,@sanadType
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Remove]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Sanads
	where Guid = @guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_GetAllByMaster]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	Select    SanadDetails.*
			, Moeins.Code As MoeinCode
			, Moeins.Name As MoeinName
			, Tafsils.Code As TafsilCode
			, Tafsils.Name As TafsilName
	from SanadDetails inner join Moeins on
		 SanadDetails.MoeinGuid = Moeins.Guid
		 inner join Tafsils on
		 SanadDetails.TafsilGuid = Tafsils.Guid
	where MasterGuid=@masterGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@moeinGuid uniqueidentifier,
	@tafsilGuid uniqueidentifier,
	@debit decimal,
	@credit decimal,
	@desc nvarchar(Max),
	@masterGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[SanadDetails]
	   SET [Modified] = @modif
		  ,[MoeinGuid] = @moeinGuid
		  ,[TafsilGuid] = @tafsilGuid
		  ,[Debit] = @debit
		  ,[Credit] = @credit
		  ,[Description] = @desc
		  ,[MasterGuid] = @masterGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@Guid
           ,@modif
           ,@moeinGuid
           ,@tafsilGuid
           ,@debit
           ,@credit
           ,@desc
           ,@masterGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_RemoveByMasterGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_RemoveByMasterGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_RemoveByMasterGuid
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from SanadDetails
	where MasterGuid = @masterGuid
END
GO
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Credit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Credit]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Tafsil_Credit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid ='00000000-0000-0000-0000-000000000000' return

	update Tafsils
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Debit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Debit]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Tafsil_Debit 
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return

	update Tafsils
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Credit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Credit]	As Begin print 11 end')  
GO

Alter PROCEDURE sp_Moein_Credit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return
	
	update Moeins
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@Guid

	declare @kolGuid uniqueidentifier
	set @kolGuid=(select KolGuid From Moeins where Guid=@Guid)

	update Kols
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@kolGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Debit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Debit]	As Begin print 11 end')  
GO

Alter PROCEDURE sp_Moein_Debit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return
	
	update Moeins
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@Guid

	declare @kolGuid uniqueidentifier
	set @kolGuid=(select KolGuid From Moeins where Guid=@Guid)

	update Kols
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@kolGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Update_Eftetahie]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Update_Eftetahie]	As Begin print 11 end')  
GO

ALTER PROCEDURE [dbo].[sp_Sanad_Update_Eftetahie]
	@userGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditTafilGuid uniqueidentifier,
	@sandouqCreditTafilGuid uniqueidentifier
AS
BEGIN
	declare @materGuid uniqueidentifier
	
	set @materGuid=(select Guid from Sanads where Number=1)
	if (@materGuid is null or @materGuid='00000000-0000-0000-0000-000000000000')
	begin
		set @materGuid=NEWID()
		declare @date datetime
		set @date=GETDATE()
		exec sp_Sanad_Save @materGuid,'true',@date,@date,N'سند افتتاحیه',1,1,@userGuid,1
	end

	Delete From SanadDetails
	where MasterGuid=@materGuid

	INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid])
		   --حسابهای دریافتنی ابتدای دوره - بستانکاران
			select    NEWID() As Guid
					, Tafsils.Modified
					, @tafsilCreditMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, 0 As Debit
					, AccountFirst As Credit
					, N'حسابهای دریافتنی ابتدای دوره ('+Tafsils.Name+')' As Description
					, @materGuid As MasterGuid
			from Tafsils where AccountFirst > 0 
						 and Tafsils.Status='true'
						 and (HesabType=2 or HesabType=6)
	union all
		--حسابهای دریافتنی ابتدای دوره - بدهکاران
		select    NEWID() As Guid
				, Tafsils.Modified
				, @tafsilCreditMoeinGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N'حسابهای دریافتنی ابتدای دوره ('+Tafsils.Name+')' As Description
				, @materGuid As MasterGuid
		from Tafsils where AccountFirst < 0 
						 and Tafsils.Status='true'
						 and (HesabType=2 or HesabType=6)
	union all
		--موجودی ابتدای دوره بانک ها
		select    NEWID() As Guid
				, Tafsils.Modified
				, @bankCreditTafilGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N' موجودی ابتدای دوره بانک('+Banks.Name+' '+Banks.Shobe+')' As Description
				, @materGuid As MasterGuid
		from Tafsils inner join Banks on
			 Tafsils.Guid=Banks.Guid
			 where AccountFirst < 0 and Tafsils.Status='true'
	union all
		--موجودی ابتدای دوره صندوق ها
		select    NEWID() As Guid
				, Tafsils.Modified
				, @sandouqCreditTafilGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N' موجودی ابتدای دوره صندوق('+Name+')' As Description
				, @materGuid As MasterGuid
		from Tafsils where AccountFirst < 0
					 and HesabType = 5
					 and Tafsils.Status='true'
	union all
		--اسناد دریافتنی ابتدای دوره
		select    NEWID() As Guid
				, ReceptionCheckAvalDores.Modified
				, CAST('215e08ec-253d-4a10-a217-2462d8600226' as uniqueidentifier) As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ReceptionCheckAvalDores.Price As Debit
				, 0 As Credit
				, N'چکهای دریافتنی ابتدای دوره' As Description
				, @materGuid As MasterGuid
		from ReceptionCheckAvalDores inner join Tafsils on
			 ReceptionCheckAvalDores.SandouqTafsilGuid=Tafsils.Guid
	union all
		--اسناد پرداختنی ابتدای دوره
		select    NEWID() As Guid
				, PardakhtCheckAvalDores.Modified
				, CAST('814d8ac1-bae2-465c-9ed4-865838ec064b' As uniqueidentifier) As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, 0 As Debit
				, CheckPages.Price As Credit
				, N'اسناد پرداختنی ابتدای دوره' As Description
				, @materGuid As MasterGuid
		from PardakhtCheckAvalDores inner join CheckPages on
			 PardakhtCheckAvalDores.CheckPageGuid=CheckPages.Guid inner join DasteChecks on
			 CheckPages.CheckGuid=DasteChecks.Guid inner join Tafsils on
			 DasteChecks.BankGuid=Tafsils.Guid

	declare @Sum Decimal(18,3)
	set @Sum=(select sum(Credit-Debit)
				from [SanadDetails]
				where MasterGuid=@materGuid)
	set @Sum=ISNULL(@Sum,0)

	if @Sum>0
	begin
		INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid])
			--سرمایه ابتدای دوره بستانکار
			select    NEWID() As Guid
					, Tafsils.Modified
					, @sarmayeMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, ABS(@Sum) As Debit
					, 0 As Credit
					, N'سرمایه ابتدای دوره' As Description
					, @materGuid As MasterGuid
			from Tafsils where Guid = @sarmayeTafsilGuid
	end
	else if @Sum<0
	begin
		INSERT INTO [dbo].[SanadDetails]
			   ([Guid]
			   ,[Modified]
			   ,[MoeinGuid]
			   ,[TafsilGuid]
			   ,[Debit]
			   ,[Credit]
			   ,[Description]
			   ,[MasterGuid])
			--سرمایه ابتدای دوره بدهکار
			select    NEWID() As Guid
					, Tafsils.Modified
					, @sarmayeMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, 0 As Debit
					, ABS(@Sum) As Credit
					, N'سرمایه ابتدای دوره' As Description
					, @materGuid As MasterGuid
			from Tafsils where Guid = @sarmayeTafsilGuid
	end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_NextNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_NextNumber]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Sanad_NextNumber]
AS
BEGIN
	declare @nextNumber bigint
	select @nextNumber = MAX(Number) From Sanads
	set @nextNumber = (isnull(@nextNumber , 0))
	set @nextNumber = @nextNumber + 1
	select @nextNumber
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_CheckCode]	As Begin print 11 end')  
GO
Alter PROCEDURE [dbo].[sp_Sanad_CheckCode]
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Sanads
	where Number=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_GetAll
AS
BEGIN
	select Receptions.*, Tafsils.Name As TafsilName, Users.Name As UserName
	from Receptions inner join Tafsils on
	Receptions.TafsilGuid=Tafsils.Guid
	inner join Users on
	Receptions.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_GetByGuid]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_GetByGuid
	@Guid uniqueidentifier
AS
BEGIN
	select Receptions.*, Tafsils.Name As TafsilName, Users.Name As UserName
	from Receptions inner join Tafsils on
	Receptions.TafsilGuid=Tafsils.Guid
	inner join Users on
	Receptions.UserGuid=Users.Guid
	where Receptions.Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_NextCode]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_NextCode
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Number) From Receptions
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_CheckCode]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_CheckCode
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Receptions
	where Number=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Reception_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@number bigint,
	@desc nvarchar(max),
	@dateM datetime,
	@tafsilGuid uniqueidentifier,
	@moeinGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sanadNumber bigint,
	@serverSt smallint,
	@serverDate datetime,
	@sumCheck decimal,
	@sumHavale decimal,
	@sumNaqd decimal,
	@sum decimal
AS
BEGIN
	UPDATE [dbo].[Receptions]
	   SET [Modified] = @modif
		  ,[Description] = @desc
		  ,[Number] = @number
		  ,[DateM] = @dateM
		  ,[TafsilGuid] = @tafsilGuid
		  ,[MoeinGuid] = @moeinGuid
		  ,[SanadNumber] = @sanadNumber
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		  ,[SumCheck] = @sumCheck
		  ,[SumHavale] = @sumHavale
		  ,[SumNaqd] = @sumNaqd
		  ,[Sum] = @sum
	 WHERE Guid=@guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Receptions]
           ([Guid]
           ,[Modified]
           ,[Description]
           ,[Number]
           ,[DateM]
           ,[TafsilGuid]
           ,[MoeinGuid]
           ,[UserGuid]
           ,[SanadNumber]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate]
		   ,[SumCheck]
		   ,[SumHavale]
		   ,[SumNaqd]
		   ,[Sum])
		VALUES
           (@guid
           ,@modif
           ,@desc
           ,@number
           ,@dateM
           ,@tafsilGuid
           ,@moeinGuid
           ,@userGuid
           ,@sanadNumber
		   ,@serverSt
		   ,@serverDate
		   ,@sumCheck
		   ,@sumHavale
		   ,@sumNaqd
		   ,@sum)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Receptions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionChecks
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_Get
	@Guid uniqueidentifier
AS
BEGIN
	select * from ReceptionChecks
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from ReceptionChecks
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_Insert]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_ReceptionCheck_Insert]
	@guid uniqueidentifier,
	@modif datetime,
	@bankName nvarchar(200),
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier=null,
	@checkNumber nvarchar(200),
	@poshtNomre nvarchar(200),
	@price decimal,
	@checkStatus int,
	@sarResid datetime,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier,
	@isAvalDore bit,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[ReceptionChecks]
	   SET [Modified] = @modif
		  ,[BankName] = @bankName
		  ,[DateM] = @dateM
		  ,[MasterGuid] = @masterGuid
		  ,[Description] = @desc
		  ,[CheckNumber] = @checkNumber
		  ,[PoshtNomre] = @poshtNomre
		  ,[Price] = @price
		  ,[CheckStatus] = @checkStatus
		  ,[DateSarResid] = @sarResid
		  ,[SandouqTafsilGuid] = @sandouqTafsilGuid
		  ,[SandouqMoeinGuid] = @sandouqMoeinGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[ReceptionChecks]
          ([Guid]
          ,[Modified]
          ,[BankName]
          ,[DateM]
          ,[MasterGuid]
          ,[Description]
          ,[CheckNumber]
          ,[PoshtNomre]
          ,[Price]
          ,[CheckStatus]
		  ,[DateSarResid]
		  ,[SandouqTafsilGuid]
		  ,[SandouqMoeinGuid]
		  ,[isAvalDore]
		  ,[ServerStatus]
		  ,[ServerDeliveryDate])
	VALUES
          (@guid
          ,@modif
          ,@bankName
          ,@dateM
          ,@masterGuid
          ,@desc
          ,@checkNumber
          ,@poshtNomre
          ,@price
          ,@checkStatus
		  ,@sarResid
		  ,@sandouqTafsilGuid
		  ,@sandouqMoeinGuid
		  ,@isAvalDore
		  ,@serverSt
		  ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	Delete from ReceptionNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier,
	@price decimal,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	INSERT INTO [dbo].[ReceptionNaqds]
           ([Guid]
           ,[Modified]
           ,[DateM]
           ,[MasterGuid]
           ,[Description]
           ,[Price]
           ,[SandouqTafsilGuid]
           ,[SandouqMoeinGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
     VALUES
           (@guid
           ,@modif
           ,@dateM
           ,@masterGuid
           ,@desc
           ,@price
           ,@sandouqTafsilGuid
           ,@sandouqMoeinGuid
		   ,@serverSt
		   ,@serverDate)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from ReceptionHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier,
	@price decimal,
	@peygiriNo nvarchar(200),
	@bankTafsilGuid uniqueidentifier,
	@bankMoeinGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	INSERT INTO [dbo].[ReceptionHavales]
           ([Guid]
           ,[Modified]
           ,[DateM]
           ,[MasterGuid]
           ,[Description]
           ,[Price]
           ,[PeygiriNumber]
           ,[BankTafsilGuid]
           ,[BankMoeinGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
     VALUES
           (@guid
           ,@modif
           ,@dateM
           ,@masterGuid
           ,@desc
           ,@price
           ,@peygiriNo
           ,@bankTafsilGuid
           ,@bankMoeinGuid
		   ,@serverSt
		   ,@serverDate)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_GetByName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_GetByName
	@name nvarchar(200)
AS
BEGIN
	select * from BankSegests
	where BankName=@name
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_GetAll
AS
BEGIN
	select * from BankSegests
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_Insert
	@guid uniqueidentifier,
	@name nvarchar(200)
AS
BEGIN
	INSERT INTO [dbo].[BankSegests]
           ([Guid]
           ,[BankName])
     VALUES
           (@guid
           ,@name)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Pardakht_GetAll
AS
BEGIN
	Select Pardakhts.*,Tafsils.Name As TafsilName,
		   Moeins.Name As MoeinName, Users.Name As UserName
	from Pardakhts inner join Tafsils on
		 Pardakhts.TafsilGuid=Tafsils.Guid inner join Moeins on
		 Pardakhts.MoeinGuid=Moeins.Guid inner join Users on
		 Pardakhts.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_GetByGuid]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Pardakht_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select Pardakhts.*,Tafsils.Name As TafsilName,
		   Moeins.Name As MoeinName, Users.Name As UserName
	from Pardakhts inner join Tafsils on
		 Pardakhts.TafsilGuid=Tafsils.Guid inner join Moeins on
		 Pardakhts.MoeinGuid=Moeins.Guid inner join Users on
		 Pardakhts.UserGuid=Users.Guid
	where Pardakhts.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_NextCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Pardakht_NextCode]
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Number) From Pardakhts
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_CheckCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Pardakht_CheckCode]
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Pardakhts
	where Number=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Pardakht_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Pardakhts
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Pardakht_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@tafsilGuid uniqueidentifier,
	@moeinGuid uniqueidentifier,
	@dateM datetime,
	@desc nvarchar(max),
	@userGuid uniqueidentifier,
	@number bigint,
	@sanadNumber bigint,
	@serverSt smallint,
	@serverDate datetime,
	@sumCheckM decimal,
	@sumCheckSh decimal,
	@sumHavale decimal,
	@sumNaqd decimal,
	@sum decimal
AS
BEGIN
	UPDATE [dbo].[Pardakhts]
	   SET [Modified] = @modif
		  ,[TafsilGuid] = @tafsilGuid
		  ,[MoeinGuid] = @moeinGuid
		  ,[DateM] = @dateM
		  ,[Description] = @desc
		  ,[UserGuid] = @userGuid
		  ,[Number] = @number
		  ,[SanadNumber] = @sanadNumber
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		  ,[SumCheckMoshtari] = @sumCheckM
		  ,[SumCheckShakhsi] = @sumCheckSh
		  ,[SumHavale] = @sumHavale
		  ,[SumNaqd] = @sumNaqd
		  ,[Sum] = @sum
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Pardakhts]
           ([Guid]
           ,[Modified]
           ,[TafsilGuid]
           ,[MoeinGuid]
           ,[DateM]
           ,[Description]
           ,[UserGuid]
           ,[Number]
           ,[SanadNumber]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate]
		   ,[SumCheckMoshtari]
		   ,[SumCheckShakhsi]
		   ,[SumHavale]
		   ,[SumNaqd]
		   ,[Sum])
		VALUES
           (@guid
           ,@modif
           ,@tafsilGuid
           ,@moeinGuid
           ,@dateM
           ,@desc
           ,@userGuid
           ,@number
           ,@sanadNumber
		   ,@serverSt
		   ,@serverDate
		   ,@sumCheckM
		   ,@sumCheckSh
		   ,@sumHavale
		   ,@sumNaqd
		   ,@sum)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtNaqd_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtNaqd_GetAllByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtNaqd_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from PardakhtNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtNaqd_RemoveByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtNaqd_RemoveByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtNaqd_RemoveByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from PardakhtNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtNaqd_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtNaqd_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtNaqd_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@price decimal,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier,
	@masterGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	INSERT INTO [dbo].[PardakhtNaqds]
           ([Guid]
           ,[Modified]
           ,[Description]
           ,[Price]
           ,[SandouqTafsilGuid]
           ,[SandouqMoeinGuid]
           ,[MasterGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@desc
           ,@price
           ,@sandouqTafsilGuid
           ,@sandouqMoeinGuid
           ,@masterGuid
		   ,@serverSt
		   ,@serverDate)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtHavale_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtHavale_GetAllByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtHavale_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from PardakhtHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtHavale_RemoveByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtHavale_RemoveByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtHavale_RemoveByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from PardakhtHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtHavale_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtHavale_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtHavale_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@price decimal,
	@bankTafsilGuid uniqueidentifier,
	@bankMoeinGuid uniqueidentifier,
	@masterGuid uniqueidentifier,
	@peygiryNo nvarchar(200),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	INSERT INTO [dbo].[PardakhtHavales]
           ([Guid]
           ,[Modified]
           ,[MasterGuid]
           ,[Description]
           ,[Price]
           ,[BankTafsilGuid]
           ,[BankMoeinGuid]
		   ,[Number]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		 VALUES
           (@guid
           ,@modif
           ,@masterGuid
           ,@desc
           ,@price
           ,@bankTafsilGuid
           ,@bankMoeinGuid
		   ,@peygiryNo
		   ,@serverSt
		   ,@serverDate)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckSh_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckSh_GetAllByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckSh_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from PardakhtCheckShakhsis
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtChackSh_RemoveByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtChackSh_RemoveByMaster]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_PardakhtChackSh_RemoveByMaster]
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from PardakhtCheckShakhsis
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckSh_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckSh_Insert]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_PardakhtCheckSh_Insert]
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@checkGuid uniqueidentifier,
	@masterGuid uniqueidentifier,
	@sarresid datetime,
	@price decimal,
	@dateM datetime,
	@number nvarchar(200),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[PardakhtCheckShakhsis]
	   SET [Modified] = @modif
		  ,[DateSarResid] = @sarresid
		  ,[Description] = @desc
		  ,[Number] = @number
		  ,[Price] = @price
		  ,[DateM] = @dateM
		  ,[CheckPageGuid] = @checkGuid
		  ,[MasterGuid] = @masterGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[PardakhtCheckShakhsis]
           ([Guid]
           ,[Modified]
           ,[Description]
           ,[CheckPageGuid]
           ,[MasterGuid]
		   ,[DateSarResid]
		   ,[Price]
		   ,[DateM]
		   ,[Number]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
     VALUES
           (@guid
           ,@modif
           ,@desc
           ,@checkGuid
           ,@masterGuid
		   ,@sarresid
		   ,@price
		   ,@dateM
		   ,@number
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckM_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckM_GetAllByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckM_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	select PardakhtCheckMoshtaris.*,ReceptionChecks.Price
	from PardakhtCheckMoshtaris inner join ReceptionChecks on
	     PardakhtCheckMoshtaris.CheckGuid=ReceptionChecks.Guid
	where PardakhtCheckMoshtaris.MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtChackM_RemoveByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtChackM_RemoveByMaster]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtChackM_RemoveByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from PardakhtCheckMoshtaris
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckM_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckM_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckM_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@desc nvarchar(max),
	@checkGuid uniqueidentifier,
	@masterGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	INSERT INTO [dbo].[PardakhtCheckMoshtaris]
           ([Guid]
           ,[Modified]
           ,[Description]
           ,[CheckGuid]
           ,[MasterGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
     VALUES
           (@guid
           ,@modif
           ,@desc
           ,@checkGuid
           ,@masterGuid
		   ,@serverSt
		   ,@serverDate)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_GetAllFromView]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_GetAllFromView]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_ReceptionCheck_GetAllFromView]
AS
BEGIN
select        ReceptionChecks.Guid
			, ReceptionChecks.BankName
			, ReceptionChecks.DateM
			, ReceptionChecks.Description
			, ReceptionChecks.CheckNumber
			, ReceptionChecks.PoshtNomre
			, ReceptionChecks.Price
			, ReceptionChecks.CheckStatus
			, ReceptionChecks.DateSarResid
			, Tafsils.Name As SandouqTafsilName
		    , P.Name As Pardazande
			, ReceptionChecks.isAvalDore As AvalDore
			, T.TafsilGuid As PardazandeGuid
			, ReceptionChecks.SandouqTafsilGuid As SandouqTafsilGuid
	from ReceptionChecks Left outer join Receptions as T on 
		 T.Guid=ReceptionChecks.MasterGuid inner join Tafsils on
		 ReceptionChecks.SandouqTafsilGuid=Tafsils.Guid inner join Tafsils as P on
		 T.TafsilGuid=P.Guid
	union all
	select    ReceptionChecks.Guid
			, ReceptionChecks.BankName
			, ReceptionChecks.DateM
			, ReceptionChecks.Description
			, ReceptionChecks.CheckNumber
			, ReceptionChecks.PoshtNomre
			, ReceptionChecks.Price
			, ReceptionChecks.CheckStatus
			, ReceptionChecks.DateSarResid
			, Tafsils.Name As SandouqTafsilName
		    , P.Name As Pardazande
			, ReceptionChecks.isAvalDore As AvalDore
			, T.TafsilGuid As PardazandeGuid
			, ReceptionChecks.SandouqTafsilGuid As SandouqTafsilGuid
	from ReceptionChecks inner join ReceptionCheckAvalDores as T on 
		 T.Guid=ReceptionChecks.Guid inner join Tafsils on
		 ReceptionChecks.SandouqTafsilGuid=Tafsils.Guid inner join Tafsils as P on
		 T.TafsilGuid=P.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheckAvalDore_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheckAvalDore_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheckAvalDore_GetAll
AS
BEGIN
	Select    ReceptionCheckAvalDores.*
			, Tafsils.Name As TafsilName
			, P.Name As SandouqName
			, Users.Name As UserName
	from ReceptionCheckAvalDores inner join Tafsils on
		 ReceptionCheckAvalDores.TafsilGuid=Tafsils.Guid Left outer join Tafsils As P on
		 ReceptionCheckAvalDores.SandouqTafsilGuid=P.Guid inner join Users on
		 ReceptionCheckAvalDores.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheckAvalDore_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheckAvalDore_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheckAvalDore_Get
	@guid uniqueidentifier
AS
BEGIN
	Select    ReceptionCheckAvalDores.*
			, Tafsils.Name As TafsilName
			, P.Name As SandouqName
			, Users.Name As UserName
	from ReceptionCheckAvalDores inner join Tafsils on
		 ReceptionCheckAvalDores.TafsilGuid=Tafsils.Guid Left outer join Tafsils As P on
		 ReceptionCheckAvalDores.SandouqTafsilGuid=P.Guid inner join Users on
		 ReceptionCheckAvalDores.UserGuid=Users.Guid
	where ReceptionCheckAvalDores.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheckAvalDore_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheckAvalDore_Remove]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_ReceptionCheckAvalDore_Remove]
	@guid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditMoeinGuid uniqueidentifier,
	@sandouqCreditMoeinGuid uniqueidentifier
AS
BEGIN
	delete from ReceptionCheckAvalDores
	where Guid=@guid

	delete from ReceptionChecks 
	where Guid=@guid

	EXEC sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@tafsilCreditMoeinGuid,@bankCreditMoeinGuid,@sandouqCreditMoeinGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheckAvalDore_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheckAvalDore_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_ReceptionCheckAvalDore_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@bankName nvarchar(200),
	@dateM datetime,
	@sarresid datetime,
	@desc nvarchar(Max),
	@number nvarchar(200),
	@poshNomre nvarchar(200),
	@price decimal,
	@st int,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier,
	@tafsilGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditMoeinGuid uniqueidentifier,
	@sandouqCreditMoeinGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[ReceptionCheckAvalDores]
	   SET [Modified] = @modif
		  ,[BankName] = @bankName
		  ,[DateM] = @dateM
		  ,[DateSarResid] = @sarresid
		  ,[Description] = @desc
		  ,[CheckNumber] = @number
		  ,[PoshtNomre] = @poshNomre
		  ,[Price] = @price
		  ,[CheckStatus] = @st
		  ,[SandouqTafsilGuid] = @sandouqTafsilGuid
		  ,[SandouqMoeinGuid] = @sandouqMoeinGuid
		  ,[TafsilGuid] = @tafsilGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		WHERE [Guid] = @guid
	if @@ROWCOUNT = 0
	begin
		INSERT INTO [dbo].[ReceptionCheckAvalDores]
           ([Guid]
           ,[Modified]
           ,[BankName]
           ,[DateM]
           ,[DateSarResid]
           ,[Description]
           ,[CheckNumber]
           ,[PoshtNomre]
           ,[Price]
           ,[CheckStatus]
           ,[SandouqTafsilGuid]
           ,[SandouqMoeinGuid]
           ,[TafsilGuid]
           ,[UserGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@bankName
           ,@dateM
           ,@sarresid
           ,@desc
           ,@number
           ,@poshNomre
           ,@price
           ,@st
           ,@sandouqTafsilGuid
           ,@sandouqMoeinGuid
           ,@tafsilGuid
           ,@userGuid
		   ,@serverSt
		   ,@serverDate)
	end

	EXEC sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@tafsilCreditMoeinGuid,@bankCreditMoeinGuid,@sandouqCreditMoeinGuid
	EXEC sp_ReceptionCheck_Insert @guid,@modif,@bankName,@desc,@dateM,null,@number,@poshNomre,@price,@st,@sarresid,@sandouqTafsilGuid,@sandouqMoeinGuid,'true',@serverSt,@serverDate
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckAvalDore_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckAvalDore_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckAvalDore_GetAll
AS
BEGIN
	select    PardakhtCheckAvalDores.*
			, CheckPages.Description As Description
			, CheckPages.Price As Price 
			, CheckPages.DateSarresid As DateSarresid
			, CheckPages.Number As Number
			, Tafsils.Name As TafsilName
			, Users.Name As UserName
	From PardakhtCheckAvalDores inner join CheckPages on
		 PardakhtCheckAvalDores.CheckPageGuid=CheckPages.Guid inner join Tafsils on
		 PardakhtCheckAvalDores.TafsilGuid=Tafsils.Guid inner join Users on
		 PardakhtCheckAvalDores.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckAvalDore_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckAvalDore_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckAvalDore_Get
	@guid uniqueidentifier
AS
BEGIN
	select    PardakhtCheckAvalDores.*
			, CheckPages.Description As Description
			, CheckPages.Price As Price 
			, CheckPages.DateSarresid As DateSarresid
			, CheckPages.Number As Number
			, Tafsils.Name As TafsilName
			, Users.Name As UserName
	From PardakhtCheckAvalDores inner join CheckPages on
		 PardakhtCheckAvalDores.CheckPageGuid=CheckPages.Guid inner join Tafsils on
		 PardakhtCheckAvalDores.TafsilGuid=Tafsils.Guid inner join Users on
		 PardakhtCheckAvalDores.UserGuid=Users.Guid
	where PardakhtCheckAvalDores.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckAvalDore_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckAvalDore_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PardakhtCheckAvalDore_Remove
	@guid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditMoeinGuid uniqueidentifier,
	@sandouqCreditMoeinGuid uniqueidentifier
AS
BEGIN
	delete from PardakhtCheckAvalDores
	where Guid=@guid

	EXEC sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@tafsilCreditMoeinGuid,@bankCreditMoeinGuid,@sandouqCreditMoeinGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckAvalDore_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckAvalDore_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_PardakhtCheckAvalDore_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@checkPageGuid uniqueidentifier,
	@tafsilGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@dasteCheckName nvarchar(200),
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditMoeinGuid uniqueidentifier,
	@sandouqCreditMoeinGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[PardakhtCheckAvalDores]
	   SET [Modified] = @modif
		  ,[CheckPageGuid] = @checkPageGuid
		  ,[TafsilGuid] = @tafsilGuid
		  ,[UserGuid] = @userGuid
		  ,[DasteCheckName] = @dasteCheckName
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
		 WHERE [Guid] = @guid
	if @@ROWCOUNT = 0
	begin
		INSERT INTO [dbo].[PardakhtCheckAvalDores]
           ([Guid]
           ,[Modified]
           ,[CheckPageGuid]
           ,[TafsilGuid]
           ,[UserGuid]
           ,[DasteCheckName]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		 VALUES
           (@guid
           ,@modif
           ,@checkPageGuid
           ,@tafsilGuid
           ,@userGuid
           ,@dasteCheckName
		   ,@serverSt
		   ,@serverDate)
	end

	EXEC sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@tafsilCreditMoeinGuid,@bankCreditMoeinGuid,@sandouqCreditMoeinGuid

END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckShakhsi_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckShakhsi_Get]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_PardakhtCheckShakhsi_Get]
	@Guid uniqueidentifier
AS
BEGIN
	select * from PardakhtCheckShakhsis
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PardakhtCheckShakhsi_GetAllFromView]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PardakhtCheckShakhsi_GetAllFromView]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_PardakhtCheckShakhsi_GetAllFromView]
AS
BEGIN
select        PardakhtCheckShakhsis.Guid
			, Bank.Name As BankName
			, DasteChecks.BankGuid As BankGuid
			, PardakhtCheckShakhsis.Description
			, CheckPages.Number
			, PardakhtCheckShakhsis.Price
			, CheckPages.CheckStatus
			, PardakhtCheckShakhsis.DateSarResid
		    , P.Name As Girande
			, CAST(0 as bit) As AvalDore
			, T.TafsilGuid As GirandeGuid
			, PardakhtCheckShakhsis.DateM
	from PardakhtCheckShakhsis inner join Pardakhts as T on 
		 T.Guid=PardakhtCheckShakhsis.MasterGuid inner join CheckPages on
		 PardakhtCheckShakhsis.CheckPageGuid=CheckPages.Guid inner join Tafsils as P on
		 T.TafsilGuid=P.Guid inner join DasteChecks on
		 CheckPages.CheckGuid=DasteChecks.Guid inner join Tafsils As Bank on
		 DasteChecks.BankGuid=Bank.Guid
	union All
	select    PardakhtCheckAvalDores.Guid
			, Bank.Name
			, DasteChecks.BankGuid As BankGuid
			, CheckPages.Description
			, CheckPages.Number
			, CheckPages.Price
			, CheckPages.CheckStatus
			, CheckPages.DateSarResid
			, Tafsils.Name As Pardazande
			, CAST(1 as bit) As AvalDore
			, PardakhtCheckAvalDores.TafsilGuid As GirandeGuid
			, PardakhtCheckAvalDores.Modified As DateM
	from PardakhtCheckAvalDores inner join Tafsils on
		 PardakhtCheckAvalDores.TafsilGuid=Tafsils.Guid inner join CheckPages on
		 PardakhtCheckAvalDores.CheckPageGuid=CheckPages.Guid inner join DasteChecks on
		 CheckPages.CheckGuid=DasteChecks.Guid inner join Tafsils As Bank on
		 DasteChecks.BankGuid=Bank.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Contract_GetAll
AS
BEGIN
	select Contracts.*, Tafsils.Name As FirstSideName,
		   P.Name As SecondSideName, Users.Name As UserName	
	from Contracts inner join Tafsils on
	     Contracts.FirstSideGuid=Tafsils.Guid inner join Tafsils As P on
		 Contracts.SecondSideGuid=P.Guid inner join Users on
		 Contracts.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Contract_Get
	@guid uniqueidentifier
AS
BEGIN
	select Contracts.*, Tafsils.Name As FirstSideName,
		   P.Name As SecondSideName, Users.Name As UserName	
	from Contracts inner join Tafsils on
	     Contracts.FirstSideGuid=Tafsils.Guid inner join Tafsils As P on
		 Contracts.SecondSideGuid=P.Guid inner join Users on
		 Contracts.UserGuid=Users.Guid
	where Contracts.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_NextCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Contract_NextCode]
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Code) From Contracts
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_CheckCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Contract_CheckCode]
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Contracts
	where Code=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Remove]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Contract_Remove]
	@guid uniqueidentifier
AS
BEGIN
	declare @buGuid uniqueidentifier
	set @buGuid=(select BuildingGuid from Contracts where Guid=@guid)

	update Buildings
	set IsArchive='false'
	where Guid = @buGuid

	delete from Contracts
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Advisor_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Advisor_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Advisor_GetAll
AS
BEGIN
	Select Advisors.* , Tafsils.Account,Tafsils.AccountFirst
	from Advisors inner join Tafsils on
	     Advisors.Guid=Tafsils.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Advisor_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Advisor_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Advisor_Get
	@guid uniqueidentifier
AS
BEGIN
	Select Advisors.* , Tafsils.Account,Tafsils.AccountFirst
	from Advisors inner join Tafsils on
	     Advisors.Guid=Tafsils.Guid
	where Advisors.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Advisor_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Advisor_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Advisor_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Advisors
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Advisor_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Advisor_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Advisor_Save
	@guid uniqueidentifier,
	@st bit,
	@name nvarchar(200),
	@address nvarchar(max),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Advisors]
	   SET [Modified] = GETDATE()
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Address] = @address
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Advisors]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Address]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,GETDATE()
           ,@st
           ,@name
           ,@address
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Gardesh_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Gardesh_GetAll]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Gardesh_GetAll]
	@tafsilGuid uniqueidentifier
AS
BEGIN
	Select    SanadDetails.*
			, Moeins.Code As MoeinCode
			, Moeins.Name As MoeinName
			, Tafsils.Code As TafsilCode
			, Tafsils.Name As TafsilName
			, Sanads.DateM As DateM
	from SanadDetails inner join Moeins on
		 SanadDetails.MoeinGuid = Moeins.Guid inner join Tafsils on
		 SanadDetails.TafsilGuid = Tafsils.Guid inner join Sanads on
		 SanadDetails.MasterGuid = Sanads.Guid
	where SanadDetails.TafsilGuid=@tafsilGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseLog_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseLog_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseLog_Save
	@guid uniqueidentifier,
	@number bigint,
	@dateM datetime,
	@cat nvarchar(100),
	@subCat1 nvarchar(100),
	@subCat2 nvarchar(100),
	@city nvarchar(100),
	@region nvarchar(100),
	@price1 decimal,
	@price2 decimal,
	@title nvarchar(500),
	@content nvarchar(Max),
	@url nvarchar(100),
	@updateDesc nvarchar(Max),
	@statusCode int,
	@ip nvarchar(20),
	@lastUpdate datetime,
	@visitCount int,
	@type smallint,
	@state nvarchar(20)
AS
BEGIN
	UPDATE [dbo].[AdvertiseLogs]
	   SET [SimcardNumber] = @number
		  ,[DateM] = @dateM
		  ,[Category] = @cat
		  ,[SubCategory1] = @subCat1
		  ,[SubCategory2] = @subCat2
		  ,[City] = @city
		  ,[Region] = @region
		  ,[Price1] = @price1
		  ,[Price2] = @price2
		  ,[Title] = @title
		  ,[Content] = @content
		  ,[URL] = @url
		  ,[UpdateDesc] = @updateDesc
		  ,[StatusCode] = @statusCode
		  ,[IP] = @ip
		  ,[LastUpdate] = @lastUpdate
		  ,[VisitCount] = @visitCount
		  ,[AdvType] = @type
		  ,[State] = @state
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[AdvertiseLogs]
           ([Guid]
           ,[SimcardNumber]
           ,[DateM]
           ,[Category]
           ,[SubCategory1]
           ,[SubCategory2]
           ,[City]
           ,[Region]
           ,[Price1]
           ,[Price2]
           ,[Title]
           ,[Content]
           ,[URL]
           ,[UpdateDesc]
           ,[StatusCode]
           ,[IP]
           ,[LastUpdate]
           ,[VisitCount]
           ,[AdvType]
           ,[State])
		VALUES
           (@guid
           ,@number
           ,@dateM
           ,@cat
           ,@subCat1
           ,@subCat2
           ,@city
           ,@region
           ,@price1
           ,@price2
           ,@title
           ,@content
           ,@url
           ,@updateDesc
           ,@statusCode
           ,@ip
           ,@lastUpdate
           ,@visitCount
           ,@type
           ,@state)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseLog_GetByUrl]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseLog_GetByUrl]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseLog_GetByUrl
	@url nvarchar(100)
AS
BEGIN
	select top(1) * from AdvertiseLogs
	where URL=@url
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseRelatedRegion_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseRelatedRegion_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseRelatedRegion_Save
	@guid uniqueidentifier,
	@onlineRegionName nvarchar(200),
	@localRegionGuid uniqueidentifier
AS
BEGIN
	UPDATE [dbo].[AdvertiseRelatedRegions]
	   SET [OnlineRegionName] = @onlineRegionName
		  ,[LocalRegionGuid] = @localRegionGuid
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[AdvertiseRelatedRegions]
           ([Guid]
           ,[OnlineRegionName]
           ,[LocalRegionGuid])
		VALUES
           (@guid
           ,@onlineRegionName
           ,@localRegionGuid)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseRelatedRegion_GetAllByOnlineRegionName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseRelatedRegion_GetAllByOnlineRegionName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseRelatedRegion_GetAllByOnlineRegionName
	@onlineRegionName nvarchar(200)
AS
BEGIN
	select * from AdvertiseRelatedRegions
	where OnlineRegionName=@onlineRegionName
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseRelatedRegion_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseRelatedRegion_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseRelatedRegion_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from AdvertiseRelatedRegions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseRelatedRegion_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseRelatedRegion_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseRelatedRegion_GetAll
AS
BEGIN
	select * from AdvertiseRelatedRegions
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvertiseRelatedRegion_GetByLocalRegionGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvertiseRelatedRegion_GetByLocalRegionGuid]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvertiseRelatedRegion_GetByLocalRegionGuid
	@localRegionGuid uniqueidentifier
AS
BEGIN
	select top(1) * from AdvertiseRelatedRegions
	where LocalRegionGuid=@localRegionGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvToken_GetToken]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvToken_GetToken]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvToken_GetToken
	@number bigint,
	@type smallint
AS
BEGIN
	select * from AdvTokens
	where Number=@number and
		  Type=@type
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvToken_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvToken_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvToken_Save
	@number bigint,
	@guid uniqueidentifier,
	@type smallint,
	@token nvarchar(max)
AS
BEGIN
	UPDATE [dbo].[AdvTokens]
	   SET [Token] = @token
		  ,[Number] = @number
		  ,[Type] = @type
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[AdvTokens]
           ([Guid]
           ,[Token]
           ,[Number]
           ,[Type])
		VALUES
           (@guid
           ,@token
           ,@number
           ,@type)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_AdvToken_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_AdvToken_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_AdvToken_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from AdvTokens
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingAccountType_GetAll
AS
BEGIN
	select * from BuildingAccountTypes
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingAccountType_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingAccountTypes]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingAccountTypes]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingAccountType_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingAccountTypes
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingAccountType_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from BuildingAccountTypes
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingCondition_GetAll
AS
BEGIN
	select * from BuildingConditions
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingCondition_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingConditions]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingConditions]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingCondition_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingConditions
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingCondition_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from BuildingConditions
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingGallery_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingGallery_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingGallery_Save
	@guid uniqueidentifier,
	@modif datetime,
	@buGuid uniqueidentifier,
	@imageName nvarchar(100),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingGalleries]
	   SET [Modified] = @modif
		  ,[BuildingGuid] = @buGuid
		  ,[ImageName] = @imageName
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingGalleries]
           ([Guid]
           ,[Modified]
           ,[BuildingGuid]
           ,[ImageName]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@buGuid
           ,@imageName
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingGallery_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingGallery_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingGallery_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from BuildingGalleries
	where BuildingGuid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOption_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOption_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingOption_GetAll
AS
BEGIN
	select * from BuildingOptions
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOption_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOption_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingOption_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingOptions]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingOptions]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOption_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOption_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingOption_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingOptions
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOption_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOption_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingOption_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from BuildingOptions
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Building_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@ownerGuid uniqueidentifier,
	@sellPrice decimal,
	@vamPrice decimal,
	@qestPrice decimal,
	@dong int,
	@docTypeGuid uniqueidentifier=null,
	@tarakom smallint=null,
	@rahnPrice1 decimal,
	@rahnPrice2 decimal,
	@ejarePrice1 decimal,
	@ejarePrice2 decimal,
	@rentalGuid uniqueidentifier=null,
	@isShortTime bit=null,
	@isOwnerHere bit=null,
	@pishTotalPrice decimal,
	@pishPrice decimal,
	@deliveryDate datetime=null,
	@pishDesc nvarchar(Max)=null,
	@moavezeDesc nvarchar(Max)=null,
	@mosharekatDesc nvarchar(Max)=null,
	@masahat int,
	@zirbana int,
	@cityGuid uniqueidentifier,
	@regionGuid uniqueidentifier,
	@address nvarchar(Max)=null,
	@conditionGuid uniqueidentifier,
	@side int,
	@typeGuid uniqueidentifier,
	@shortDesc nvarchar(Max)=null,
	@accountTypeGuid uniqueidentifier,
	@metrazhTejari real,
	@viewGuid uniqueidentifier,
	@floorCoverGuid uniqueidentifier,
	@kitchenServiceGuid uniqueidentifier,
	@water smallint,
	@barq smallint,
	@gas smallint,
	@tell smallint,
	@tedadTabaqe int,
	@tabaqeNo int,
	@vahedPerTabaqe int,
	@metrazheKouche real,
	@ertefaSaqf real,
	@hashie real,
	@saleSakht nvarchar(30)=null,
	@dateParvane nvarchar(30)=null,
	@parvaneSerial nvarchar(300)=null,
	@bonBast bit,
	@mamarJoda bit,
	@roomCount int,
	@code nvarchar(50)=null,
	@userGuid uniqueidentifier,
	@createDate datetime,
	@image nvarchar(100)=null,
	@priority smallint,
	@isArchive bit,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Buildings]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[OwnerGuid] = @ownerGuid
		  ,[SellPrice] = @sellPrice
		  ,[VamPrice] = @vamPrice
		  ,[QestPrice] = @qestPrice
		  ,[Dang] = @dong
		  ,[DocumentType] = @docTypeGuid
		  ,[Tarakom] = @tarakom
		  ,[RahnPrice1] = @rahnPrice1
		  ,[RahnPrice2] = @rahnPrice2
		  ,[EjarePrice1] = @ejarePrice1
		  ,[EjarePrice2] = @ejarePrice2
		  ,[RentalAutorityGuid] = @rentalGuid
		  ,[IsShortTime] = @isShortTime
		  ,[IsOwnerHere] = @isOwnerHere
		  ,[PishTotalPrice] = @pishTotalPrice
		  ,[PishPrice] = @pishPrice
		  ,[DeliveryDate] = @deliveryDate
		  ,[PishDesc] = @pishDesc
		  ,[MoavezeDesc] = @moavezeDesc
		  ,[MosharekatDesc] = @mosharekatDesc
		  ,[Masahat] = @masahat
		  ,[ZirBana] = @zirbana
		  ,[CityGuid] = @cityGuid
		  ,[RegionGuid] = @regionGuid
		  ,[Address] = @address
		  ,[BuildingConditionGuid] = @conditionGuid
		  ,[Side] = @side
		  ,[BuildingTypeGuid] = @typeGuid
		  ,[ShortDesc] = @shortDesc
		  ,[BuildingAccountTypeGuid] = @accountTypeGuid
		  ,[MetrazhTejari] = @metrazhTejari
		  ,[BuildingViewGuid] = @viewGuid
		  ,[FloorCoverGuid] = @floorCoverGuid
		  ,[KitchenServiceGuid] = @kitchenServiceGuid
		  ,[Water] = @water
		  ,[Barq] = @barq
		  ,[Gas] = @gas
		  ,[Tell] = @tell
		  ,[TedadTabaqe] = @tedadTabaqe
		  ,[TabaqeNo] = @tabaqeNo
		  ,[VahedPerTabaqe] = @vahedPerTabaqe
		  ,[MetrazhKouche] = @metrazheKouche
		  ,[ErtefaSaqf] = @ertefaSaqf
		  ,[Hashie] = @hashie
		  ,[SaleSakht] = @saleSakht
		  ,[DateParvane] = @dateParvane
		  ,[ParvaneSerial] = @parvaneSerial
		  ,[BonBast] = @bonBast
		  ,[MamarJoda] = @mamarJoda
		  ,[RoomCount] = @roomCount
		  ,[Code] = @code
		  ,[Image] = @image
		  ,[Priority] = @priority
		  ,[IsArchive] = @isArchive
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	if @@ROWCOUNT = 0
	begin
		INSERT INTO [dbo].[Buildings]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[OwnerGuid]
           ,[SellPrice]
           ,[VamPrice]
           ,[QestPrice]
           ,[Dang]
           ,[DocumentType]
           ,[Tarakom]
           ,[RahnPrice1]
           ,[RahnPrice2]
           ,[EjarePrice1]
           ,[EjarePrice2]
           ,[RentalAutorityGuid]
           ,[IsShortTime]
           ,[IsOwnerHere]
           ,[PishTotalPrice]
           ,[PishPrice]
           ,[DeliveryDate]
           ,[PishDesc]
           ,[MoavezeDesc]
           ,[MosharekatDesc]
           ,[Masahat]
           ,[ZirBana]
           ,[CityGuid]
           ,[RegionGuid]
           ,[Address]
           ,[BuildingConditionGuid]
           ,[Side]
           ,[BuildingTypeGuid]
           ,[ShortDesc]
           ,[BuildingAccountTypeGuid]
           ,[MetrazhTejari]
           ,[BuildingViewGuid]
           ,[FloorCoverGuid]
           ,[KitchenServiceGuid]
           ,[Water]
           ,[Barq]
           ,[Gas]
           ,[Tell]
           ,[TedadTabaqe]
           ,[TabaqeNo]
           ,[VahedPerTabaqe]
           ,[MetrazhKouche]
           ,[ErtefaSaqf]
           ,[Hashie]
           ,[SaleSakht]
           ,[DateParvane]
           ,[ParvaneSerial]
           ,[BonBast]
           ,[MamarJoda]
           ,[RoomCount]
           ,[Code]
           ,[UserGuid]
           ,[CreateDate]
           ,[Image]
           ,[Priority]
           ,[IsArchive]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@ownerGuid
           ,@sellPrice
           ,@vamPrice
           ,@qestPrice
           ,@dong
           ,@docTypeGuid
           ,@tarakom
           ,@rahnPrice1
           ,@rahnPrice2
           ,@ejarePrice1
           ,@ejarePrice2
           ,@rentalGuid
           ,@isShortTime
           ,@isOwnerHere
           ,@pishTotalPrice
           ,@pishPrice
           ,@deliveryDate
           ,@pishDesc
           ,@moavezeDesc
           ,@mosharekatDesc
           ,@masahat
           ,@zirbana
           ,@cityGuid
           ,@regionGuid
           ,@address
           ,@conditionGuid
           ,@side
           ,@typeGuid
           ,@shortDesc
           ,@accountTypeGuid
           ,@metrazhTejari
           ,@viewGuid
           ,@floorCoverGuid
           ,@kitchenServiceGuid
           ,@water
           ,@barq
           ,@gas
           ,@tell
           ,@tedadTabaqe
           ,@tabaqeNo
           ,@vahedPerTabaqe
           ,@metrazheKouche
           ,@ertefaSaqf
           ,@hashie
           ,@saleSakht
           ,@dateParvane
           ,@parvaneSerial
           ,@bonBast
           ,@mamarJoda
           ,@roomCount
           ,@code
           ,@userGuid
           ,@createDate
           ,@image
           ,@priority
           ,@isArchive
		   ,@serverSt
		   ,@serverDate)
	end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_ChangeStatus]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Building_ChangeStatus]
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Buildings
	set Status=@st
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_NextCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Building_NextCode]
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Code) From Buildings
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_CheckCode]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Building_CheckCode]
	@guid uniqueidentifier,
	@code nvarchar(20)
AS
BEGIN
	select COUNT(*) from Buildings
	where Code=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOption_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOption_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRelatedOption_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from BuildingRelatedOptions
	where BuildinGuid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOptopn_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOptopn_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRelatedOptopn_Save
	@guid uniqueidentifier,
	@modif datetime,
	@buGuid uniqueidentifier,
	@buOptionGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingRelatedOptions]
	   SET [Modified] = @modif
		  ,[BuildinGuid] = @buGuid
		  ,[BuildingOptionGuid] = @buOptionGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingRelatedOptions]
           ([Guid]
           ,[Modified]
           ,[BuildinGuid]
           ,[BuildingOptionGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@buGuid
           ,@buOptionGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequest_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequest_ChangeStatus]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_BuildingRequest_ChangeStatus]
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingRequests
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequest_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequest_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_BuildingRequest_Save]
	@guid uniqueidentifier,
	@st bit,
	@modif datetime,
	@createDtae datetime,
	@askerGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sellPrice1 decimal,
	@sellPrice2 decimal,
	@hasVam bit=null,
	@rahn1 decimal,
	@rahn2 decimal,
	@ejare1 decimal,
	@ejare2 decimal,
	@peopleCount smallint=null,
	@hasOwner bit=null,
	@shortDate bit=null,
	@rentalGuid uniqueidentifier=null,
	@cityGuid uniqueidentifier,
	@typeGuid uniqueidentifier,
	@masahat1 int,
	@masahat2 int,
	@roomCount int,
	@accTypeGuid uniqueidentifier,
	@conditionGuid uniqueidentifier,
	@shortDesc nvarchar(max),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingRequests]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[AskerGuid] = @askerGuid
		  ,[SellPrice1] = @sellPrice1
		  ,[SellPrice2] = @sellPrice2
		  ,[HasVam] = @hasVam
		  ,[RahnPrice1] = @rahn1
		  ,[RahnPrice2] = @rahn2
		  ,[EjarePrice1] = @ejare1
		  ,[EjarePrice2] = @ejare2
		  ,[PeopleCount] = @peopleCount
		  ,[HasOwner] = @hasOwner
		  ,[ShortDate] = @shortDate
		  ,[RentalAutorityGuid] = @rentalGuid
		  ,[CityGuid] = @cityGuid
		  ,[BuildingTypeGuid] = @typeGuid
		  ,[Masahat1] = @masahat1
		  ,[Masahat2] = @masahat2
		  ,[RoomCount] = @roomCount
		  ,[BuildingAccountTypeGuid] = @accTypeGuid
		  ,[BuildingConditionGuid] = @conditionGuid
		  ,[ShortDesc] = @shortDesc
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingRequests]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[CreateDate]
           ,[AskerGuid]
           ,[UserGuid]
           ,[SellPrice1]
           ,[SellPrice2]
           ,[HasVam]
           ,[RahnPrice1]
           ,[RahnPrice2]
           ,[EjarePrice1]
           ,[EjarePrice2]
           ,[PeopleCount]
           ,[HasOwner]
           ,[ShortDate]
           ,[RentalAutorityGuid]
           ,[CityGuid]
           ,[BuildingTypeGuid]
           ,[Masahat1]
           ,[Masahat2]
           ,[RoomCount]
           ,[BuildingAccountTypeGuid]
           ,[BuildingConditionGuid]
           ,[ShortDesc]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@createDtae
           ,@askerGuid
           ,@userGuid
           ,@sellPrice1
           ,@sellPrice2
           ,@hasVam
           ,@rahn1
           ,@rahn2
           ,@ejare1
           ,@ejare2
           ,@peopleCount
           ,@hasOwner
           ,@shortDate
           ,@rentalGuid
           ,@cityGuid
           ,@typeGuid
           ,@masahat1
           ,@masahat2
           ,@roomCount
           ,@accTypeGuid
           ,@conditionGuid
           ,@shortDesc
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_RemoveRange]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_RemoveRange]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRequestRegion_RemoveRange
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from BuildingRequestRegions
	where RequestGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRequestRegion_Save
	@masterGuid uniqueidentifier,
	@guid uniqueidentifier,
	@modif datetime,
	@regionGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingRequestRegions]
	   SET [Modified] = @modif
		  ,[RequestGuid] = @masterGuid
		  ,[RegionGuid] = @regionGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingRequestRegions]
           ([Guid]
           ,[Modified]
           ,[RequestGuid]
           ,[RegionGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@masterGuid
           ,@regionGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingType_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from BuildingTypes
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingType_GetAll
AS
BEGIN
	select * from BuildingTypes
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingType_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingTypes]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingTypes]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingType_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingTypes
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingView_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from BuildingViews
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingView_GetAll
AS
BEGIN
	select * from BuildingViews
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingView_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[BuildingViews]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BuildingViews]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingView_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update BuildingViews
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Cities_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@stateGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Cities]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[StateGuid] = @stateGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Cities]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[StateGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@stateGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_City_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_City_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_City_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Cities
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_City_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_City_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_City_CheckName
	@guid uniqueidentifier,
	@name nvarchar(200),
	@stateGuid uniqueidentifier
AS
BEGIN
	select COUNT(*) from Cities
	where Name=@name and StateGuid=@stateGuid and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_DocumentType_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from DocumentTypes
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_DocumentType_GetAll
AS
BEGIN
	select * from DocumentTypes
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_DocumentType_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[DocumentTypes]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[DocumentTypes]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_DocumentType_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update DocumentTypes
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FileInfo_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FileInfo_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FileInfo_Get
	@fileName nvarchar(max)
AS
BEGIN
	select * from FileInfoes
	where FileName=@fileName
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FileInfo_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FileInfo_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FileInfo_Save
	@fileName nvarchar(max),
	@guid uniqueidentifier,
	@modif datetime,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[FileInfoes]
	   SET [Modified] = @modif
		  ,[FileName] = @fileName
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[FileInfoes]
           ([Guid]
           ,[Modified]
           ,[FileName]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@fileName
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FloorCover_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from FloorCovers
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FloorCover_GetAll
AS
BEGIN
	select * from FloorCovers
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FloorCover_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[FloorCovers]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[FloorCovers]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_FloorCover_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update FloorCovers
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_KitchenService_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from KitchenServices
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_KitchenService_GetAll
AS
BEGIN
	select * from KitchenServices
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_KitchenService_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[KitchenServices]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[KitchenServices]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_KitchenService_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update KitchenServices
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Naqz_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Naqz_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Naqz_GetAll
AS
BEGIN
	select * from Naqzs
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Naqz_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Naqz_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Naqz_Save
	@guid uniqueidentifier,
	@message nvarchar(max),
	@useCount int
AS
BEGIN
	UPDATE [dbo].[Naqzs]
	   SET [Message] = @message
		  ,[UseCount] = @useCount
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Naqzs]
           ([Guid]
           ,[Message]
           ,[UseCount])
		VALUES
           (@guid
           ,@message
           ,@useCount)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Note_Save
	@guid uniqueidentifier,
	@title nvarchar(500),
	@desc nvarchar(max),
	@dateSabt datetime,
	@dateSarresid datetime=null,
	@userGuid uniqueidentifier,
	@priority smallint,
	@status smallint
AS
BEGIN
	UPDATE [dbo].[Notes]
	   SET [Title] = @title
		  ,[Description] = @desc
		  ,[DateSarresid] = @dateSarresid
		  ,[UserGuid] = @userGuid
		  ,[Priority] = @priority
		  ,[NoteStatus] = @status
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Notes]
           ([Guid]
           ,[Title]
           ,[Description]
           ,[DateSabt]
           ,[DateSarresid]
           ,[UserGuid]
           ,[Priority]
           ,[NoteStatus])
		VALUES
           (@guid
           ,@title
           ,@desc
           ,@dateSabt
           ,@dateSarresid
           ,@userGuid
           ,@priority
           ,@status)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_Get]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Note_Get] 
	@guid uniqueidentifier
AS
BEGIN
	select [dbo].[Notes].*,[dbo].[Users].Name as UserName
	from [dbo].[Notes] inner join [dbo].[Users]
	on [dbo].[Notes].UserGuid=[dbo].[Users].Guid
	where Notes.Guid=@guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_GetAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_PeopleGroup_GetAll] 
AS
BEGIN
	select * from PeopleGroups
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_Save]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_PeopleGroup_Save] 
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@parentGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[PeopleGroups]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ParentGuid] = @parentGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[PeopleGroups]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[ParentGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@parentGuid
		   ,@serverSt
		   ,@serverDate)
	 end
End
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_PeopleGroup_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update PeopleGroups
	set Status=@st
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_CheckName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_CheckName
	@guid uniqueidentifier,
	@name nvarchar(200)
AS
BEGIN
	select COUNT(*) from PeopleGroups
	where Name=@name and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_ChildCount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_ChildCount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_ChildCount
	@parentGuid uniqueidentifier
AS
BEGIN
	select COUNT(*) from PeopleGroups
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@cityGuid uniqueidentifier,
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[Regions]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[CityGuid] = @cityGuid
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Regions]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[CityGuid]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@cityGuid
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Regions
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Rental_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Rental_CheckName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Rental_CheckName
	@guid uniqueidentifier,
	@name nvarchar(250)
AS
BEGIN
	select COUNT(*) from RentalAuthorities
	where Name=@name and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Rental_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Rental_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Rental_GetAll
AS
BEGIN
	select * from RentalAuthorities
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Rental_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Rental_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Rental_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[RentalAuthorities]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[RentalAuthorities]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Rental_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Rental_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Rental_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update RentalAuthorities
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SerializedData_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SerializedData_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SerializedData_Get
	@memberName nvarchar(200)
AS
BEGIN
	select * from SerializedDatas
	where Name=@memberName
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SerializedData_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SerializedData_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SerializedData_Save
	@guid uniqueidentifier,
	@name nvarchar(250),
	@data nvarchar(Max)
AS
BEGIN
	UPDATE [dbo].[SerializedDatas]
	   SET [Name] = @name
		  ,[Data] = @data
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[SerializedDatas]
           ([Guid]
           ,[Name]
           ,[Data])
		VALUES
           (@guid
           ,@name
           ,@data)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SerializedData_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SerializedData_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SerializedData_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from SerializedDatas
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Setting_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Settings
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Setting_Save
	@guid uniqueidentifier,
	@name nvarchar(250),
	@val nvarchar(Max)
AS
BEGIN
	UPDATE [dbo].[Settings]
	   SET [Name] = @name
		  ,[Value] = @val
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Settings]
           ([Guid]
           ,[Name]
           ,[Value])
		VALUES
           (@guid
           ,@name
           ,@val)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Setting_GetAll
AS
BEGIN
	select * from Settings
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_GetAll
AS
BEGIN
	select * from Simcards
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_Save
	@guid uniqueidentifier,
	@st bit,
	@number bigint,
	@owner nvarchar(200),
	@operator nvarchar(50),
	@shBlock bit,
	@nextUseSh datetime,
	@nextUseD datetime
AS
BEGIN
	UPDATE [dbo].[Simcards]
	   SET [Status] = @st
		  ,[Number] = @number
		  ,[Owner] = @owner
		  ,[Operator] = @operator
		  ,[isSheypoorBlocked] = @shBlock
		  ,[NextUseSheypoor] = @nextUseSh
		  ,[NextUseDivar] = @nextUseD
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Simcards]
           ([Guid]
           ,[Status]
           ,[Number]
           ,[Owner]
           ,[Operator]
           ,[isSheypoorBlocked]
           ,[NextUseSheypoor]
           ,[NextUseDivar])
		VALUES
           (@guid
           ,@st
           ,@number
           ,@owner
           ,@operator
           ,@shBlock
           ,@nextUseSh
           ,@nextUseD)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_GetByNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_GetByNumber]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_GetByNumber
	@number bigint
AS
BEGIN
	select * from Simcards
	where Number=@number
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from Simcards
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Simcards
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Simcard_CheckNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Simcard_CheckNumber]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Simcard_CheckNumber
	@guid uniqueidentifier,
	@number bigint
AS
BEGIN
	select COUNT(*) from Simcards
	where Number=@number and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_Get]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].sp_SmsLog_Get 
	@guid uniqueidentifier
AS
BEGIN
	select [dbo].[SmsLogs].*,[dbo].[Users].Name As UserName
	from [dbo].[SmsLogs] inner join [dbo].[Users]
	on [dbo].[SmsLogs].UserGuid=[dbo].[Users].Guid
	where [SmsLogs].Guid = @guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_GetByMessageId]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_GetByMessageId]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].sp_SmsLog_GetByMessageId
	@messageId bigint
AS
BEGIN
	select [dbo].[SmsLogs].*,[dbo].[Users].Name As UserName
	from [dbo].[SmsLogs] inner join [dbo].[Users]
	on [dbo].[SmsLogs].UserGuid=[dbo].[Users].Guid
	where [SmsLogs].MessageId = @messageId
End
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SmsLog_Save
	@guid uniqueidentifier,
	@date datetime,
	@userGuid uniqueidentifier,
	@sender nvarchar(200),
	@reciver nvarchar(200),
	@message nvarchar(max),
	@cost decimal,
	@messageId bigint,
	@statusText nvarchar(50)
AS
BEGIN
	UPDATE [dbo].[SmsLogs]
	   SET [Sender] = @sender
		  ,[Reciver] = @reciver
		  ,[Message] = @message
		  ,[Cost] = @cost
		  ,[MessageId] = @messageId
		  ,[StatusText] = @statusText
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[SmsLogs]
           ([Guid]
           ,[Date]
           ,[UserGuid]
           ,[Sender]
           ,[Reciver]
           ,[Message]
           ,[Cost]
           ,[MessageId]
           ,[StatusText])
		VALUES
           (@guid
           ,@date
           ,@userGuid
           ,@sender
           ,@reciver
           ,@message
           ,@cost
           ,@messageId
           ,@statusText)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsPanel_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsPanel_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SmsPanel_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from SmsPanels
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsPanel_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsPanel_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SmsPanel_GetAll
AS
BEGIN
	select * from SmsPanels
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsPanel_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsPanel_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SmsPanel_Save
	@guid uniqueidentifier,
	@st bit,
	@sender nvarchar(200),
	@api nvarchar(max),
	@name nvarchar(200)
AS
BEGIN
	UPDATE [dbo].[SmsPanels]
	   SET [Status] = @st
		  ,[Sender] = @sender
		  ,[API] = @api
		  ,[Name] = @name
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[SmsPanels]
           ([Guid]
           ,[Status]
           ,[Sender]
           ,[API]
           ,[Name])
		VALUES
           (@guid
           ,@st
           ,@sender
           ,@api
           ,@name)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsPanel_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsPanel_ChangeStatus]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SmsPanel_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update SmsPanels
	set Status=@st
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_State_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_State_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_State_GetAll
AS
BEGIN
	select * from States
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_State_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_State_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_State_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(250),
	@serverSt smallint,
	@serverDate datetime
AS
BEGIN
	UPDATE [dbo].[States]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[ServerStatus] = @serverSt
		  ,[ServerDeliveryDate] = @serverDate
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[States]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
		   ,[ServerStatus]
		   ,[ServerDeliveryDate])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
		   ,@serverSt
		   ,@serverDate)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BackUpLog_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BackUpLog_GetAll]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_BackUpLog_GetAll]
AS
BEGIN
	select * from BackUpLogs
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BackUpLog_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BackUpLog_Get]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_BackUpLog_Get]
	@guid uniqueidentifier
AS
BEGIN
	select * from BackUpLogs
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BackUpLog_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BackUpLog_Save]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_BackUpLog_Save]
	@guid uniqueidentifier,
	@insDate datetime,
	@path nvarchar(100),
	@type smallint,
	@st smallint,
	@desc nvarchar(1000),
	@size smallint
AS
BEGIN
	UPDATE [dbo].[BackUpLogs]
	   SET [Path] = @path
		  ,[Type] = @type
		  ,[BackUpStatus] = @st
		  ,[StatusDesc] = @desc
		  ,[Size] = @size
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[BackUpLogs]
           ([Guid]
           ,[InsertedDate]
           ,[Path]
           ,[Type]
           ,[BackUpStatus]
           ,[StatusDesc]
           ,[Size])
		VALUES
           (@guid
           ,@insDate
           ,@path
           ,@type
           ,@st
           ,@desc
           ,@size)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_UpdateEntities]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_UpdateEntities]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Temp_UpdateEntities
	@type smallint,
	@entityGuid uniqueidentifier,
	@st smallint,
	@deliveryDate datetime
AS
BEGIN
	if @type = 1
	begin
		update States
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 2
	begin
		update Cities
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 3
	begin
		update Regions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 4
	begin
		update Users
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 5
	begin
		update PeopleGroups
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 6
	begin
		update Peoples
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 8
	begin
		update BuildingAccountTypes
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 9
	begin
		update BuildingConditions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 10
	begin
		update BuildingTypes
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 11
	begin
		update BuildingViews
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 12
	begin
		update DocumentTypes
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 13
	begin
		update FloorCovers
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 14
	begin
		update KitchenServices
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 15
	begin
		update RentalAuthorities
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 16
	begin
		update Buildings
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 17
	begin
		update BuildingRequests
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 18
	begin
		update Contracts
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 19
	begin
		update Receptions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 20
	begin
		update Pardakhts
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 22
	begin
		update BuildingOptions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 23
	begin
		update BuildingRelatedOptions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 24
	begin
		update BuildingRequestRegions
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 25
	begin
		update PhoneBooks
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 26
	begin
		update Advisors
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 27
	begin
		update Banks
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 28
	begin
		update Kols
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 29
	begin
		update Moeins
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 30
	begin
		update Tafsils
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 31
	begin
		update Sanads
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
	else if @type = 32
	begin
		update SanadDetails
		set   ServerDeliveryDate = @deliveryDate
			, ServerStatus = @st
		where Guid = @entityGuid
	end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOption_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOption_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRelatedOption_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from BuildingRelatedOptions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BuildingRequestRegion_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from BuildingRequestRegions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_SanadDetail_Get
	@guid uniqueidentifier
AS
BEGIN
	Select    SanadDetails.*
			, Moeins.Code As MoeinCode
			, Moeins.Name As MoeinName
			, Tafsils.Code As TafsilCode
			, Tafsils.Name As TafsilName
	from SanadDetails inner join Moeins on
		 SanadDetails.MoeinGuid = Moeins.Guid
		 inner join Tafsils on
		 SanadDetails.TafsilGuid = Tafsils.Guid
	where SanadDetails.Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_SaveOnModified]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_SaveOnModified]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Temp_SaveOnModified
	@date datetime
AS
BEGIN
	insert into Temps(Guid,ObjectGuid,Type)
	(select NEWID() As Guid,Guid As ObjectGuid,1 As Type
		from States where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,2 As Type
		from Cities where Modified>@date)
		union all
	(select NEWID() As Guid,Guid As ObjectGuid,3 As Type
		from Regions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,4 As Type
		from Users where Modified>@date)
		union all
	(select NEWID() As Guid,Guid As ObjectGuid,5 As Type
		from PeopleGroups where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,6 As Type
		from Peoples where Modified>@date)
		union all
	(select NEWID() As Guid,Guid As ObjectGuid,8 As Type
		from BuildingAccountTypes where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,9 As Type
		from BuildingConditions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,10 As Type
		from BuildingTypes where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,11 As Type
		from BuildingViews where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,12 As Type
		from DocumentTypes where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,13 As Type
		from FloorCovers where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,14 As Type
		from KitchenServices where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,15 As Type
		from RentalAuthorities where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,16 As Type
		from Buildings where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,17 As Type
		from BuildingRequests where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,18 As Type
		from Contracts where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,19 As Type
		from Receptions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,20 As Type
		from Pardakhts where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,22 As Type
		from BuildingOptions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,23 As Type
		from BuildingRelatedOptions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,24 As Type
		from BuildingRequestRegions where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,25 As Type
		from PhoneBooks where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,26 As Type
		from Advisors where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,27 As Type
		from Banks where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,28 As Type
		from Kols where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,29 As Type
		from Moeins where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,30 As Type
		from Tafsils where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,31 As Type
		from Sanads where Modified>@date)
	union all
	(select NEWID() As Guid,Guid As ObjectGuid,32 As Type
		from SanadDetails where Modified>@date)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Desc_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Desc_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Desc_GetAll
AS
BEGIN
	select * from AdjectiveDescriptions
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Desc_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Desc_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Desc_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from AdjectiveDescriptions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Desc_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Desc_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Desc_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from AdjectiveDescriptions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Desc_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Desc_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Desc_Save
	@guid uniqueidentifier,
	@desc nvarchar(max)
AS
BEGIN
	  UPDATE [dbo].[AdjectiveDescriptions]
	  SET [Description] = @desc
	  WHERE Guid = @guid
	  if @@ROWCOUNT = 0
	  begin
		INSERT INTO [dbo].[AdjectiveDescriptions]
           ([Guid]
           ,[Description])
		VALUES
           (@guid
           ,@desc)
	  end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Roozname]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Roozname]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Roozname]
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	Select    SanadDetails.*
			, Moeins.Code As MoeinCode
			, Moeins.Name As MoeinName
			, Tafsils.Code As TafsilCode
			, Tafsils.Name As TafsilName
			, Sanads.DateM As DateM
			, Sanads.Number As SanadNumber
	from SanadDetails inner join Moeins on
		 SanadDetails.MoeinGuid = Moeins.Guid inner join Tafsils on
		 SanadDetails.TafsilGuid = Tafsils.Guid inner join Sanads on
		 SanadDetails.MasterGuid = Sanads.Guid
	where Sanads.DateM between @d1 and @d2
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_TarazAzmayeshi]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_TarazAzmayeshi]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_TarazAzmayeshi
AS
BEGIN
	select   Kols.Guid
			,Kols.Code
			,Kols.Name
			,(SumCredit-SumDebit) as Rem
			,case when (SumDebit-SumCredit)>0 then SumDebit-SumCredit else 0 end as Rem_Debit
			,case when (SumCredit-SumDebit)>0 then SumCredit-SumDebit else 0 end as Rem_Credit from (
				SELECT [KolGuid]
						,sum([Debit]) as SumDebit
						,sum([Credit]) as SumCredit
				FROM SanadDetails inner join Moeins on SanadDetails.MoeinGuid=Moeins.Guid
								  inner join Kols on Moeins.KolGuid=Kols.Guid
				group by KolGuid ) 
			as T inner join Kols on t.KolGuid=Kols.Guid
	order by Kols.Code
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_TarazHesab]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_TarazHesab]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_TarazHesab] 
	@Date1 datetime,
	@Date2 datetime,
	
	@Code1 bigint=0,
	@Code2 bigint=999999999999999
AS
BEGIN
	set @Code1=isnull(@code1,0)
	set @Code2=isnull(@code2,0)

	declare @Report_TarazHesab table
	(
		Guid uniqueidentifier,
		Code bigint,
		KolGuid uniqueidentifier,
		MoeinGuid uniqueidentifier,
		TafsilGuid uniqueidentifier,
		SD_Debit decimal,
		SD_Credit decimal,
		DD_Debit decimal,
		DD_Credit decimal,
		ED_Debit decimal,
		ED_Credit decimal,
		Total_Debit decimal,
		Total_Credit decimal,
		RemPayan2re decimal
	)

	insert into @Report_TarazHesab
			(KolGuid,MoeinGuid,TafsilGuid,Total_Debit,Total_Credit)	
	SELECT	KolGuid,
			MoeinGuid,
			TafsilGuid,
			SUM([Debit]) AS Debit,
			sum([Credit]) as Credit
	FROM [dbo].[SanadDetails] inner join Moeins on SanadDetails.MoeinGuid=Moeins.Guid
	group by KolGuid,MoeinGuid,TafsilGuid

	update @Report_TarazHesab
	set SD_Debit=x.Debit,
		SD_Credit=x.credit
	from @Report_TarazHesab as temp inner join
		(SELECT	KolGuid,
				MoeinGuid,
				TafsilGuid,
				SUM([Debit]) AS Debit,
				sum([Credit]) as Credit
		FROM [dbo].SanadDetails inner join Moeins on SanadDetails.MoeinGuid=Moeins.Guid
				inner join Sanads on SanadDetails.MasterGuid=Sanads.Guid
		where Sanads.DateM<@Date1
		group by KolGuid,MoeinGuid,TafsilGuid
		) as x on x.KolGuid=temp.KolGuid and x.MoeinGuid=temp.MoeinGuid and x.TafsilGuid=temp.TafsilGuid

	update @Report_TarazHesab
	set ED_Debit=x.Debit,
		ED_Credit=x.credit
	from @Report_TarazHesab as temp inner join
		(SELECT	KolGuid,
				MoeinGuid,
				TafsilGuid,
				SUM([Debit]) AS Debit,
				sum([Credit]) as Credit
		FROM [dbo].SanadDetails inner join Moeins on SanadDetails.MoeinGuid=Moeins.Guid
					inner join Sanads on SanadDetails.MasterGuid=Sanads.Guid
		where Sanads.DateM>@Date2
		group by KolGuid,MoeinGuid,TafsilGuid
		) as x on x.KolGuid=temp.KolGuid and x.MoeinGuid=temp.MoeinGuid and x.TafsilGuid=temp.TafsilGuid

	update @Report_TarazHesab
	set DD_Debit=x.Debit,
		DD_Credit=x.credit
	from @Report_TarazHesab as temp inner join
		(SELECT	KolGuid,
				MoeinGuid,
				TafsilGuid,
				SUM([Debit]) AS Debit,
				sum([Credit]) as Credit
		FROM [dbo].SanadDetails inner join Moeins on SanadDetails.MoeinGuid=Moeins.Guid
					inner join Sanads on SanadDetails.MasterGuid=Sanads.Guid
		where Sanads.DateM>=@Date1 and Sanads.DateM<=@Date2
		group by KolGuid,MoeinGuid,TafsilGuid
		) as x on x.KolGuid=temp.KolGuid and x.MoeinGuid=temp.MoeinGuid and x.TafsilGuid=temp.TafsilGuid

	update @Report_TarazHesab
		set SD_Debit=isnull(SD_Debit,0),
		SD_Credit=isnull(SD_Credit,0),
		DD_Debit=isnull(DD_Debit,0),
		DD_Credit=isnull(DD_Credit,0),
		ED_Debit=isnull(ED_Debit,0),
		ED_Credit=isnull(ED_Credit,0),
		Total_Debit=isnull(Total_Debit,0),
		Total_Credit=isnull(Total_Credit,0),
		RemPayan2re=isnull(RemPayan2re,0)

	declare @Moein table
	(
		MoeinGuid uniqueidentifier
	)

	declare @MoeinTafsil table
	(
		MoeinGuid uniqueidentifier
	)

	insert into @Moein 
	select MoeinGuid
	from @Report_TarazHesab
	where ISNULL(TafsilGuid,'00000000-0000-0000-0000-000000000000')='00000000-0000-0000-0000-000000000000'

	insert into @MoeinTafsil
	select MoeinGuid
	from @Report_TarazHesab
	where ISNULL(TafsilGuid,'00000000-0000-0000-0000-000000000000')<>'00000000-0000-0000-0000-000000000000'

	--حسابهای معینی که فقط در سطح تفصیل سند خورده اند
	insert into @Report_TarazHesab
		(KolGuid,MoeinGuid,TafsilGuid,Total_Debit,Total_Credit,SD_Debit,SD_Credit,DD_Debit,DD_Credit,ED_Debit,ED_Credit)	
	SELECT	
		KolGuid,
		temp.MoeinGuid,
		'00000000-0000-0000-0000-000000000000' as [TafsilID],
		sum(Total_Debit),
		sum(Total_Credit),
		sum(SD_Debit),
		sum(SD_Credit),
		sum(DD_Debit),
		sum(DD_Credit),
		sum(ED_Debit),
		sum(ED_Credit)	
	FROM @Report_TarazHesab as temp left outer join @Moein as Moein on Temp.MoeinGuid=Moein.MoeinGuid
	where ISNULL(TafsilGuid,'00000000-0000-0000-0000-000000000000')<>'00000000-0000-0000-0000-000000000000' and ISNULL(Moein.MoeinGuid,'00000000-0000-0000-0000-000000000000')='00000000-0000-0000-0000-000000000000'
	group by KolGuid,temp.MoeinGuid
	
	--حسابهای معینی که هم در سطح معین و هم در سطح تفصیلی سند خورده اند
	-- برای این حسابها باید گردش با تفصیلی به جمه گردش بدون تفصیلی اضافه شود
	update @Report_TarazHesab 
	set Total_Debit=x.Total_Debit,
		Total_Credit=x.Total_Credit,
		SD_Debit=x.SD_Debit,
		SD_Credit=x.SD_Credit,
		DD_Debit=x.DD_Debit,
		DD_Credit=x.DD_Credit,
		ED_Debit=x.ED_Debit,
		ED_Credit=x.ED_Credit	
	from (select o.MoeinGuid,
			sum(Total_Debit) as Total_Debit,
			sum(Total_Credit) as Total_Credit,
			sum(SD_Debit) as SD_Debit,
			sum(Sd_Credit) as SD_Credit,
			sum(DD_Debit) as DD_Debit,
			sum(Dd_Credit) as DD_Credit,
			sum(ED_Debit) as ED_Debit,
			sum(Ed_Credit) as ED_Credit
		from @Report_TarazHesab as o inner join 	(select MoeinGuid	from @Moein
											INTERSECT
									     select MoeinGuid	from @MoeinTafsil) AS d1
		on d1.MoeinGuid=o.MoeinGuid
		group by o.MoeinGuid) as x inner join @Report_TarazHesab as p
											on x.MoeinGuid=p.MoeinGuid and ISNULL(p.MoeinGuid,'00000000-0000-0000-0000-000000000000')<>'00000000-0000-0000-0000-000000000000' and 
											   ISNULL(p.TafsilGuid,'00000000-0000-0000-0000-000000000000')='00000000-0000-0000-0000-000000000000'


	insert into @Report_TarazHesab
		(KolGuid,MoeinGuid,TafsilGuid,Total_Debit,Total_Credit,SD_Debit,SD_Credit,DD_Debit,DD_Credit,ED_Debit,ED_Credit)	
	SELECT	
		KolGuid,
		'00000000-0000-0000-0000-000000000000' as MoeinGuid,
		'00000000-0000-0000-0000-000000000000' as TafsilGuid,
		sum(Total_Debit),
		sum(Total_Credit),
		sum(SD_Debit),
		sum(SD_Credit),
		sum(DD_Debit),
		sum(DD_Credit),
		sum(ED_Debit),
		sum(ED_Credit)	
	FROM @Report_TarazHesab as temp
	where ISNULL(temp.TafsilGuid,'00000000-0000-0000-0000-000000000000')='00000000-0000-0000-0000-000000000000'
	group by KolGuid

	update @Report_TarazHesab
	set Guid=Kols.Guid,
		Code=Kols.Code
	from @Report_TarazHesab as temp inner join Kols on KolGuid=temp.KolGuid 

	update @Report_TarazHesab
	set Guid=Moeins.Guid,
		Code=Moeins.Code
	from @Report_TarazHesab as temp inner join Moeins on Moeins.Guid=temp.MoeinGuid 

	update @Report_TarazHesab
	set Guid=Tafsils.Guid,
		Code=Tafsils.Code
	from @Report_TarazHesab as temp inner join Tafsils on Tafsils.Guid=temp.TafsilGuid
	
	
	update @Report_TarazHesab
	set RemPayan2re=SD_Credit-SD_Debit-DD_Debit+DD_Credit

	select	tbl.KolGuid,
			tbl.MoeinGuid,
			tbl.TafsilGuid,
			tbl.Code,
			tbl.RemPayan2re as Account,
			case sign(Tafsils.Account) when -1 then abs(Tafsils.Account) else 0 end as Debit,
			case sign(Tafsils.Account) when 1 then Tafsils.Account else 0 end as Credit,
			tbl.SD_Debit,
			tbl.SD_Credit,
			tbl.DD_Debit,
			tbl.DD_Credit,
			tbl.ED_Debit,
			tbl.ED_Credit,
			case sign(tbl.RemPayan2re) when -1 then abs(tbl.RemPayan2re) else 0 end as RemPayan2reDebit,
			case sign(tbl.RemPayan2re) when 1 then tbl.RemPayan2re else 0 end as RemPayan2reCredit,
			Tafsils.Name As TafsilName,
			Moeins.Name As MoeinName,
			Moeins.Code As MoeinCode,
			Tafsils.Code As TafsilCode
	from @Report_TarazHesab as tbl inner join Tafsils on Tafsils.Guid=tbl.TafsilGuid
			inner join Moeins on tbl.MoeinGuid=Moeins.Guid
	Where (tbl.DD_Debit<>0 or tbl.DD_Credit<>0) and
		tbl.KolGuid<>'00000000-0000-0000-0000-000000000000' and
		tbl.MoeinGuid<>'00000000-0000-0000-0000-000000000000' and
	  (isnull(@Code1,0)=0 and isnull(@Code2,0)=0 or Tafsils.Code between @Code1 and @Code2)
		 
	order by tbl.Code
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Calendar_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Calendar_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Calendar_GetAll
AS
BEGIN
	select * from Calendars
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Calendar_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Calendar_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Calendar_Get
	@guid uniqueidentifier
AS
BEGIN
	select * from Calendars
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Calendar_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Calendar_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Calendar_Save
	@guid uniqueidentifier,
	@modif datetime,
	@dateM datetime,
	@monasebat nvarchar(500),
	@desc nvarchar(max),
	@isTatil bit
AS
BEGIN
	UPDATE [dbo].[Calendars]
	   SET [Modified] = @modif
		  ,[DateM] = @dateM
		  ,[Monasebat] = @monasebat
		  ,[Description] = @desc
		  ,[isTatil] = @isTatil
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Calendars]
           ([Guid]
           ,[Modified]
           ,[DateM]
           ,[Monasebat]
           ,[Description]
           ,[isTatil])
		VALUES
           (@guid
           ,@modif
           ,@dateM
           ,@monasebat
           ,@desc
           ,@isTatil)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Calendar_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Calendar_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Calendar_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from [dbo].[Calendars]
	WHERE [Guid] = @guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Calendar_RemoveAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Calendar_RemoveAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Calendar_RemoveAll
AS
BEGIN
	delete from [dbo].[Calendars]
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_GetAllBuildingReport]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_GetAllBuildingReport]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Regions_GetAllBuildingReport
AS
BEGIN
	WITH cte AS (
    SELECT 
        RegionGuid, 
        ROW_NUMBER() OVER (
            PARTITION BY 
                RegionGuid
            ORDER BY 
                RegionGuid
        ) row_num
     FROM Buildings
)
select RegionGuid,Regions.Name,MAX(row_num) as sum_ from cte
	inner join Regions on cte.RegionGuid=Regions.Guid
group by RegionGuid,Regions.Name
order by sum_ desc
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_GetAllRequestReport]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_GetAllRequestReport]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Regions_GetAllRequestReport
AS
BEGIN
	WITH cte AS (
    SELECT 
        RegionGuid, 
        ROW_NUMBER() OVER (
            PARTITION BY 
                RegionGuid
            ORDER BY 
                RegionGuid
        ) row_num
     FROM BuildingRequestRegions
)
select RegionGuid,Regions.Name,MAX(row_num) as sum_ from cte
	inner join Regions on cte.RegionGuid=Regions.Guid
group by RegionGuid,Regions.Name
order by sum_ desc
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_SetArchive]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_SetArchive]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Building_SetArchive]
	@date datetime
AS
BEGIN
	update Buildings
	set IsArchive='true',Modified=GETDATE()
	where CreateDate<=@date and Guid not in(select BuildingGuid from Contracts)

	update Buildings
	set IsArchive='false',Modified=GETDATE()
	where CreateDate>@date and Guid not in(select BuildingGuid from Contracts)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_WorkingRange_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_WorkingRange_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_WorkingRange_GetAll
AS
BEGIN
	Select * from WorkingRanges
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_WorkingRange_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_WorkingRange_Get]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_WorkingRange_Get
	@Guid uniqueidentifier
AS
BEGIN
	Select * from WorkingRanges
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_WorkingRange_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_WorkingRange_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_WorkingRange_Save
	@Guid uniqueidentifier,
	@regionGuid uniqueidentifier
AS
BEGIN
	INSERT INTO [dbo].[WorkingRanges]
           ([Guid]
           ,[RegionGuid])
     VALUES
           (@Guid
           ,@regionGuid)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_WorkingRange_DeleteAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_WorkingRange_DeleteAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_WorkingRange_DeleteAll
AS
BEGIN
	Delete from WorkingRanges
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_SelectTodayNotes]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_SelectTodayNotes]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Note_SelectTodayNotes] 
	@d1 datetime,
	@d2 datetime,
	@userGuid uniqueidentifier
AS
BEGIN
	select [dbo].[Notes].*,[dbo].[Users].Name as UserName
	from [dbo].[Notes] inner join [dbo].[Users]
	on [dbo].[Notes].UserGuid=[dbo].[Users].Guid
	where [dbo].[Notes].DateSarresid is not null
		  and [dbo].[Notes].DateSarresid>=@d1
		  and [dbo].[Notes].DateSarresid<=@d2
		  and [dbo].[Notes].UserGuid=@userGuid
		  and [dbo].[Notes].NoteStatus=1
End