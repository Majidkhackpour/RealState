IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Cities_States]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cities]'))
ALTER TABLE [dbo].[Cities]  WITH CHECK ADD  CONSTRAINT [FK_Cities_States] FOREIGN KEY([StateGuid])
REFERENCES [dbo].[States] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Regions_States]') AND parent_object_id = OBJECT_ID(N'[dbo].[Regions]'))
ALTER TABLE [dbo].[Regions]  WITH CHECK ADD  CONSTRAINT [FK_Regions_States] FOREIGN KEY([CityGuid])
REFERENCES [dbo].[Cities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Peoples]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Peoples] FOREIGN KEY([OwnerGuid])
REFERENCES [dbo].[Peoples] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Users] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Cities]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Cities] FOREIGN KEY([CityGuid])
REFERENCES [dbo].[Cities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Regions]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Regions] FOREIGN KEY([RegionGuid])
REFERENCES [dbo].[Regions] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingType] FOREIGN KEY([BuildingTypeGuid])
REFERENCES [dbo].[BuildingTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingAccountType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingAccountType] FOREIGN KEY([BuildingAccountTypeGuid])
REFERENCES [dbo].[BuildingAccountTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_BuildingView]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_BuildingView] FOREIGN KEY([BuildingViewGuid])
REFERENCES [dbo].[BuildingViews] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_FloorCover]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_FloorCover] FOREIGN KEY([FloorCoverGuid])
REFERENCES [dbo].[FloorCovers] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_KitchenService]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_KitchenService] FOREIGN KEY([KitchenServiceGuid])
REFERENCES [dbo].[KitchenServices] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_BuildingsReq_Asker]') AND parent_object_id = OBJECT_ID(N'[dbo].[BuildingRequests]'))
ALTER TABLE [dbo].[BuildingRequests]  WITH CHECK ADD  CONSTRAINT [FK_BuildingsReq_Asker] FOREIGN KEY([AskerGuid])
REFERENCES [dbo].[Peoples] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_UserLog_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[UserLogs]'))
ALTER TABLE [dbo].[UserLogs]  WITH CHECK ADD  CONSTRAINT [FK_UserLog_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Note_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[Notes]'))
ALTER TABLE [dbo].[Notes]  WITH CHECK ADD  CONSTRAINT [FK_Note_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_SmsLog_User]') AND parent_object_id = OBJECT_ID(N'[dbo].[SmsLogs]'))
ALTER TABLE [dbo].[SmsLogs]  WITH CHECK ADD  CONSTRAINT [FK_SmsLog_User] FOREIGN KEY([UserGuid])
REFERENCES [dbo].[Users] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Rental]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Rental] FOREIGN KEY([RentalAutorityGuid])
REFERENCES [dbo].[RentalAuthorities] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_DocType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_DocType] FOREIGN KEY([DocumentType])
REFERENCES [dbo].[DocumentTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_Condition]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_Condition] FOREIGN KEY([BuildingConditionGuid])
REFERENCES [dbo].[BuildingConditions] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_View]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_View] FOREIGN KEY([BuildingViewGuid])
REFERENCES [dbo].[BuildingViews] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_AccType]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_AccType] FOREIGN KEY([BuildingAccountTypeGuid])
REFERENCES [dbo].[BuildingAccountTypes] ([Guid])
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Buildings_FloorCover]') AND parent_object_id = OBJECT_ID(N'[dbo].[Buildings]'))
ALTER TABLE [dbo].[Buildings]  WITH CHECK ADD  CONSTRAINT [FK_Buildings_FloorCover] FOREIGN KEY([FloorCoverGuid])
REFERENCES [dbo].[FloorCovers] ([Guid])
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@account decimal,
	@hGroup smallint
AS
BEGIN
	UPDATE [dbo].[Kols]
   SET [Modified] = @modif
      ,[Status] = @st
      ,[Name] = @name
      ,[Code] = @name
      ,[Account] = @account
      ,[HesabGroup] = @hGroup
	WHERE [Guid] = @guid
	
	if @@ROWCOUNT=0
	begin
		INSERT INTO [dbo].[Kols]
			   ([Guid]
			   ,[Modified]
			   ,[Status]
			   ,[Name]
			   ,[Code]
			   ,[Account]
			   ,[HesabGroup])
		 VALUES
			   (@guid
			   ,@modif
			   ,@st
			   ,@name
			   ,@code
			   ,@account
			   ,@hGroup)
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_SelectAll
AS
BEGIN
	select * from Kols 
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Kol_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Kol_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Kol_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	select * from Kols
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@account decimal,
	@kolGuid uniqueidentifier
AS
BEGIN
	UPDATE [dbo].[Moeins]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Code] = @code
		  ,[KolGuid] = @kolGuid
		  ,[Account] = @account
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Moeins]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Code]
           ,[KolGuid]
           ,[DateM]
           ,[Account])
		VALUES
           (@guid
           ,@modif
           ,@st
		   ,@name
           ,@code
           ,@kolGuid
           ,GETDATE()
           ,@account)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_SelectAll
AS
BEGIN
	select * from Moeins
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Moeins
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_GetByCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_GetByCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_GetByCode
	@code nvarchar(10)
AS
BEGIN
	select * from Moeins
	where Code=@code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_UpdateAccount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_UpdateAccount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Moein_UpdateAccount
	@guid uniqueidentifier,
	@price decimal
AS
BEGIN
	declare @kolGuid uniqueidentifier

	set @kolGuid = (select KolGuid from Moeins where Guid=@guid)

	update Moeins
	set Account = Account + @price
	where Guid = @guid

	update Kols
	set Account = Account + @price
	where Guid = @kolGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Save]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Tafsil_Save]
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@desc nvarchar(max),
	@account decimal,
	@accFirst decimal,
	@hType int,
	@isSystem bit,
	@BankCreditMoeinGuid uniqueidentifier,
	@SandouqCreditMoeinGuid uniqueidentifier,
	@HazineCreditMoeinGuid uniqueidentifier,
	@TafsilCreditMoeinGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier
AS
BEGIN
	declare @AccountF_Before decimal
	Set @AccountF_Before = (Select isnull(AccountFirst,0) from Tafsils where Guid=@guid)
	set @AccountF_Before=isnull(@AccountF_Before,0)
	
	UPDATE [dbo].[Tafsils]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Code] = @code
		  ,[Description] = @desc
		  ,[HesabType] = @hType
		  ,[Account] = @account
		  ,[AccountFirst] = @accFirst
		  ,[isSystem] = @isSystem
	 WHERE [Guid] = @guid
	if @@ROWCOUNT=0
	begin
		INSERT INTO [dbo].[Tafsils]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Code]
           ,[Description]
           ,[HesabType]
           ,[DateM]
           ,[Account]
		   ,[AccountFirst]
           ,[isSystem])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@code
           ,@desc
           ,@hType
           ,GETDATE()
           ,@account
		   ,@accFirst
           ,@isSystem)
	 end

	if isnull(@accFirst,0) <> @AccountF_Before
		begin
			--Tafsil
			if(@hType=2 or @hType=6)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @TafsilCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @TafsilCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Bank
			if(@hType=4)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @BankCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @BankCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Sandouq
			if(@hType=5)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @SandouqCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @SandouqCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end

			--Hazine
			if(@hType=3)
			begin
				exec sp_Tafsil_Debit @guid,@AccountF_Before
				exec sp_Moein_Debit @HazineCreditMoeinGuid,@AccountF_Before
				exec sp_Tafsil_Credit @sarmayeTafsilGuid,@AccountF_Before
				exec sp_Moein_Credit @sarmayeMoeinGuid,@AccountF_Before
	
				exec sp_Moein_Credit @HazineCreditMoeinGuid,@accFirst
				exec sp_Tafsil_Credit @guid,@accFirst
				exec sp_Moein_Debit @sarmayeMoeinGuid,@accFirst
				exec sp_Tafsil_Debit @sarmayeTafsilGuid,@accFirst
			end
		
			Exec sp_Sanad_Update_Eftetahie @userGuid,@sarmayeTafsilGuid,@sarmayeMoeinGuid,@TafsilCreditMoeinGuid,@BankCreditMoeinGuid,@SandouqCreditMoeinGuid
		end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Tafsils
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_SelectAll
AS
BEGIN
	select * from Tafsils
	order by Code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_SelectRow
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Tafsils
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_GetByCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_GetByCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_GetByCode
	@code nvarchar(10)
AS
BEGIN
	select * from Tafsils
	where Code=@code
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_NextCode]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_NextCode
	@hType smallint
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Code) From Tafsils
	where HesabType = @hType
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_CheckCode]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Tafsil_CheckCode
	@guid uniqueidentifier,
	@code nvarchar(10)
AS
BEGIN
	select COUNT(*) from Tafsils
	where Code=@code and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_CheckName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_CheckName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_CheckName
	@guid uniqueidentifier,
	@name nvarchar(200)
AS
BEGIN
	select COUNT(*) from Tafsils
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_UpdateAccount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_UpdateAccount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Tafsil_UpdateAccount
	@guid uniqueidentifier,
	@price decimal
AS
BEGIN
	update Tafsils
	set Account = Account + @price
	where Guid = @guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Bank_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Bank_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Bank_SelectAll
AS
BEGIN
	Select Banks.*,Tafsils.Account,Tafsils.AccountFirst
	from Banks inner join Tafsils
	on Tafsils.Guid=Banks.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Bank_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Bank_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Bank_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select Banks.*,Tafsils.Account,Tafsils.AccountFirst
	from Banks inner join Tafsils
	on Tafsils.Guid=Banks.Guid
	where Banks.Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Banks_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Banks_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Banks_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Banks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Banks_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Banks_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Banks_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200),
	@code nvarchar(10),
	@desc nvarchar(max),
	@shobe nvarchar(200),
	@codeShobe nvarchar(20),
	@hesabNumber nvarchar(200)
AS
BEGIN
	UPDATE [dbo].[Banks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Code] = @code
		  ,[Name] = @name
		  ,[Shobe] = @shobe
		  ,[CodeShobe] = @codeShobe
		  ,[HesabNumber] = @hesabNumber
		  ,[Description] = @desc
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Banks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Code]
           ,[Name]
           ,[Shobe]
           ,[CodeShobe]
           ,[HesabNumber]
           ,[Description]
           ,[DateM])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@code
           ,@name
           ,@shobe
           ,@codeShobe
           ,@hesabNumber
           ,@desc
           ,GETDATE())
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAll
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_SelectRowByGroupGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_SelectRowByGroupGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_SelectRowByGroupGuid
	@GroupGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.GroupGuid=@GroupGuid and
		  Peoples.Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_SelectRowByGroupGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_SelectRowByGroupGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAllBirthDay
	@dateSh nvarchar(20)
AS
BEGIN
	Select Peoples.* , Tafsils.Account,Tafsils.AccountFirst
	From Peoples inner join Tafsils on
	Tafsils.Guid=Peoples.Guid
	where Peoples.DateBirth=@dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@code nvarchar(10),
	@name nvarchar(500),
	@nCode nvarchar(20),
	@idCode nvarchar(20),
	@fName nvarchar(200),
	@pBirth nvarchar(500),
	@dBirth nvarchar(20),
	@address nvarchar(max),
	@issued nvarchar(200),
	@postalCode nvarchar(50),
	@groupGuid uniqueidentifier
AS
BEGIN
	UPDATE [dbo].[Peoples]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Code] = @code
		  ,[Name] = @name
		  ,[NationalCode] = @nCode
		  ,[IdCode] = @idCode
		  ,[FatherName] = @fName
		  ,[PlaceBirth] = @pBirth
		  ,[DateBirth] = @dBirth
		  ,[Address] = @address
		  ,[IssuedFrom] = @issued
		  ,[PostalCode] = @postalCode
		  ,[GroupGuid] = @groupGuid
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Peoples]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Code]
           ,[Name]
           ,[NationalCode]
           ,[IdCode]
           ,[FatherName]
           ,[PlaceBirth]
           ,[DateBirth]
           ,[Address]
           ,[IssuedFrom]
           ,[PostalCode]
           ,[GroupGuid])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@code
           ,@name
           ,@nCode
           ,@idCode
           ,@fName
           ,@pBirth
           ,@dBirth
           ,@address
           ,@issued
           ,@postalCode
           ,@groupGuid)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	UPDATE [dbo].[Peoples]
			SET [Status] = @st
	        WHERE [Guid] = @Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * from Users
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetAll
AS
BEGIN
	Select * from Users
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(400),
	@userName nvarchar(200),
	@pass nvarchar(200),
	@access nvarchar(max),
	@questiion smallint,
	@answer nvarchar(400),
	@email nvarchar(50),
	@mobile nvarchar(50)
AS
BEGIN
	UPDATE [dbo].[Users]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[UserName] = @userName
		  ,[Password] = @pass
		  ,[Access] = @access
		  ,[SecurityQuestion] = @questiion
		  ,[AnswerQuestion] = @answer
		  ,[Email] = @email
		  ,[Mobile] = @mobile
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Users]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[UserName]
           ,[Password]
           ,[Access]
           ,[SecurityQuestion]
           ,[AnswerQuestion]
           ,[Email]
           ,[Mobile])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@name
           ,@userName
           ,@pass
           ,@access
           ,@questiion
           ,@answer
           ,@email
           ,@mobile)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_ChangeStatus
	@guid uniqueidentifier,
	@st bit
AS
BEGIN
	update Users
	set Status=@st
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_CheckUserName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_CheckUserName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_CheckUserName
	@guid uniqueidentifier,
	@userName nvarchar(200)
AS
BEGIN
	select COUNT(*) from Users
	where UserName=@userName and Guid<>@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByUserName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByUserName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByUserName
	@userName nvarchar(200)
AS
BEGIN
	Select * from Users
	Where UserName=@userName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByEmail]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByEmail]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByEmail
	@email nvarchar(50)
AS
BEGIN
	Select * from Users
	Where Email=@email
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetByMobile]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetByMobile]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetByMobile
	@mobile nvarchar(50)
AS
BEGIN
	Select * from Users
	Where Mobile=@mobile
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_User_GetAllByQuestion]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_User_GetAllByQuestion]	As Begin print 11 end')
GO
Alter PROCEDURE sp_User_GetAllByQuestion
	@question smallint,
	@answer nvarchar(400)
AS
BEGIN
	Select * from Users
	Where SecurityQuestion=@question and
		  AnswerQuestion=@answer
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAll] 
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Regions_SelectAll] 
AS
BEGIN
	select Regions.*,Cities.Name As CityName,States.Name As StateName
	from Regions left outer join Cities on Regions.CityGuid=Cities.Guid
	inner join States on Cities.StateGuid=States.Guid
	order by StateName,CityName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_SelectAllByCityGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_SelectAllByCityGuid]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Regions_SelectAllByCityGuid] 
	@cityGuid uniqueidentifier
AS
BEGIN
	select Regions.*,Cities.Name As CityName,States.Name As StateName
	from Regions inner join Cities on Regions.CityGuid=Cities.Guid
	inner join States on Cities.StateGuid=States.Guid
	where Regions.CityGuid=@cityGuid
	order by StateName,CityName
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_SelectAllByStateGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_SelectAllByStateGuid]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Cities_SelectAllByStateGuid] 
	@stateGuid uniqueidentifier
AS
BEGIN
	select Cities.*,States.Name As StateName
	from Cities inner join States 
	on Cities.StateGuid=States.Guid
	where Cities.StateGuid=@stateGuid
	order by StateName, Cities.Name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Buildings_SelectAll] 
AS
BEGIN
select [dbo].[Buildings].*,[dbo].[Peoples].Name As OwnerName,
       [dbo].[BuildingTypes].Name As BuildingTypeName,
	   [dbo].[Users].Name As UserName,
	   [dbo].[Regions].Name As RegionName,
	   [dbo].[RentalAuthorities].Name As RentalAuthorityName,
	   [dbo].[DocumentTypes].Name As DocumentTypeName,
	   [dbo].[BuildingConditions].Name As BuildingConditionName,
	   [dbo].[BuildingViews].Name As BuildingViewName,
	   [dbo].[FloorCovers].Name As FloorCoverName,
	   [dbo].[KitchenServices].Name As KitchenServiceName,
	   [dbo].[BuildingAccountTypes].Name As BuildingAccountTypeName
From [dbo].[Buildings] 
     inner join [dbo].[Peoples] on [dbo].[Buildings].OwnerGuid=[dbo].[Peoples].Guid
	 inner join [dbo].[BuildingTypes] on [dbo].[Buildings].BuildingTypeGuid=[dbo].[BuildingTypes].Guid
	 inner join [dbo].[Users] on [dbo].[Buildings].UserGuid=[dbo].[Users].Guid
	 inner join [dbo].[Regions] on [dbo].[Buildings].RegionGuid=[dbo].[Regions].Guid
	 inner join [dbo].[RentalAuthorities] on [dbo].[Buildings].RentalAutorityGuid=[dbo].[RentalAuthorities].Guid
	 inner join [dbo].[DocumentTypes] on [dbo].[Buildings].DocumentType=[dbo].[DocumentTypes].Guid
	 inner join [dbo].[BuildingConditions] on [dbo].[Buildings].BuildingConditionGuid=[dbo].[BuildingConditions].Guid
	 inner join [dbo].[BuildingViews] on [dbo].[Buildings].BuildingViewGuid=[dbo].[BuildingViews].Guid
	 inner join [dbo].[FloorCovers] on [dbo].[Buildings].FloorCoverGuid=[dbo].[FloorCovers].Guid
	 inner join [dbo].[KitchenServices] on [dbo].[Buildings].KitchenServiceGuid=[dbo].[KitchenServices].Guid
	 inner join [dbo].[BuildingAccountTypes] on [dbo].[Buildings].BuildingAccountTypeGuid=[dbo].[BuildingAccountTypes].Guid

	 Order By [dbo].[Buildings].CreateDate desc
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_FixImages]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_FixImages]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Building_FixImages]
AS
BEGIN
	UPDATE [Buildings] 
	SET Image = X.ImageName,Modified=GETDATE()
	FROM ( 
			SELECT top(1) ImageName FROM BuildingGalleries 
			where ISNULL(ImageName,'')<>''
		 ) AS X
	WHERE Buildings.Image is null or Buildings.Image=''
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingsReq_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingsReq_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_BuildingsReq_SelectAll] 
AS
BEGIN
select [dbo].[BuildingRequests].*,[dbo].[Peoples].Name As AskerName,
	   [dbo].[Users].Name As UserName
	   From [dbo].[BuildingRequests] 
	   inner join [dbo].[Peoples] on [dbo].[BuildingRequests].AskerGuid=[dbo].[Peoples].Guid
	   inner join [dbo].[Users] on [dbo].[BuildingRequests].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_SelectAll] 
AS
BEGIN
	select [dbo].[Contracts].*,[dbo].[Peoples].Name as fName,
	(select [dbo].[Peoples].Name from [dbo].[Peoples] where Guid=[dbo].[Contracts].SecondSideGuid) as sName,
	[dbo].[Users].Name as UserName
	from [dbo].[Contracts] left Outer join [dbo].[Peoples]
	on [dbo].[Contracts].FirstSideGuid=[dbo].[Peoples].Guid
	left outer join [dbo].[Users]
	on [dbo].[Contracts].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_SelectAll_ByUser_And_Date]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_SelectAll_ByUser_And_Date]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_UserLog_SelectAll_ByUser_And_Date] 
	@userGuid uniqueidentifier,
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	select [dbo].[UserLogs].*,[dbo].[Users].Name as UserName
	from [dbo].[UserLogs] inner join [dbo].[Users]
	on [dbo].[UserLogs].UserGuid=[dbo].[Users].Guid
	where Date>=@date1 and Date<=@date2 and UserGuid=@userGuid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Note_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Note_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Note_SelectAll] 
AS
BEGIN
	select [dbo].[Notes].*,[dbo].[Users].Name as UserName
	from [dbo].[Notes] inner join [dbo].[Users]
	on [dbo].[Notes].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Gardesh_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Gardesh_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Gardesh_SelectAll] 
AS
BEGIN
	select * from [dbo].[GardeshHesabs]
End
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SmsLog_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SmsLog_SelectAll]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_SmsLog_SelectAll] 
AS
BEGIN
	select [dbo].[SmsLogs].*,[dbo].[Users].Name As UserName
	from [dbo].[SmsLogs] inner join [dbo].[Users]
	on [dbo].[SmsLogs].UserGuid=[dbo].[Users].Guid
End
GO
-- ==========================================================================================
--IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
--	exec('Create Procedure [dbo].[sp_Pardakht_Save]	As Begin print 11 end')
--GO

--ALTER PROCEDURE [dbo].[sp_Pardakht_Save]
--	@guid uniqueidentifier,
--	@modif datetime,
--	@dateSh nvarchar(20),
--	@st bit='true',
--	@payer uniqueidentifier,
--	@createdate datetime,
--	@desc nvarchar(max)='',
--	@naqdprice bigint=0,
--	@bankprice bigint=0,
--	@checkprice bigint=0,
--	@fishNo nvarchar(50)='',
--	@checkNo nvarchar(50)='',
--	@sarresid nvarchar(50)='',
--	@bankname nvarchar(50)=''
--AS
--BEGIN
--	declare @gardeshprice bigint
--	declare @totalPrice bigint
--	declare @tarafHesab uniqueidentifier


--	set @gardeshprice=(ISNULL((select Price from GardeshHesabs
--		where ParentGuid=@guid and PeopleGuid=@payer),0))

--	set @totalPrice=(@naqdprice+@bankprice+@checkprice)

--	if(@gardeshprice<>0)
--	begin
--		update GardeshHesabs
--		set Price=@totalPrice
--		where ParentGuid=@guid and PeopleGuid=@payer
--	end
--	else
--	begin
--		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
--		values(4,N' ثبت سند پرداخت در تاریخ'+@dateSh,NEWID(), GETDATE(),@guid,@payer,@totalPrice,'true',2)
--	end

--	set @tarafHesab=(ISNULL((select Guid from Peoples
--		where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

--	if (@tarafHesab='00000000-0000-0000-0000-000000000000')
--	begin
--		set @tarafHesab=(ISNULL((select Guid from Users
--		where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

--		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--			set @tarafHesab=(ISNULL((select Guid from Hazines
--			where Guid=@payer),'00000000-0000-0000-0000-000000000000'))

--			update Hazines
--			set Account=Account-@gardeshprice
--			where Guid=@payer

--			update Hazines
--			set Account=Account+@totalPrice
--			where Guid=@payer
--		end
--		else
--		begin
--			update Users
--			set Account=Account-@gardeshprice
--			where Guid=@payer

--			update Users
--			set Account=Account+@totalPrice
--			where Guid=@payer
--		end
--	end
--	else
--	begin
--		    update Peoples
--			set Account=Account-@gardeshprice
--			where Guid=@payer

--			update Peoples
--			set Account=Account+@totalPrice
--			where Guid=@payer
--	end

--	update Pardakhts
--	set Modified=@modif,
--	Status=@st,
--	Payer=@payer,
--	NaqdPrice=@naqdprice,
--	BankPrice=@bankprice,
--	[Check]=@checkprice,
--	Description=@desc,
--	FishNo=@fishNo,
--	CheckNo=@checkNo,
--	SarResid=@sarresid,
--	BankName=@bankname
--	where Guid=@guid

--	if (@@ROWCOUNT=0)
--	begin
--		insert into Pardakhts(BankName,BankPrice,[Check],CheckNo,CreateDate,Description,FishNo,Guid,Modified,NaqdPrice,Payer,SarResid,Status)
--		values(@bankname,@bankprice,@checkprice,@checkNo,GETDATE(),@desc,@fishNo,@guid,GETDATE(),@naqdprice,@payer,@sarresid,@st)
--	end
--END
--GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_ChangeStatus]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_ChangeStatus]
	@conGuid uniqueidentifier,
	@st bit
AS
BEGIN	
	update ContractFinances
	set Status=@st
	where ConGuid=@conGuid

	update GardeshHesabs
	set Status=@st
	where ParentGuid=@conGuid

	update Contracts
	set Status=@st 
	where Guid=@conGuid

	declare @buildingGuid uniqueidentifier
	set @buildingGuid=(select BuildingGuid from Contracts where Guid=@conGuid)

	declare @fPrice bigint
	set @fPrice= (select FirstTotalPrice from ContractFinances where ConGuid=@conGuid)
	declare @fAddedd bigint
	set @fAddedd= (select FirstAddedValue from ContractFinances where ConGuid=@conGuid)
	declare @fDis bigint
	set @fDis= (select FirstDiscount from ContractFinances where ConGuid=@conGuid)
	declare @fGuid uniqueidentifier
	set @fGuid=(select FirstSideGuid from Contracts where Guid=@conGuid)

	set @fPrice=(@fPrice+@fAddedd)-@fDis

	declare @sPrice bigint
	set @sPrice= (select SecondTotalPrice from ContractFinances where ConGuid=@conGuid)
	declare @sAddedd bigint
	set @sAddedd= (select SecondAddedValue from ContractFinances where ConGuid=@conGuid)
	declare @sDis bigint
	set @sDis= (select SecondDiscount from ContractFinances where ConGuid=@conGuid)
	declare @sGuid uniqueidentifier
	set @sGuid=(select SecondSideGuid from Contracts where Guid=@conGuid)

	set @sPrice=(@sPrice+@sAddedd)-@sDis

	declare @bPrice bigint
	set @bPrice= (select BazaryabPrice from Contracts where Guid=@conGuid)

	declare @bGuid uniqueidentifier
	set @bGuid=(select BazaryabGuid from Contracts where Guid=@conGuid)

	if(@st='true')
	begin
		--update Peoples
		--set Account=Account+@fPrice
		--where Guid=@fGuid

		--update Peoples
		--set Account=Account+@SPrice
		--where Guid=@sGuid

		--update Users
		--set Account =Account-@bPrice
		--where Guid=@bGuid

		update Buildings
		set IsArchive='true'
		where Guid=@buildingGuid
	end
	else
	begin
		--update Peoples
		--set Account=Account-@fPrice
		--where Guid=@fGuid

		--update Peoples
		--set Account=Account-@SPrice
		--where Guid=@sGuid

		--update Users
		--set Account =Account+@bPrice
		--where Guid=@bGuid

		update Buildings
		set IsArchive='false'
		where Guid=@buildingGuid
	end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Save]	As Begin print 11 end')
GO

ALTER PROCEDURE [dbo].[sp_Contract_Save]
	@Guid uniqueidentifier,
	@st bit,
	@modif datetime,
	@code bigint,
	@isTemp bit,
	@fGuid uniqueidentifier,
	@sGuid uniqueidentifier,
	@term int,
	@fromDate datetime,
	@totalPrice bigint=0,
	@minorPrice bigint=0,
	@checkNo nvarchar(200)='',
	@bankName nvarchar(200)='',
	@shobe nvarchar(200)='',
	@sareresid nvarchar(20)='',
	@discharcgDate datetime,
	@setDocDate datetime,
	@setDocPlace nvarchar(500)='',
	@sarqofli bigint=0,
	@delay bigint=0,
	@desc nvarchar(Max)='',
	@userGuid uniqueidentifier,
	@buGuid uniqueidentifier,
	@type smallint,
	@dateM datetime,
	@dateSh nvarchar(20)='',
	@fPrice bigint=0,
	@sPrice bigint=0,
	@fSidePrice bigint=0,
	@sSidePrice bigint=0,
	@bazaryabGuid uniqueidentifier='00000000-0000-0000-0000-000000000000',
	@bazaryabPrice bigint=0
AS
BEGIN	
	--update Peoples
	--set Account=Account-@fPrice
	--where Guid=@fGuid
	--update Peoples
	--set Account=Account+@fSidePrice
	--where Guid=@fGuid


	--update Peoples
	--set Account=Account-@sPrice
	--where Guid=@sGuid
	--update Peoples
	--set Account=Account+@sSidePrice
	--where Guid=@sGuid

	delete from GardeshHesabs
	where ParentGuid=@Guid

	declare @gardeshGuid uniqueidentifier
	set @gardeshGuid=(isnull((select Guid from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@fGuid),'00000000-0000-0000-0000-000000000000'))

	if @gardeshGuid='00000000-0000-0000-0000-000000000000'
	begin
		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(2,N'عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@fGuid,@fSidePrice,'true',2)

		insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
		values(2,N'عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@sGuid,@sSidePrice,'true',2)
	end
	else
	begin
		update GardeshHesabs
		set Price=@fSidePrice
		where ParentGuid=@Guid and PeopleGuid=@fGuid
		update GardeshHesabs
		set Price=@sSidePrice
		where ParentGuid=@Guid and PeopleGuid=@sGuid
	end

	update Buildings
	set IsArchive='true'
	where Guid=@buGuid

	declare @contractGuid uniqueidentifier
	set @contractGuid=(isnull((select Guid from Contracts where Guid=@Guid),'00000000-0000-0000-0000-000000000000'))

	declare @contractPrice bigint
	set @contractPrice=(isnull((select BazaryabPrice from Contracts where Guid=@Guid),0))

	declare @contractBazaryab uniqueidentifier
	set @contractBazaryab=(isnull((select BazaryabGuid from Contracts where Guid=@Guid),'00000000-0000-0000-0000-000000000000'))

	if @contractGuid<>'00000000-0000-0000-0000-000000000000'
	begin
		--update Users
		--set Account=Account+@contractPrice
		--where Guid=@contractBazaryab

		delete from GardeshHesabs
		where ParentGuid=@Guid and PeopleGuid=@contractBazaryab
	end

	if @bazaryabGuid<>'00000000-0000-0000-0000-000000000000'
	begin
		declare @bGardeshGuid uniqueidentifier
		set @bGardeshGuid=(isnull((select Guid from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid),'00000000-0000-0000-0000-000000000000'))

		declare @bGardeshPrice bigint
		set @bGardeshPrice=(isnull((select Price from GardeshHesabs where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid),0))

		if @bGardeshGuid='00000000-0000-0000-0000-000000000000'
		begin
			insert into GardeshHesabs(Babat,Description,Guid,Modified,ParentGuid,PeopleGuid,Price,Status,Type)
			values(2,N'پورسانت عقد قرارداد به شماره '+CAST(@code AS nvarchar(100))+' در تاریخ '+@dateSh,NEWID(), GETDATE(),@guid,@bazaryabGuid,@bazaryabPrice,'true',3)
		end
		else
		begin
			update GardeshHesabs
			set Price=@bazaryabPrice
			where ParentGuid=@Guid and PeopleGuid=@bazaryabGuid
		end

		--update Users
		--set Account=Account-@bazaryabPrice
		--where Guid=@bazaryabGuid
	end

	update Contracts 
	set Status=@st,
	Modified=@modif,
	Code=@code,
	IsTemp=@isTemp,
	FirstSideGuid=@fGuid,
	SecondSideGuid=@sGuid,
	Term=@term,
	FromDate=@fromDate,
	TotalPrice=@totalPrice,
	MinorPrice=@minorPrice,
	CheckNo=@checkNo,
	BankName=@bankName,
	Shobe=@shobe,
	SarResid=@sareresid,
	DischargeDate=@discharcgDate,
	SetDocDate=@setDocDate,
	SetDocPlace=@setDocPlace,
	SarQofli=@sarqofli,
	Delay=@delay,
	Description=@desc,
	UserGuid=@userGuid,
	BuildingGuid=@buGuid,
	Type=@type,
	DateM=@dateM,
	BazaryabGuid=@bazaryabGuid,
	BazaryabPrice=@bazaryabPrice
	where Guid=@Guid

	if (@@ROWCOUNT=0)
	begin
		insert into Contracts(
				Guid,Status,Modified,IsTemp,Code,FirstSideGuid,SecondSideGuid,Term,FromDate,
				TotalPrice,MinorPrice,CheckNo,BankName,Shobe,SarResid,DischargeDate,
				SetDocDate,SetDocPlace,SarQofli,Delay,Description,UserGuid,BuildingGuid,
				Type,DateM,BazaryabGuid,BazaryabPrice
		)
		values(
				@Guid,@st,@modif,@isTemp,@code,@fGuid,@sGuid,@term,@fromDate,
				@totalPrice,@minorPrice,@checkNo,@bankName,@shobe,@sareresid,@discharcgDate,
				@setDocDate,@setDocPlace,@sarqofli,@delay,@desc,@userGuid,@buGuid,
				@type,@dateM,@bazaryabGuid,@bazaryabPrice
		)
	end
END
GO
-- ==========================================================================================
--IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
--	exec('Create Procedure [dbo].[sp_Pardakht_ChangeStatus]	As Begin print 11 end')
--GO

--Alter PROCEDURE sp_Pardakht_ChangeStatus	
--	@guid uniqueidentifier,
--	@hesabGuid uniqueidentifier,
--	@st bit,
--	@price bigint
--AS
--BEGIN
--	update GardeshHesabs
--	set Status=@st
--	where PeopleGuid=@hesabGuid and ParentGuid=@guid

--	declare @tarafHesab uniqueidentifier

--	if (@st='true')
--	begin
--		set @tarafHesab=(ISNULL((select Guid from Peoples
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--		set @tarafHesab=(ISNULL((select Guid from Users
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--			set @tarafHesab=(ISNULL((select Guid from Hazines
--			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--			update Hazines
--			set Account=Account+@price
--			where Guid=@hesabGuid
--		end
--		else
--		begin
--			update Users
--			set Account=Account+@price
--			where Guid=@hesabGuid
--		end
--end
--else
--begin
--		update Peoples
--		set Account=Account+@price
--		where Guid=@hesabGuid
--end
--	end
--	else
--	begin
--		set @tarafHesab=(ISNULL((select Guid from Peoples
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--		set @tarafHesab=(ISNULL((select Guid from Users
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--			set @tarafHesab=(ISNULL((select Guid from Hazines
--			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--			update Hazines
--			set Account=Account-@price
--			where Guid=@hesabGuid
--		end
--		else
--		begin
--			update Users
--			set Account=Account-@price
--			where Guid=@hesabGuid
--		end
--		end
--		else
--		begin
--			update Peoples
--			set Account=Account-@price
--			where Guid=@hesabGuid
--		end
--	end

--	update Pardakhts
--	set Status=@st
--	where Guid=@guid
--END
--GO
-- ==========================================================================================
--IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
--	exec('Create Procedure [dbo].[sp_Reception_ChangeStatus]	As Begin print 11 end')
--GO

--Alter PROCEDURE sp_Reception_ChangeStatus	
--	@guid uniqueidentifier,
--	@hesabGuid uniqueidentifier,
--	@st bit,
--	@price bigint
--AS
--BEGIN
--	update GardeshHesabs
--	set Status=@st
--	where PeopleGuid=@hesabGuid and ParentGuid=@guid

--	declare @tarafHesab uniqueidentifier

--	if (@st='true')
--	begin
--		set @tarafHesab=(ISNULL((select Guid from Peoples
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--		set @tarafHesab=(ISNULL((select Guid from Users
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--			set @tarafHesab=(ISNULL((select Guid from Hazines
--			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--			update Hazines
--			set Account=Account-@price
--			where Guid=@hesabGuid
--		end
--		else
--		begin
--			update Users
--			set Account=Account-@price
--			where Guid=@tarafHesab
--		end
--end
--else
--begin
--		update Peoples
--		set Account=Account-@price
--		where Guid=@hesabGuid
--end
--	end
--	else
--	begin
--		set @tarafHesab=(ISNULL((select Guid from Peoples
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if (@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--		set @tarafHesab=(ISNULL((select Guid from Users
--		where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--		if(@tarafHesab='00000000-0000-0000-0000-000000000000')
--		begin
--			set @tarafHesab=(ISNULL((select Guid from Hazines
--			where Guid=@hesabGuid),'00000000-0000-0000-0000-000000000000'))

--			update Hazines
--			set Account=Account+@price
--			where Guid=@tarafHesab
--		end
--		else
--		begin
--			update Users
--			set Account=Account+@price
--			where Guid=@tarafHesab
--		end
--		end
--		else
--		begin
--			update Peoples
--			set Account=Account+@price
--			where Guid=@tarafHesab
--		end
--	end

--	update Receptions
--	set Status=@st
--	where Guid=@guid
--END
--GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Peoples_GetAllBirthDay]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Peoples_GetAllBirthDay]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Peoples_GetAllBirthDay 
	@dateSh nvarchar(20)
AS
BEGIN
	Select * from Peoples
	where DateBirth=@dateSh
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_GetAll
AS
BEGIN
	Select * from [dbo].[Temps]
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Temp_Save
	@guid uniqueidentifier,
	@modif datetime,
	@type smallint,
	@objGuid uniqueidentifier
AS
BEGIN
	insert into [dbo].[Temps](
		 Guid
		,Modified
		,ObjectGuid
		,Status
		,Type)
		values(
		 @guid
		,@modif
		,@objGuid
		,'true'
		,@type)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Temp_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Temp_Remove]	As Begin print 11 end')
GO

Alter PROCEDURE sp_Temp_Remove
	@guid uniqueidentifier
AS
BEGIN
	Delete from [dbo].[Temps]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Count
	@userGuid uniqueidentifier,
	@type smallint
AS
BEGIN
	declare @count int
	if(@userGuid='00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings)
		select @count
		return @count
	end
	else if(@userGuid<>'00000000-0000-0000-0000-000000000000' and @type=0)
	begin
		set @count=(select COUNT(*) from Buildings where UserGuid=@userGuid)
		select @count
		return @count
	end
	else if(@type=1) --Rahn
	begin
		set @count=(select COUNT(*) from Buildings where RahnPrice1>0 or RahnPrice2>0 or EjarePrice1>0 or EjarePrice2>0)
		select @count
		return @count
	end
	else if(@type=2) --Foroush
	begin
		set @count=(select COUNT(*) from Buildings where SellPrice>0)
		select @count
		return @count
	end	
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_Count
	@userGuid uniqueidentifier
AS
BEGIN
	declare @count int
	set @count = (select COUNT(*)
					from Contracts
					where UserGuid=@userGuid)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Requests_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Requests_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Requests_Count	
	@userGuid uniqueidentifier
AS
BEGIN	
	declare @count int
	if (@userGuid='00000000-0000-0000-0000-000000000000')
	begin
		set @count=(select COUNT(*) from BuildingRequests)
		select @count
		return @count
	end
	else 
	begin
		set @count=(select COUNT(*) from BuildingRequests where UserGuid=@userGuid)
		select @count
		return @count
	end

END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_CheckCount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_CheckCount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Pardakht_CheckCount	
	@dateSh nvarchar(50)
AS
BEGIN	
	declare @count int
	set @count = (select COUNT(*) from Pardakhts where SarResid like @dateSh)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_CheckCount]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_CheckCount]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Reception_CheckCount	
	@dateSh nvarchar(50)
AS
BEGIN	
	declare @count int
	set @count = (select COUNT(*) from Pardakhts where SarResid like @dateSh)
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_CheckReport]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_CheckReport]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Pardakht_CheckReport
	@dateSh nvarchar(50)
AS
BEGIN
	select  Peoples.Name As PeopleName,
			Pardakhts.[Check] As Price,
			Pardakhts.CheckNo As Number,
			Pardakhts.BankName As BankName,
			Pardakhts.CreateDate As CreateDate
	from Pardakhts left outer join Peoples on
		 Pardakhts.Payer = Peoples.Guid
	where Pardakhts.[Check]>0
	and Pardakhts.SarResid=@dateSh
END
GO
-- =================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_Count]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_Count]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Building_Discharge_Count
	@date1 datetime,
	@date2 datetime
AS
BEGIN
	
	declare @count int
	set @count = (select COUNT(*) from Contracts where 
					DATEADD(month, Term, FromDate)>=@date1 and 
					DATEADD(month, Term, FromDate)<=@date2 and
					Status='true')
	select @count
	return @count
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Building_Discharge_List]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Building_Discharge_List]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_Building_Discharge_List]
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	select  Contracts.Code As Code,
			Peoples.Name As FSideName,
			Contracts.FirstSideGuid As FSideGuid,
			Contracts.SecondSideGuid As SSideGuid,
			(select [dbo].[Peoples].Name from [dbo].[Peoples] where Guid=[dbo].[Contracts].SecondSideGuid) as SSideName,
			Contracts.Term As Term,
			Contracts.FromDate As FromDate,
			DATEADD(month, Contracts.Term, Contracts.FromDate) As ToDate,
			Buildings.Code As BuildingCode
			from [dbo].[Contracts] left Outer join [dbo].[Peoples]
			on [dbo].[Contracts].FirstSideGuid=[dbo].[Peoples].Guid left outer join Buildings
			on [dbo].[Contracts].BuildingGuid=Buildings.Guid
			where  DATEADD(month, Term, FromDate)>=@d1 and 
				   DATEADD(month, Term, FromDate)<=@d2 and
				   [Contracts].Status='true'
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_UserLog_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_UserLog_Insert]	As Begin print 11 end')
GO
Alter PROCEDURE sp_UserLog_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@userGuid uniqueidentifier,
	@date datetime,
	@action smallint,
	@part smallint,
	@desc nvarchar(max)
AS
BEGIN	
	insert into [dbo].[UserLogs](
			 Guid
			,Modified
			,Status
			,UserGuid
			,Date
			,Action
			,Part
			,Description)
			values(
			 @guid
			,@modif
			,@st
			,@userGuid
			,@date
			,@action
			,@part
			,@desc)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRelatedOptions_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRelatedOptions_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRelatedOptions_GetAll	
	@buGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingRelatedOptions]
	where BuildinGuid=@buGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequestRegion_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequestRegion_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRequestRegion_GetAll
	@reqGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingRequestRegions]
	where RequestGuid=@reqGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ContractFinance_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ContractFinance_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_ContractFinance_Get
	@conGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[ContractFinances]
	where ConGuid=@conGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_GetAllByParentGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_GetAllByParentGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_GetAllByParentGuid
	@pGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[PhoneBooks]
	where ParentGuid=@pGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_Get
	@guid uniqueidentifier
AS
BEGIN
	select * From PhoneBooks
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_GetAll
AS
BEGIN
	Select * From PhoneBooks
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Remove]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete From PhoneBooks
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_RemoveByParentGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_RemoveByParentGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_RemoveByParentGuid
	@parentGuid uniqueidentifier
AS
BEGIN
	delete From PhoneBooks
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update PhoneBooks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_ChangeStatusByParenGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_ChangeStatusByParenGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_ChangeStatusByParenGuid
	@parentGuid uniqueidentifier,
	@st bit
AS
BEGIN
	update PhoneBooks
	set Status=@st
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PhoneBook_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PhoneBook_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PhoneBook_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(500),
	@tell nvarchar(50),
	@group smallint,
	@parentGuid uniqueidentifier
AS
BEGIN
	UPDATE [dbo].[PhoneBooks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Name] = @name
		  ,[Tell] = @tell
		  ,[Group] = @group
		  ,[ParentGuid] = @parentGuid
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[PhoneBooks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Name]
           ,[Tell]
           ,[Group]
           ,[ParentGuid])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@name
           ,@tell
           ,@group
           ,@parentGuid)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_GetAllByParent]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_GetAllByParent]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_GetAllByParent
	@pGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[PeopleBankAccounts]
	where ParentGuid=@pGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_RemoveByParent]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_RemoveByParent]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_RemoveByParent
	@parentGuid uniqueidentifier
AS
BEGIN
	delete from PeopleBankAccounts
	where ParentGuid=@parentGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_People_BankAccount_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_People_BankAccount_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_People_BankAccount_Save
	@guid uniqueidentifier,
	@modif datetime,
	@parentGuid uniqueidentifier,
	@st bit,
	@bankname nvarchar(200),
	@accountNumber nvarchar(200),
	@shobe nvarchar(200)
AS
BEGIN
	UPDATE [dbo].[PeopleBankAccounts]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[BankName] = @bankname
		  ,[AccountNumber] = @accountNumber
		  ,[Shobe] = @shobe
		  ,[ParentGuid] = @parentGuid
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[PeopleBankAccounts]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[BankName]
           ,[AccountNumber]
           ,[Shobe]
           ,[ParentGuid])
		 VALUES
           (@guid
           ,@modif
           ,@st
           ,@bankname
           ,@accountNumber
           ,@shobe
           ,@parentGuid)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingGallery_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingGallery_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingGallery_GetAll
	@buGuid uniqueidentifier,
	@st bit
AS
BEGIN
	Select * From [dbo].[BuildingGalleries]
	where BuildingGuid=@buGuid
	and Status=@st
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Setting_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Setting_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Setting_Get
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[Settings]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByName
	@name nvarchar(100)
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingOptions_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingOptions_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingOptions_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[BuildingOptions]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[Contracts]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Buildings_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Buildings_GetByGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Buildings_GetByGuid
	@guid uniqueidentifier
AS
BEGIN
	Select * From [dbo].[Buildings]
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_States_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_States_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_States_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From States
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Cities_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Cities_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Cities_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From Cities
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From Regions
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From PeopleGroups
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Hazine_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Hazine_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Hazine_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From Hazines
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingAccountType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingAccountType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingAccountType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingAccountTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingCondition_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingCondition_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingCondition_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingConditions
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingView_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingView_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingView_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From BuildingViews
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DocumentType_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DocumentType_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DocumentType_Get
	@guid uniqueidentifier
AS
BEGIN
	Select * From DocumentTypes
	Where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_FloorCover_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_FloorCover_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_FloorCover_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from FloorCovers
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_KitchenService_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_KitchenService_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_KitchenService_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from KitchenServices
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_RentalAuthority_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_RentalAuthority_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_RentalAuthority_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from RentalAuthorities
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingRequest_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingRequest_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingRequest_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from BuildingRequests
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Reception_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Receptions
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Pardakht_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Pardakht_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Pardakht_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from Pardakhts
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_GardeshHesab_Get]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_GardeshHesab_Get]	As Begin print 11 end')
GO
Alter PROCEDURE sp_GardeshHesab_Get
	@guid uniqueidentifier
AS
BEGIN
	SELECT * from GardeshHesabs
	where Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Regions_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Regions_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Regions_GetByName
	@name nvarchar(200)
AS
BEGIN
	Select * From Regions
	Where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_PeopleGroup_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_PeopleGroup_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_PeopleGroup_GetByName
	@name nvarchar(250)
AS
BEGIN
	Select * From PeopleGroups
	Where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BuildingType_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BuildingType_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_BuildingType_GetByName
	@name nvarchar(200)
AS
BEGIN
	Select * From BuildingTypes
	Where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_RentalAuthority_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_RentalAuthority_GetByName]	As Begin print 11 end')
GO
Alter PROCEDURE sp_RentalAuthority_GetByName
	@name nvarchar(200)
AS
BEGIN
	SELECT * from RentalAuthorities
	where Name=@name
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ContractFinance_GetTotalCommition]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ContractFinance_GetTotalCommition]	As Begin print 11 end')
GO
Alter PROCEDURE sp_ContractFinance_GetTotalCommition
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Sum1 decimal
	declare @Sum2 decimal

	declare @dis1 decimal
	declare @dis2 decimal

	declare @SumRet1 decimal
	declare @SumRet2 decimal

	declare @Total decimal
	set @Total=0

	set @dis1=(select SUM(FirstDiscount) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @dis2=(select SUM(SecondDiscount) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @Sum1=(select SUM(FirstTotalPrice) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @Sum2=(select SUM(SecondTotalPrice) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @SumRet1=@Sum1-@dis1
	set @SumRet2=@Sum2-@dis2

	set @Total=@SumRet1+@SumRet2

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ContractFinance_GetTotalTax]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ContractFinance_GetTotalTax]	As Begin print 11 end')
GO
Alter PROCEDURE sp_ContractFinance_GetTotalTax
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Sum1 decimal
	declare @Sum2 decimal

	declare @Total decimal
	set @Total=0

	
	set @Sum1=(select SUM(FirstAddedValue) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @Sum2=(select SUM(SecondAddedValue) from ContractFinances inner join Contracts
				on Contracts.Guid=ContractFinances.ConGuid
				where ContractFinances.Status='true' and Contracts.DateM between @d1 and @d2)

	set @Total=@Sum1+@Sum2

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Contract_GetTotalBazaryab]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Contract_GetTotalBazaryab]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Contract_GetTotalBazaryab
	@d1 datetime,
	@d2 datetime
AS
BEGIN
	declare @Total decimal
	set @Total=0

	
	set @Total=(select SUM(BazaryabPrice) from Contracts 
				where Status='true' and Contracts.DateM between @d1 and @d2)

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Hazine_GetTotal]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Hazine_GetTotal]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Hazine_GetTotal
	@d1 datetime,
	@d2 datetime,
	@hazineGuid uniqueidentifier
AS
BEGIN
	declare @Total decimal
	set @Total=0

	
	set @Total=(select SUM(Price) from GardeshHesabs
				where Status='true' and Modified between @d1 and @d2
				and PeopleGuid=@hazineGuid)

	select @Total
	return @Total
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_SelectAll]	As Begin print 11 end')
GO
ALTER PROCEDURE [dbo].[sp_DasteCheck_SelectAll]
AS
BEGIN
	Select DasteChecks.*,Tafsils.Name As BankName
	From DasteChecks inner join Tafsils
	on Tafsils.Guid=DasteChecks.BankGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	Select DasteChecks.*,Tafsils.Name As BankName
	From DasteChecks inner join Tafsils
	on Tafsils.Guid=DasteChecks.BankGuid
	where DasteChecks.Guid = @Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_ChangeStatus]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_ChangeStatus]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_ChangeStatus
	@Guid uniqueidentifier,
	@st bit
AS
BEGIN
	update DasteChecks
	set Status=@st
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_DasteCheck_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_DasteCheck_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_DasteCheck_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@serial nvarchar(100),
	@bankGuid uniqueidentifier,
	@fNumber bigint,
	@toNumber bigint,
	@desc nvarchar(Max)
AS
BEGIN
	UPDATE [dbo].[DasteChecks]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[SerialNumber] = @serial
		  ,[BankGuid] = @bankGuid
		  ,[FromNumber] = @fNumber
		  ,[ToNumber] = @toNumber
		  ,[Description] = @desc
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[DasteChecks]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[SerialNumber]
           ,[BankGuid]
           ,[FromNumber]
           ,[ToNumber]
           ,[Description])
		 VALUES
           (@Guid
           ,@modif
           ,@st
           ,@serial
           ,@bankGuid
           ,@fNumber
           ,@toNumber
           ,@desc)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_SelectAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_SelectAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_SelectAll
	@Guid uniqueidentifier
AS
BEGIN
	select * from CheckPages
	where CheckGuid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_SelectRow]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_SelectRow]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_SelectRow
	@Guid uniqueidentifier
AS
BEGIN
	select * from CheckPages
	where Guid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@CheckGuid uniqueidentifier,
	@datePardakht datetime=null,
	@number bigint,
	@receptorGuid uniqueidentifier=null,
	@sarresid datetime=null,
	@desc nvarchar(max),
	@price decimal,
	@st int
AS
BEGIN
	INSERT INTO [dbo].[CheckPages]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[CheckGuid]
           ,[DatePardakht]
           ,[Number]
           ,[ReceptorGuid]
           ,[DateSarresid]
           ,[Description]
           ,[Price]
           ,[CheckStatus])
		VALUES
           (@Guid
           ,@modif
           ,'true'
           ,@CheckGuid
           ,@datePardakht
           ,@number
           ,@receptorGuid
           ,@sarresid
           ,@desc
           ,@price
           ,@st)
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_CheckPage_RemoveAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_CheckPage_RemoveAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_CheckPage_RemoveAll
	@Guid uniqueidentifier
AS
BEGIN
	Delete from CheckPages
	where CheckGuid=@Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_GetAll]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_GetAll
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_SelectRowBuGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_SelectRowBuGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_SelectRowBuGuid
	@guid uniqueidentifier
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
	where Sanads.Guid=@guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_SelectRowBuNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_SelectRowBuNumber]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_SelectRowBuNumber
	@number bigint
AS
BEGIN
	Select    Sanads.* 
			, Users.Name As UserName
	From Sanads inner join Users on
		 Sanads.UserGuid = Users.Guid
	where Number=@number
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_Save
	@guid uniqueidentifier,
	@st bit, 
	@dateM datetime,
	@modif datetime,
	@desc nvarchar(max),
	@number bigint,
	@sanadst smallint,
	@userGuid uniqueidentifier,
	@sanadType smallint
AS
BEGIN
	UPDATE [dbo].[Sanads]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[DateM] = @dateM
		  ,[Description] = @desc
		  ,[Number] = @number
		  ,[SanadStatus] = @sanadst
		  ,[SanadType] = @sanadType
	 WHERE [Guid] = @guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[Sanads]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[DateM]
           ,[Description]
           ,[Number]
           ,[SanadStatus]
           ,[UserGuid]
           ,[SanadType])
		 VALUES
           (@guid
           ,@modif
           ,@st
           ,@dateM
           ,@desc
           ,@number
           ,@sanadst
           ,@userGuid
           ,@sanadType)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Remove]	As Begin print 11 end')
GO
Alter PROCEDURE sp_Sanad_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Sanads
	where Guid = @guid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_GetAllByMaster]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_GetAllByMaster]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_GetAllByMaster
	@masterGuid uniqueidentifier
AS
BEGIN
	Select    SanadDetails.*
			, Moeins.Code As MoeinCode
			, Moeins.Name As MoeinName
			, Tafsils.Code As TafsilCode
			, Tafsils.Name As TafsilName
	from SanadDetails inner join Moeins on
		 SanadDetails.MoeinGuid = Moeins.Guid
		 inner join Tafsils on
		 SanadDetails.TafsilGuid = Tafsils.Guid
	where MasterGuid=@masterGuid
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_Save]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_Save
	@Guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@moeinGuid uniqueidentifier,
	@tafsilGuid uniqueidentifier,
	@debit decimal,
	@credit decimal,
	@desc nvarchar(Max),
	@masterGuid uniqueidentifier
AS
BEGIN
	UPDATE [dbo].[SanadDetails]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[MoeinGuid] = @moeinGuid
		  ,[TafsilGuid] = @tafsilGuid
		  ,[Debit] = @debit
		  ,[Credit] = @credit
		  ,[Description] = @desc
		  ,[MasterGuid] = @masterGuid
	 WHERE [Guid] = @Guid
	 if @@ROWCOUNT = 0
	 begin
		INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid])
		VALUES
           (@Guid
           ,@modif
           ,@st
           ,@moeinGuid
           ,@tafsilGuid
           ,@debit
           ,@credit
           ,@desc
           ,@masterGuid)
	 end
END
GO
-- ==========================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_SanadDetail_RemoveByMasterGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_SanadDetail_RemoveByMasterGuid]	As Begin print 11 end')
GO
Alter PROCEDURE sp_SanadDetail_RemoveByMasterGuid
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from SanadDetails
	where MasterGuid = @masterGuid
END
GO
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Credit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Credit]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Tafsil_Credit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid ='00000000-0000-0000-0000-000000000000' return

	update Tafsils
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Tafsil_Debit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Tafsil_Debit]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Tafsil_Debit 
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return

	update Tafsils
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Credit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Credit]	As Begin print 11 end')  
GO

Alter PROCEDURE sp_Moein_Credit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return
	
	update Moeins
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@Guid

	declare @kolGuid uniqueidentifier
	set @kolGuid=(select KolGuid From Moeins where Guid=@Guid)

	update Kols
	set Account=Account+@Price,
		Modified=GETDATE()
	where Guid=@kolGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Moein_Debit]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Moein_Debit]	As Begin print 11 end')  
GO

Alter PROCEDURE sp_Moein_Debit
	@Guid uniqueidentifier,
	@Price decimal(18,3)
AS
BEGIN
	if @price=0 return
	if @Guid='00000000-0000-0000-0000-000000000000' return
	
	update Moeins
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@Guid

	declare @kolGuid uniqueidentifier
	set @kolGuid=(select KolGuid From Moeins where Guid=@Guid)

	update Kols
	set Account=Account-@Price,
		Modified=GETDATE()
	where Guid=@kolGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_Update_Eftetahie]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_Update_Eftetahie]	As Begin print 11 end')  
GO

ALTER PROCEDURE [dbo].[sp_Sanad_Update_Eftetahie]
	@userGuid uniqueidentifier,
	@sarmayeTafsilGuid uniqueidentifier,
	@sarmayeMoeinGuid uniqueidentifier,
	@tafsilCreditMoeinGuid uniqueidentifier,
	@bankCreditTafilGuid uniqueidentifier,
	@sandouqCreditTafilGuid uniqueidentifier
AS
BEGIN
	declare @materGuid uniqueidentifier
	set @materGuid=(select Guid from Sanads where Number=1)
	if (@materGuid is null or @materGuid='00000000-0000-0000-0000-000000000000')
	begin
		set @materGuid=NEWID()
		declare @date datetime
		set @date=GETDATE()
		exec sp_Sanad_Save @materGuid,'true',@date,@date,N'سند افتتاحیه',1,1,@userGuid,1
	end

	Delete From SanadDetails
	where MasterGuid=@materGuid

	INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid])
		   --حسابهای دریافتنی ابتدای دوره - بستانکاران
			select    NEWID() As Guid
					, Tafsils.Modified
					, Tafsils.Status
					, @tafsilCreditMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, 0 As Debit
					, AccountFirst As Credit
					, N'حسابهای دریافتنی ابتدای دوره ('+Tafsils.Name+')' As Description
					, @materGuid As MasterGuid
			from Tafsils where AccountFirst > 0 
						 and Tafsils.Status='true'
						 and (HesabType=2 or HesabType=6)
	union all
		--حسابهای دریافتنی ابتدای دوره - بدهکاران
		select    NEWID() As Guid
				, Tafsils.Modified
				, Tafsils.Status
				, @tafsilCreditMoeinGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N'حسابهای دریافتنی ابتدای دوره ('+Tafsils.Name+')' As Description
				, @materGuid As MasterGuid
		from Tafsils where AccountFirst < 0 
						 and Tafsils.Status='true'
						 and (HesabType=2 or HesabType=6)
	union all
		--موجودی ابتدای دوره بانک ها
		select    NEWID() As Guid
				, Tafsils.Modified
				, Tafsils.Status
				, @bankCreditTafilGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N' موجودی ابتدای دوره بانک('+Banks.Name+' '+Banks.Shobe+')' As Description
				, @materGuid As MasterGuid
		from Tafsils inner join Banks on
			 Tafsils.Guid=Banks.Guid
			 where AccountFirst < 0 and Tafsils.Status='true'
	union all
		--موجودی ابتدای دوره صندوق ها
		select    NEWID() As Guid
				, Tafsils.Modified
				, Tafsils.Status
				, @sandouqCreditTafilGuid As MoeinGuid
				, Tafsils.Guid As TafsilGuid
				, ABS(AccountFirst) As Debit
				, 0 As Credit
				, N' موجودی ابتدای دوره صندوق('+Name+')' As Description
				, @materGuid As MasterGuid
		from Tafsils where AccountFirst < 0
					 and HesabType = 5
					 and Tafsils.Status='true'

	declare @Sum Decimal(18,3)
	set @Sum=(select sum(Credit-Debit)
				from [SanadDetails]
				where MasterGuid=@materGuid)
	set @Sum=ISNULL(@Sum,0)

	if @Sum>0
	begin
		INSERT INTO [dbo].[SanadDetails]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[MoeinGuid]
           ,[TafsilGuid]
           ,[Debit]
           ,[Credit]
           ,[Description]
           ,[MasterGuid])
			--سرمایه ابتدای دوره بستانکار
			select    NEWID() As Guid
					, Tafsils.Modified
					, Tafsils.Status
					, @sarmayeMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, ABS(@Sum) As Debit
					, 0 As Credit
					, N'سرمایه ابتدای دوره' As Description
					, @materGuid As MasterGuid
			from Tafsils where Guid = @sarmayeTafsilGuid
	end
	else if @Sum<0
	begin
		INSERT INTO [dbo].[SanadDetails]
			   ([Guid]
			   ,[Modified]
			   ,[Status]
			   ,[MoeinGuid]
			   ,[TafsilGuid]
			   ,[Debit]
			   ,[Credit]
			   ,[Description]
			   ,[MasterGuid])
			--سرمایه ابتدای دوره بدهکار
			select    NEWID() As Guid
					, Tafsils.Modified
					, Tafsils.Status
					, @sarmayeMoeinGuid As MoeinGuid
					, Tafsils.Guid As TafsilGuid
					, 0 As Debit
					, ABS(@Sum) As Credit
					, N'سرمایه ابتدای دوره' As Description
					, @materGuid As MasterGuid
			from Tafsils where Guid = @sarmayeTafsilGuid
	end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_NextNumber]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_NextNumber]	As Begin print 11 end')  
GO
ALTER PROCEDURE [dbo].[sp_Sanad_NextNumber]
AS
BEGIN
	declare @nextNumber bigint
	select @nextNumber = MAX(Number) From Sanads
	set @nextNumber = (isnull(@nextNumber , 0))
	set @nextNumber = @nextNumber + 1
	select @nextNumber
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Sanad_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Sanad_CheckCode]	As Begin print 11 end')  
GO
Alter PROCEDURE [dbo].[sp_Sanad_CheckCode]
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Sanads
	where Number=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_GetAll
AS
BEGIN
	select Receptions.*, Tafsils.Name As TafsilName, Users.Name As UserName
	from Receptions inner join Tafsils on
	Receptions.TafsilGuid=Tafsils.Guid
	inner join Users on
	Receptions.UserGuid=Users.Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_GetByGuid]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_GetByGuid]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_GetByGuid
	@Guid uniqueidentifier
AS
BEGIN
	select Receptions.*, Tafsils.Name As TafsilName, Users.Name As UserName
	from Receptions inner join Tafsils on
	Receptions.TafsilGuid=Tafsils.Guid
	inner join Users on
	Receptions.UserGuid=Users.Guid
	where Receptions.Guid=@Guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_NextCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_NextCode]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_NextCode
AS
BEGIN
	declare @nextCode nvarchar(10)
	select @nextCode = MAX(Number) From Receptions
	set @nextCode = (isnull(@nextCode , 0))
	set @nextCode = CAST(@nextCode AS bigint) + 1
	select @nextCode
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_CheckCode]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_CheckCode]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_CheckCode
	@guid uniqueidentifier,
	@code bigint
AS
BEGIN
	select COUNT(*) from Receptions
	where Number=@code and Guid<>@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Save]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Save]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_Save
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@number bigint,
	@desc nvarchar(max),
	@dateM datetime,
	@tafsilGuid uniqueidentifier,
	@moeinGuid uniqueidentifier,
	@userGuid uniqueidentifier,
	@sanadNumber bigint
AS
BEGIN
	UPDATE [dbo].[Receptions]
	   SET [Modified] = @modif
		  ,[Status] = @st
		  ,[Description] = @desc
		  ,[Number] = @number
		  ,[DateM] = @dateM
		  ,[TafsilGuid] = @tafsilGuid
		  ,[MoeinGuid] = @moeinGuid
		  ,[UserGuid] = @userGuid
		  ,[SanadNumber] = @sanadNumber
	 WHERE Guid=@guid
	 if @@ROWCOUNT=0
	 begin
		INSERT INTO [dbo].[Receptions]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[Description]
           ,[Number]
           ,[DateM]
           ,[TafsilGuid]
           ,[MoeinGuid]
           ,[UserGuid]
           ,[SanadNumber])
		VALUES
           (@guid
           ,@modif
           ,@st
           ,@desc
           ,@number
           ,@dateM
           ,@tafsilGuid
           ,@moeinGuid
           ,@userGuid
           ,@sanadNumber)
	 end
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_Reception_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_Reception_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_Reception_Remove
	@guid uniqueidentifier
AS
BEGIN
	delete from Receptions
	where Guid=@guid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionChecks
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from ReceptionChecks
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionCheck_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionCheck_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionCheck_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@bankName nvarchar(200),
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier,
	@checkNumber nvarchar(200),
	@poshtNomre nvarchar(200),
	@price decimal,
	@checkStatus int,
	@sarResid datetime,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier
AS
BEGIN
	INSERT INTO [dbo].[ReceptionChecks]
          ([Guid]
          ,[Modified]
          ,[Status]
          ,[BankName]
          ,[DateM]
          ,[MasterGuid]
          ,[Description]
          ,[CheckNumber]
          ,[PoshtNomre]
          ,[Price]
          ,[CheckStatus]
		  ,[DateSarResid]
		  ,[SandouqTafsilGuid]
		  ,[SandouqMoeinGuid])
	VALUES
          (@guid
          ,@modif
          ,@st
          ,@bankName
          ,@dateM
          ,@masterGuid
          ,@desc
          ,@checkNumber
          ,@poshtNomre
          ,@price
          ,@checkStatus
		  ,@sarResid
		  ,@sandouqTafsilGuid
		  ,@sandouqMoeinGuid)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	Delete from ReceptionNaqds
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionNaqd_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionNaqd_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionNaqd_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier,
	@price decimal,
	@sandouqTafsilGuid uniqueidentifier,
	@sandouqMoeinGuid uniqueidentifier
AS
BEGIN
	INSERT INTO [dbo].[ReceptionNaqds]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[DateM]
           ,[MasterGuid]
           ,[Description]
           ,[Price]
           ,[SandouqTafsilGuid]
           ,[SandouqMoeinGuid])
     VALUES
           (@guid
           ,@modif
           ,@st
           ,@dateM
           ,@masterGuid
           ,@desc
           ,@price
           ,@sandouqTafsilGuid
           ,@sandouqMoeinGuid)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_GetAll
	@masterGuid uniqueidentifier
AS
BEGIN
	select * from ReceptionHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_Remove]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_Remove]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_Remove
	@masterGuid uniqueidentifier
AS
BEGIN
	delete from ReceptionHavales
	where MasterGuid=@masterGuid
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_ReceptionHavale_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_ReceptionHavale_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_ReceptionHavale_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@desc nvarchar(max),
	@dateM datetime,
	@masterGuid uniqueidentifier,
	@price decimal,
	@peygiriNo nvarchar(200),
	@bankTafsilGuid uniqueidentifier,
	@bankMoeinGuid uniqueidentifier
AS
BEGIN
	INSERT INTO [dbo].[ReceptionHavales]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[DateM]
           ,[MasterGuid]
           ,[Description]
           ,[Price]
           ,[PeygiriNumber]
           ,[BankTafsilGuid]
           ,[BankMoeinGuid])
     VALUES
           (@guid
           ,@modif
           ,@st
           ,@dateM
           ,@masterGuid
           ,@desc
           ,@price
           ,@peygiriNo
           ,@bankTafsilGuid
           ,@bankMoeinGuid)
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_GetByName]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_GetByName]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_GetByName
	@name nvarchar(200)
AS
BEGIN
	select * from BankSegests
	where BankName=@name
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_GetAll]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_GetAll]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_GetAll
AS
BEGIN
	select * from BankSegests
END
GO
--========================================================================================================
IF Not EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[sp_BankSegest_Insert]') AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
	exec('Create Procedure [dbo].[sp_BankSegest_Insert]	As Begin print 11 end')  
GO
Alter PROCEDURE sp_BankSegest_Insert
	@guid uniqueidentifier,
	@modif datetime,
	@st bit,
	@name nvarchar(200)
AS
BEGIN
	INSERT INTO [dbo].[BankSegests]
           ([Guid]
           ,[Modified]
           ,[Status]
           ,[BankName])
     VALUES
           (@guid
           ,@modif
           ,@st
           ,@name)
END